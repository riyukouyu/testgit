<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<flowtran xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" id="upgrad" longname="电子账户客户端升级" kind="2" package="cn.sunline.ltts.busi.catran.trans" xsi:noNamespaceSchemaLocation="ltts-model.xsd">
    <description><![CDATA[电子账户客户端升级]]></description>
    <interface package="cn.sunline.ltts.busi.catran.trans.intf">
        <input packMode="true">
            <field id="cardno" type="BaseType.U_CARDNO" required="false" multi="false" array="false" longname="电子账号"/>
            <field id="odactp" type="BaseEnumType.E_ACCATP" required="false" multi="false" array="false" longname="原账户分类"/>
            <field id="upactp" type="BaseEnumType.E_ACCATP" required="false" multi="false" array="false" longname="升级账户分类"/>
            <field id="idckrt" type="CaEnumType.E_IDCKRT" required="false" multi="false" array="false" longname="身份核查结果" ref="CaDict.Eacct.idckrt"/>
            <field id="mpckrt" type="CaEnumType.E_MPCKRT" required="false" multi="false" array="false" longname="人脸识别结果" ref="CaDict.Eacct.mpckrt"/>
            <field id="facesg" type="BaseEnumType.E_YES___" required="false" multi="false" array="false" longname="面签标识"/>
            <field id="promsv" type="CaEnumType.E_PROMSV" required="false" multi="false" array="false" longname="升级渠道" ref="CaDict.Eacct.promsv"/>
            <field id="risklv" type="BaseEnumType.E_YES___" required="false" multi="false" array="false" longname="是否高风险用户"/>
            <field id="cdopac" type="BaseType.U_ACCTNO" required="false" multi="false" array="false" longname="绑定账户" ref="CaDict.Eacct.cdopac"/>
            <field id="opbrch" type="BaseType.U_CHAR20" required="false" multi="false" array="false" longname="账户开户行号" ref="CaDict.Eacct.opbrch"/>
            <field id="cdopna" type="BaseType.U_CHAR80" required="false" multi="false" array="false" longname="绑定账户名称" ref="CaDict.Eacct.cdopna"/>
            <field id="brchna" type="BaseType.U_CHAR80" required="false" multi="false" array="false" longname="账户开户行名称" ref="CaDict.Eacct.brchna"/>
            <field id="cardtp" type="CaEnumType.E_BACATP" required="false" multi="false" array="false" longname="绑定账户类型" ref="CaDict.Eacct.cardtp"/>
            <field id="isbkca" type="BaseEnumType.E_YES___" required="false" multi="false" array="false" longname="是否本行账户" ref="CaDict.Eacct.isbkca"/>
            <field id="bdcart" type="CaEnumType.E_BDCART" required="false" multi="false" array="false" longname="绑卡认证结果" ref="CaDict.Eacct.bdcart"/>
            <field id="bdcatp" type="BaseEnumType.E_ACCATP" required="false" multi="false" array="false" longname="绑定账户分类"/>
            <field id="ckrtsq" type="BaseType.U_SEQUNO" required="false" multi="false" array="false" longname="核查流水号"/>
            <field id="agrtno" type="BaseType.U_CHAR20" required="false" multi="false" array="false" longname="协议模版编号"/>
            <field id="vesion" type="BaseType.U_CHAR10" required="false" multi="false" array="false" longname="版本号"/>
        </input>
        <output asParm="true" packMode="true">
            <field id="chekre" type="CaEnumType.E_CHEKRE" required="false" multi="false" array="false" longname="核查结果"/>
        </output>
        <property packMode="true">
            <field id="custno" type="BaseType.U_CUSTNO" required="false" multi="false" array="false" longname="客户号"/>
            <field id="custac" type="BaseType.U_CHAR35" required="false" multi="false" array="false" longname="电子账号"/>
            <field id="cacttp" type="DpEnumType.E_CUSACT" required="false" multi="false" array="false" longname="客户账号类型"/>
            <field id="custna" type="BaseType.U_CHAR100" required="false" multi="false" array="false" longname="客户名称"/>
            <field id="baprcd" type="BaseType.U_PRODCD" required="false" multi="false" array="false" longname="基础负债产品" ref="CaDict.CardAcc.baprcd"/>
            <field id="acctno" type="BaseType.U_ACCTNO" required="false" multi="false" array="false" longname="负债账号" ref="DpDict.Acct.acctno"/>
            <field id="pddpfg" type="DpEnumType.E_FCFLAG" required="false" multi="false" array="false" longname="业务小类" ref="DpDict.Prod.pddpfg"/>
            <field id="prodtp" type="DpEnumType.E_PRODTP" required="false" enums="存款" fixed="'DEPO'" multi="false" array="false" longname="产品类型" desc="存款开户交易，产品类型设为存款"/>
            <field id="depttm" type="BaseEnumType.E_TERMCD" required="false" enums="T000" fixed="'000'" multi="false" array="false" longname="存期" desc="开电子账户时默认为活期" ref="DpDict.Prod.depttm"/>
            <field id="opacfg" type="BaseEnumType.E_YES___" required="false" enums="NO" fixed="'NO'" multi="false" array="false" longname="首开户标志" desc="判定是否是首次开户，是则负债账户必须是活期"/>
            <field id="custtp" type="BaseEnumType.E_CUSTTP" required="false" fixed="'11'" multi="false" array="false" longname="客户类型" desc="客户类型暂时默认为个人"/>
            <field id="signtp" type="CaEnumType.E_SIGNTP" required="false" fixed="'01'" multi="false" array="false" longname="签约类型" desc="签约类型默认为智能储蓄"/>
            <field id="crcycd" type="BaseType.U_CRCYCD" required="false" multi="false" array="false" longname="币种" ref="BaseDict.Comm.crcycd"/>
            <field id="csextg" type="BaseEnumType.E_CSEXTG" required="false" multi="false" array="false" longname="钞汇标志" ref="CaDict.Eacct.csextg"/>
            <field id="smrycd" type="BaseType.U_SMRYCD" required="false" enums="SJ" fixed="'SJ'" multi="false" array="false" longname="摘要代码" ref="BaseDict.Comm.smrycd"/>
            <field id="smryds" type="BaseType.U_SMRYDS" required="false" multi="false" array="false" longname="摘要描述" ref="BaseDict.Comm.smryds"/>
            <field id="ischck" type="BaseEnumType.E_YES___" required="false" enums="NO" fixed="'NO'" multi="false" array="false" longname="是否检查"/>
            <field id="tranam" type="BaseType.U_TRANAM" required="false" multi="false" array="false" longname="交易金额"/>
            <field id="brchno" type="BaseType.U_BRCHNO" required="false" multi="false" array="false" longname="归属机构" ref="CaDict.Eacct.brchno"/>
            <field id="cktntp" type="CaEnumType.E_CKTNTP" required="false" multi="false" array="false" longname="核查交易类型" ref="CaDict.Eacct.cktntp"/>
            <field id="custid" type="BaseType.U_CUSTID" required="false" multi="false" array="false" longname="用户ID" ref="BaseDict.Comm.custid"/>
            <field id="procst" type="BaseEnumType.E_PROCST" required="false" multi="false" array="false" longname="处理状态"/>
            <field id="mantwy" type="CaEnumType.E_MANTWY" required="false" fixed="'1'" multi="false" array="false" longname="维护方式" ref="CaDict.Eacct.mantwy"/>
            <field id="idtfno" type="BaseType.U_IDTFNO" required="false" multi="false" array="false" longname="证件号码" ref="DpDict.Acct.idtfno"/>
            <field id="idtftp" type="BaseEnumType.E_IDTFTP" required="false" multi="false" array="false" longname="证件类型" ref="DpDict.Acct.idtftp"/>
            <field id="acctnm" type="BaseType.U_ACCTNO" required="false" multi="false" array="false" longname="解约负债账号"/>
            <field id="acalno" type="BaseType.U_CHAR30" required="false" multi="false" array="false" longname="账户别名" ref="CaDict.Eacct.acalno"/>
            <field id="bdcafg" type="BaseEnumType.E_YES___" required="false" multi="false" array="false" longname="是否绑卡认证通过标志"/>
            <field id="bindfg" type="BaseEnumType.E_YES___" required="false" multi="false" array="false" longname="是否绑卡标志"/>
            <field id="negafg" type="BaseEnumType.E_YES___" required="false" enums="YES" fixed="'YES'" multi="false" array="false" longname="是否允许负数"/>
        </property>
        <printer packMode="false"/>
    </interface>
    <flow>
        <method method="prcUpgBefore" id="prcUpgBefore" longname="电子账户升级交易前处理" desc="电子账户升级交易前处理"/>
        <service serviceName="IoCaSevAccountManager.IoCaAccountUpgrade" id="caAccountUpgrade" longname="电子账户客户端升级" desc="电子账户客户端升级">
            <in_mappings by_interface="true">
                <mapping src="cardno" dest="cplAcUpg.cardno" desc="电子账号" by_interface="true" on_top="true"/>
                <mapping src="idckrt" dest="cplAcUpg.idckrt" desc="身份核查结果" by_interface="true" on_top="true"/>
                <mapping src="mpckrt" dest="cplAcUpg.mpckrt" desc="人脸识别结果" by_interface="true" on_top="true"/>
                <mapping src="odactp" dest="cplAcUpg.odactp" desc="原账户分类" by_interface="true" on_top="true"/>
                <mapping src="promsv" dest="cplAcUpg.promsv" desc="升级渠道" by_interface="true" on_top="true"/>
                <mapping src="risklv" dest="cplAcUpg.risklv" desc="风险承受等级" by_interface="true" on_top="true"/>
                <mapping src="upactp" dest="cplAcUpg.upactp" desc="升级账户分类" by_interface="true" on_top="true"/>
                <mapping src="bdcafg" dest="cplAcUpg.bdcafg" desc="绑卡认证结果" by_interface="true" on_top="true"/>
            </in_mappings>
            <out_mappings by_interface="true"/>
        </service>
        <service serviceName="IoCaSevAccountManager.IoCaCheckSqReg" id="ioCaCheckSqReg" test="promsv != #dict.CaEnumType.E_PROMSV().INCASE &amp;&amp; idckrt != #dict.CaEnumType.E_IDCKRT().SUCCESS" longname="身份核查流水登记" desc="身份核查流水登记">
            <in_mappings by_interface="true">
                <mapping src="odactp" dest="tblKnbCksq.accatp" desc="账户分类" by_interface="true" on_top="true"/>
                <mapping src="ckrtsq" dest="tblKnbCksq.ckrtsq" desc="核查流水" by_interface="true" on_top="true"/>
                <mapping src="cktntp" dest="tblKnbCksq.cktntp" desc="核查交易类型" by_interface="true" on_top="true"/>
                <mapping src="crcycd" dest="tblKnbCksq.crcycd" desc="币种" by_interface="true" on_top="true"/>
                <mapping src="csextg" dest="tblKnbCksq.csextg" desc="钞汇标识" by_interface="true" on_top="true"/>
                <mapping src="custac" dest="tblKnbCksq.custac" desc="电子账号" by_interface="true" on_top="true"/>
                <mapping src="custid" dest="tblKnbCksq.custid" desc="用户ID" by_interface="true" on_top="true"/>
                <mapping src="procst" dest="tblKnbCksq.procst" desc="处理状态" by_interface="true" on_top="true"/>
                <mapping src="idckrt" dest="tblKnbCksq.idckrt" desc="身份核查标志" by_interface="true" on_top="true"/>
                <mapping src="agrtno" dest="tblKnbCksq.agrtno" desc="协议模板编号" by_interface="true" on_top="true"/>
                <mapping src="vesion" dest="tblKnbCksq.vesion" desc="版本号" by_interface="true" on_top="true"/>
            </in_mappings>
            <out_mappings by_interface="true"/>
        </service>
        <case id="prcAcctClassify" test="idckrt == #dict.CaEnumType.E_IDCKRT().SUCCESS &amp;&amp; mpckrt == #dict.CaEnumType.E_MPCKRT().SUCCESS &amp;&amp; bdcafg == #dict.BaseEnumType.E_YES___().YES" longname="根据账户分类开立负债子账户" desc="根据账户分类开立负债子账户">
            <when id="prcWalletToOther" test="promsv != #dict.CaEnumType.E_PROMSV().INCASE and  odactp == #dict.BaseEnumType.E_ACCATP().WALLET" longname="电子钱包账户升级" desc="电子钱包账户升级为理财功能户或全功能账户">
                <service mappingToProperty="true" serviceName="DpAcctSvcType.AddAcct" id="addAcct" longname="开立负债子帐户" desc="开立负债子帐户">
                    <in_mappings by_interface="true">
                        <mapping src="custna" dest="acctna" desc="客户名称" by_interface="true" on_top="true"/>
                        <mapping src="cacttp" dest="cacttp" desc="客户账号类型" by_interface="true" on_top="true"/>
                        <mapping src="crcycd" dest="crcycd" desc="币种" by_interface="true" on_top="true"/>
                        <mapping src="custac" dest="custac" desc="电子账号ID" by_interface="true" on_top="true"/>
                        <mapping src="custno" dest="custno" desc="客户号" by_interface="true" on_top="true"/>
                        <mapping src="custtp" dest="custtp" desc="客户类型" by_interface="true" on_top="true"/>
                        <mapping src="depttm" dest="depttm" desc="存期" by_interface="true" on_top="true"/>
                        <mapping src="opacfg" dest="opacfg" desc="首开户标志" by_interface="true" on_top="true"/>
                        <mapping src="baprcd" dest="prodcd" desc="产品编号" by_interface="true" on_top="true"/>
                    </in_mappings>
                    <out_mappings by_interface="false">
                        <mapping src="cplAddSubAcctOut.acctno" dest="acctno" desc="负债账号" by_interface="true" on_top="true"/>
                        <mapping src="cplAddSubAcctOut.pddpfg" dest="pddpfg" desc="定活标志" by_interface="true" on_top="true"/>
                        <mapping src="cplAddSubAcctOut.prodcd" dest="baprcd" desc="产品编号" by_interface="true" on_top="true"/>
                    </out_mappings>
                </service>
                <service serviceName="IoCaSrvGenEAccountInfo.IoCaAddEARela" id="caAddEARela" longname="建立电子账号与负债账号关联" desc="建立电子账号与负债账号关联">
                    <in_mappings by_interface="true">
                        <mapping src="acctno" dest="cplAddEARelaIn.acctno" desc="负债账号" by_interface="true" on_top="true"/>
                        <mapping src="crcycd" dest="cplAddEARelaIn.crcycd" desc="币种" by_interface="true" on_top="true"/>
                        <mapping src="custac" dest="cplAddEARelaIn.custac" desc="电子账号ID" by_interface="true" on_top="true"/>
                        <mapping src="pddpfg" dest="cplAddEARelaIn.fcflag" desc="定活标志" by_interface="true" on_top="true"/>
                        <mapping src="baprcd" dest="cplAddEARelaIn.prodcd" desc="产品编号" by_interface="true" on_top="true"/>
                        <mapping src="prodtp" dest="cplAddEARelaIn.prodtp" desc="产品类型" by_interface="true" on_top="true"/>
                    </in_mappings>
                    <out_mappings by_interface="true"/>
                </service>
            </when>
            <when id="prcFinaToGlob" test="promsv != #dict.CaEnumType.E_PROMSV().INCASE and  odactp == #dict.BaseEnumType.E_ACCATP().FINANCE" longname="理财功能账户升级为全功能账户" desc="理财功能账户升级为全功能账户">
                <service mappingToProperty="true" serviceName="DpProdSvcType.IoDpCloseCurAcc" id="closeCurAcc" longname="个人活期结算户销户" desc="个人活期结算户销户">
                    <in_mappings by_interface="true">
                        <mapping src="custac" dest="clsin.custac" by_interface="true" on_top="true"/>
                        <mapping src="smrycd" dest="clsin.smrycd" by_interface="true" on_top="true"/>
                        <mapping src="cardno" dest="clsin.toacct" by_interface="true" on_top="true"/>
                    </in_mappings>
                    <out_mappings by_interface="false">
                        <mapping src="closot.settbl" dest="tranam" desc="交易金额" by_interface="true" on_top="true"/>
                    </out_mappings>
                </service>
                <service mappingToProperty="true" serviceName="DpAcctSvcType.AddAcct" id="addAcct" longname="开立负债子帐户" desc="开立负债子帐户">
                    <in_mappings by_interface="true">
                        <mapping src="custna" dest="acctna" desc="客户名称" by_interface="true" on_top="true"/>
                        <mapping src="cacttp" dest="cacttp" desc="客户账户类型" by_interface="true" on_top="true"/>
                        <mapping src="crcycd" dest="crcycd" desc="币种" by_interface="true" on_top="true"/>
                        <mapping src="custac" dest="custac" desc="电子账号ID" by_interface="true" on_top="true"/>
                        <mapping src="custno" dest="custno" desc="客户号" by_interface="true" on_top="true"/>
                        <mapping src="custtp" dest="custtp" desc="客户类型" by_interface="true" on_top="true"/>
                        <mapping src="depttm" dest="depttm" desc="存期" by_interface="true" on_top="true"/>
                        <mapping src="opacfg" dest="opacfg" desc="首开户标志" by_interface="true" on_top="true"/>
                        <mapping src="baprcd" dest="prodcd" desc="产品编号" by_interface="true" on_top="true"/>
                    </in_mappings>
                    <out_mappings by_interface="false">
                        <mapping src="cplAddSubAcctOut.acctno" dest="acctno" desc="负债账号" by_interface="true" on_top="true"/>
                        <mapping src="cplAddSubAcctOut.pddpfg" dest="pddpfg" desc="定活标志" by_interface="true" on_top="true"/>
                        <mapping src="cplAddSubAcctOut.prodcd" dest="baprcd" desc="产品编号" by_interface="true" on_top="true"/>
                    </out_mappings>
                </service>
                <service serviceName="IoCaSrvGenEAccountInfo.IoCaAddEARela" id="caAddEARela" longname="建立电子账号与负债账号关联" desc="建立电子账号与负债账号关联">
                    <in_mappings by_interface="true">
                        <mapping src="acctno" dest="cplAddEARelaIn.acctno" desc="负债账号" by_interface="true" on_top="true"/>
                        <mapping src="crcycd" dest="cplAddEARelaIn.crcycd" desc="币种" by_interface="true" on_top="true"/>
                        <mapping src="custac" dest="cplAddEARelaIn.custac" desc="电子账号ID" by_interface="true" on_top="true"/>
                        <mapping src="pddpfg" dest="cplAddEARelaIn.fcflag" desc="定活标志" by_interface="true" on_top="true"/>
                        <mapping src="baprcd" dest="cplAddEARelaIn.prodcd" desc="产品编号" by_interface="true" on_top="true"/>
                        <mapping src="prodtp" dest="cplAddEARelaIn.prodtp" desc="产品类型" by_interface="true" on_top="true"/>
                    </in_mappings>
                    <out_mappings by_interface="true"/>
                </service>
                <service serviceName="DpAcctSvcType.addPostAcctDp" id="addPostAcctDp" test="tranam != @java.math.BigDecimal@ZERO" longname="负债账户存入服务" desc="将原结算户余额和利息转入新开立结算户">
                    <in_mappings by_interface="true">
                        <mapping src="acctno" dest="cplSaveAcctIn.acctno" desc="负债账号" by_interface="true" on_top="true"/>
                        <mapping src="crcycd" dest="cplSaveAcctIn.crcycd" desc="币种" by_interface="true" on_top="true"/>
                        <mapping src="custac" dest="cplSaveAcctIn.custac" desc="电子账号ID" by_interface="true" on_top="true"/>
                        <mapping src="custna" dest="cplSaveAcctIn.opacna" desc="对方户名" by_interface="true" on_top="true"/>
                        <mapping src="brchno" dest="cplSaveAcctIn.opbrch" desc="对方账号所属机构" by_interface="true" on_top="true"/>
                        <mapping src="smrycd" dest="cplSaveAcctIn.smrycd" desc="摘要码" by_interface="true" on_top="true"/>
                        <mapping src="smryds" dest="cplSaveAcctIn.smryds" desc="摘要描述" by_interface="true" on_top="true"/>
                        <mapping src="cardno" dest="cplSaveAcctIn.toacct" desc="电子账号" by_interface="true" on_top="true"/>
                        <mapping src="tranam" dest="cplSaveAcctIn.tranam" desc="交易金额" by_interface="true" on_top="true"/>
                        <mapping src="ischck" dest="cplSaveAcctIn.ischck" desc="是否检查标志" by_interface="true" on_top="true"/>
                        <mapping src="negafg" dest="cplSaveAcctIn.negafg" desc="是否允许负数" by_interface="true" on_top="true"/>
                    </in_mappings>
                    <out_mappings by_interface="true"/>
                </service>
                <method method="prcCancelContract" id="prcCancelContract" longname="二类户升级为一类户更新原签约信息" desc="二类户升级为一类户更新原签约信息"/>
            </when>
        </case>
        <service serviceName="IoCaSevGenBindCard.IoCaSevGenBindCar" id="caSevGenBindCar" test="cdopac != null &amp;&amp; cdopac != &quot;&quot; &amp;&amp; bindfg == #dict.BaseEnumType.E_YES___().YES" longname="电子账户升级绑卡" desc="电子账户升级绑卡">
            <in_mappings by_interface="true">
                <mapping src="cardno" dest="caBindCard.cardno" desc="电子账号" by_interface="true" on_top="true"/>
                <mapping src="cardtp" dest="caBindCard.cardtp" desc="绑定账户类型" by_interface="true" on_top="true"/>
                <mapping src="cdopac" dest="caBindCard.cdopac" desc="绑定账户" by_interface="true" on_top="true"/>
                <mapping src="cdopna" dest="caBindCard.cdopna" desc="绑定账户名称" by_interface="true" on_top="true"/>
                <mapping src="isbkca" dest="caBindCard.isbkca" desc="是否本行账户" by_interface="true" on_top="true"/>
                <mapping src="opbrch" dest="caBindCard.opbrch" desc="账户开户行号" by_interface="true" on_top="true"/>
                <mapping src="brchna" dest="caBindCard.brchna" desc="账户开户行名称" by_interface="true" on_top="true"/>
                <mapping src="bdcart" dest="caBindCard.bdcart" desc="description" by_interface="true" on_top="true"/>
            </in_mappings>
            <out_mappings by_interface="true"/>
        </service>
        <service serviceName="IoCaSevGenBindCard.IoCaCardAlterReg" id="caCardAlterReg" test="cdopac != null &amp;&amp; cdopac != &quot;&quot; &amp;&amp; bindfg == #dict.BaseEnumType.E_YES___().YES" longname="绑定账户信息修改登记簿登记">
            <in_mappings by_interface="true">
                <mapping src="cdopac" dest="bdAcctIn.cdopac" desc="新绑定卡号" by_interface="true" on_top="true"/>
                <mapping src="custac" dest="bdAcctIn.custac" desc="电子账号" by_interface="true" on_top="true"/>
                <mapping src="mantwy" dest="bdAcctIn.mantwy" desc="维护方式" by_interface="true" on_top="true"/>
            </in_mappings>
            <out_mappings by_interface="true"/>
        </service>
        <method method="bindmq" id="bindmq" test="cdopac != null &amp;&amp; cdopac != &quot;&quot; &amp;&amp; 1==2" longname="电子账户绑定账户通知服务MQ"/>
        <method method="updTrdStatus" id="updTrdStatus" longname="更新电子账户状态"/>
        <method method="clearTsscTram" id="clearTsscTram" test="idckrt == #dict.CaEnumType.E_IDCKRT().SUCCESS &amp;&amp; mpckrt == #dict.CaEnumType.E_MPCKRT().SUCCESS &amp;&amp; bdcafg == #dict.BaseEnumType.E_YES___().YES" longname="升级成功后清除累计限额"/>
    </flow>
    <outMapping/>
    <propertyToPrinterMapping/>
    <outToPrinterMapping/>
</flowtran>
