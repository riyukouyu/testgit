<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<flowtran xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" id="refund" longname="电子账户退货" kind="3" package="cn.sunline.ltts.busi.dptran.trans.client" xsi:noNamespaceSchemaLocation="ltts-model.xsd">
    <interface package="cn.sunline.ltts.busi.dptran.trans.client.intf">
        <input packMode="true">
            <field id="crcycd" type="BaseType.U_CRCYCD" required="false" multi="false" array="false" longname="币种" ref="BaseDict.Comm.crcycd"/>
            <field id="csextg" type="BaseEnumType.E_CSEXTG" required="false" multi="false" array="false" longname="钞汇标志"/>
            <field id="smrycd" type="BaseType.U_SMRYCD" required="false" multi="false" array="false" longname="摘要代码" ref="BaseDict.Comm.smrycd"/>
            <field id="cardno" type="BaseType.U_CARDNO" required="false" multi="false" array="false" longname="客户电子帐号"/>
            <field id="acsetp" type="BaseEnumType.E_ACSETP" required="false" multi="false" array="false" longname="子账号类型" ref="DpDict.Acct.acsetp"/>
            <field id="acesno" type="BaseType.U_ACCTNO" required="false" multi="false" array="false" longname="子账号"/>
            <field id="acctnm" type="BaseType.U_CUSTNA" required="false" multi="false" array="false" longname="客户名称"/>
            <field id="retrsq" type="BaseType.U_CHAR32" required="false" multi="false" array="false" longname="原支付平台流水"/>
            <field id="retrdt" type="BaseType.U_DATE08" required="false" multi="false" array="false" longname="原支付平台日期"/>
            <field id="remrsq" type="BaseType.U_CHAR32" required="false" multi="false" array="false" longname="原商户流水"/>
            <field id="remrdt" type="BaseType.U_DATE08" required="false" multi="false" array="false" longname="原商户日期"/>
            <field id="retram" type="BaseType.U_TRANAM" required="false" multi="false" array="false" longname="原交易金额"/>
            <field id="mercnm" type="BaseType.U_CHAR32" required="false" multi="false" array="false" longname="商户号"/>
            <field id="mercsq" type="BaseType.U_CHAR32" required="false" multi="false" array="false" longname="商户交易流水"/>
            <field id="mercdt" type="BaseType.U_DATE08" required="false" multi="false" array="false" longname="商户交易日期"/>
            <field id="merctm" type="BaseType.U_TIME06" required="false" multi="false" array="false" longname="商户交易时间"/>
            <field id="chckdt" type="BaseType.U_DATE08" required="false" multi="false" array="false" longname="对账日期"/>
            <field id="keepdt" type="BaseType.U_DATE08" required="false" multi="false" array="false" longname="清算日期"/>
            <field id="stady1" type="BaseType.U_CHAR200" required="false" multi="false" array="false" longname="备用字段1"/>
            <field id="stady2" type="BaseType.U_CHAR200" required="false" multi="false" array="false" longname="备用字段2"/>
            <field id="chkpwd" type="IoDpCapital.chkpwd" required="false" multi="false" array="false" longname="检查验密信息"/>
            <field id="chkqtn" type="IoDpCapital.chkqtn" required="false" multi="false" array="false" longname="检查额度信息"/>
        </input>
        <output asParm="true" packMode="true">
            <field id="mntrdt" type="PbBaseType.U_DATE08" required="false" multi="false" array="false" longname="交易日期"/>
            <field id="mntrsq" type="BaseType.U_SEQUNO" required="false" multi="false" array="false" longname="主交易流水"/>
            <field id="mntrtm" type="BaseType.U_DATELG" required="false" multi="false" array="false" longname="交易时间"/>
        </output>
        <property packMode="true">
            <field id="custac" type="PbBaseType.U_CUSTAC" required="false" multi="false" array="false" longname="电子账号" ref="QtDict.Qt.custac"/>
            <field id="brchno" type="BaseType.U_BRCHNO" required="false" multi="false" array="false" longname="机构号" ref="PbDict.Intr.brchno"/>
            <field id="servtp" type="MsType.U_CHANNEL" required="false" multi="false" array="false" longname="渠道" ref="PbDict.Intr.servtp"/>
            <field id="servsq" type="BaseType.U_SEQUNO" required="false" multi="false" array="false" longname="渠道流水"/>
            <field id="servdt" type="PbBaseType.U_DATE08" required="false" multi="false" array="false" longname="渠道交易日期"/>
            <field id="acsetp2" type="BaseEnumType.E_ACSETP" required="false" multi="false" array="false" longname="子账号类型"/>
            <field id="accttp" type="BaseEnumType.E_ACCATP" required="false" multi="false" array="false" longname="账户分类"/>
            <field id="busino" type="BaseType.U_BUSINO" required="false" multi="false" array="false" longname="业务编号"/>
            <field id="acctcd" type="BaseType.U_ACCTNO" required="false" multi="false" array="false" longname="内部户账号"/>
            <field id="amntcd" type="BaseEnumType.E_AMNTCD" required="false" fixed="'D'" multi="false" array="false" longname="借贷标志" ref="BaseDict.Comm.amntcd"/>
            <field id="spettp" type="DpEnumType.E_SPETTP" required="false" multi="false" array="false" longname="电子账户消费类型" ref="DpDict.Acct.spettp"/>
            <field id="incorp" type="BaseType.U_CORPNO" required="false" multi="false" array="false" longname="收款方法人代码"/>
            <field id="acseno" type="BaseType.U_CUACNO" required="false" multi="false" array="false" longname="子账户序号" ref="DpDict.Acct.acseno"/>
            <field id="subsac" type="BaseType.U_CUACNO" required="false" multi="false" array="false" longname="子户号"/>
            <field id="acctno" type="BaseType.U_ACCTNO" required="false" multi="false" array="false" longname="负债账号" ref="DpDict.Acct.acctno"/>
            <field id="isclos" type="BaseEnumType.E_YES___" required="false" multi="false" array="false" longname="亲情钱包是否关闭"/>
            <field id="acbrch" type="BaseType.U_BRCHNO" required="false" multi="false" array="false" longname="省级机构号"/>
        </property>
        <printer packMode="false"/>
    </interface>
    <flow>
        <method method="chkRefundtInfo" id="chkRefundtInfo" longname="检查电子账户退货信息"/>
        <service mappingToProperty="true" serviceName="IoCaSrvGenEAccountInfo.IoCaQryAccatpByCustac" id="qryAccatpByCustac" longname="查询电子账户分类">
            <in_mappings by_interface="true">
                <mapping src="custac" dest="custac" desc="电子账号" by_interface="true" on_top="true"/>
            </in_mappings>
            <out_mappings by_interface="true">
                <mapping src="accatp" dest="accttp" by_interface="true" on_top="true"/>
            </out_mappings>
        </service>
        <case id="prcRefundAccatp" test="1!=1" longname="判断退货账户分类" desc="经确认退货交易不涉及额度">
            <when id="prcRefundCustac" test="acsetp2 == #dict.BaseEnumType.E_ACSETP().SA || acsetp2 == #dict.BaseEnumType.E_ACSETP().MA" longname="结算户或钱包退货">
                <service mappingToProperty="false" serviceName="IoCaSevAccountLimit.IoAcRevQuota" id="chkAndSub" test="chkqtn.isckqt == #dict.BaseEnumType.E_YES___().YES" longname="电子账户额度恢复">
                    <in_mappings by_interface="true">
                        <mapping src="accttp" dest="accttp" desc="账户分类" by_interface="true" on_top="true"/>
                        <mapping src="chkqtn.aclmfg" dest="aclmfg" desc="累计限额标志" by_interface="true" on_top="true"/>
                        <mapping src="chkqtn.authtp" dest="authtp" desc="认证方式" by_interface="true" on_top="true"/>
                        <mapping src="brchno" dest="brchno" desc="机构号" by_interface="true" on_top="true"/>
                        <mapping src="custac" dest="custac" desc="电子账号" by_interface="true" on_top="true"/>
                        <mapping src="chkqtn.custid" dest="custid" desc="客户id" by_interface="true" on_top="true"/>
                        <mapping src="chkqtn.custlv" dest="custlv" desc="客户等级" by_interface="true" on_top="true"/>
                        <mapping src="chkqtn.acctrt" dest="acctrt" desc="客户类型" by_interface="true" on_top="true"/>
                        <mapping src="chkqtn.limttp" dest="limttp" desc="额度类型" by_interface="true" on_top="true"/>
                        <mapping src="chkqtn.pytltp" dest="pytltp" desc="支付工具" by_interface="true" on_top="true"/>
                        <mapping src="chkqtn.rebktp" dest="rebktp" desc="收款行范围" by_interface="true" on_top="true"/>
                        <mapping src="chkqtn.risklv" dest="risklv" desc="风险承受等级" by_interface="true" on_top="true"/>
                        <mapping src="chkqtn.sbactp" dest="sbactp" desc="子账户类型" by_interface="true" on_top="true"/>
                        <mapping src="servdt" dest="servdt" desc="渠道交易日期" by_interface="true" on_top="true"/>
                        <mapping src="servsq" dest="servsq" desc="渠道流水" by_interface="true" on_top="true"/>
                        <mapping src="servtp" dest="servtp" desc="渠道" by_interface="true" on_top="true"/>
                        <mapping src="retram" dest="tranam" desc="交易金额" by_interface="true" on_top="true"/>
                    </in_mappings>
                    <out_mappings by_interface="true"/>
                </service>
            </when>
        </case>
        <service serviceName="DpAcctSvcType.addPostAcctDp" id="addPostAcctDp" longname="电子账户存入">
            <in_mappings by_interface="true">
                <mapping src="acctno" dest="cplSaveAcctIn.acctno" desc="负债账号" by_interface="true" on_top="true"/>
                <mapping src="acseno" dest="cplSaveAcctIn.acseno" desc="子账户序号" by_interface="true" on_top="true"/>
                <mapping src="cardno" dest="cplSaveAcctIn.cardno" desc="卡号" by_interface="true" on_top="true"/>
                <mapping src="crcycd" dest="cplSaveAcctIn.crcycd" desc="币种" by_interface="true" on_top="true"/>
                <mapping src="custac" dest="cplSaveAcctIn.custac" desc="电子账号" by_interface="true" on_top="true"/>
                <mapping src="retram" dest="cplSaveAcctIn.tranam" desc="交易金额" by_interface="true" on_top="true"/>
                <mapping src="smrycd" dest="cplSaveAcctIn.smrycd" desc="摘要码" by_interface="true" on_top="true"/>
            </in_mappings>
            <out_mappings by_interface="true"/>
        </service>
        <service serviceName="IoInAccount.IoInAcdr" id="ioInAccr" longname="内部户借方记账">
            <in_mappings by_interface="true">
                <mapping src="busino" dest="input.busino" desc="业务编号" by_interface="true" on_top="true"/>
                <mapping src="crcycd" dest="input.crcycd" desc="币种" by_interface="true" on_top="true"/>
                <mapping src="smrycd" dest="input.smrycd" desc="摘要码" by_interface="true" on_top="true"/>
                <mapping src="retram" dest="input.tranam" desc="交易金额" by_interface="true" on_top="true"/>
                <mapping src="acbrch" dest="input.acbrch" desc="机构号" by_interface="true" on_top="true"/>
                <mapping src="subsac" dest="input.subsac" desc="子户号" by_interface="true" on_top="true"/>
            </in_mappings>
            <out_mappings by_interface="true"/>
        </service>
        <service mappingToProperty="false" serviceName="IoSaveIoTransBill.AccConsume" id="accConsume" longname="消费登记薄登记">
            <in_mappings by_interface="true">
                <mapping src="acctnm" dest="acctnm" desc="客户名称" by_interface="true" on_top="true"/>
                <mapping src="acesno" dest="acesno" desc="子账号" by_interface="true" on_top="true"/>
                <mapping src="acsetp2" dest="acsetp" desc="子账号类型" by_interface="true" on_top="true"/>
                <mapping src="busino" dest="busino" desc="业务编号" by_interface="true" on_top="true"/>
                <mapping src="cardno" dest="cardno" desc="卡号" by_interface="true" on_top="true"/>
                <mapping src="chckdt" dest="chckdt" desc="对账日期" by_interface="true" on_top="true"/>
                <mapping src="crcycd" dest="crcycd" desc="币种" by_interface="true" on_top="true"/>
                <mapping src="cardno" dest="incard" desc="收款方卡号/账号" by_interface="true" on_top="true"/>
                <mapping src="incorp" dest="incorp" desc="收款方法人代码" by_interface="true" on_top="true"/>
                <mapping src="keepdt" dest="keepdt" desc="清算日期" by_interface="true" on_top="true"/>
                <mapping src="mercdt" dest="mercdt" desc="商户交易日期" by_interface="true" on_top="true"/>
                <mapping src="mercnm" dest="mercnm" desc="商户号" by_interface="true" on_top="true"/>
                <mapping src="mercsq" dest="mercsq" desc="商户交易流水" by_interface="true" on_top="true"/>
                <mapping src="merctm" dest="merctm" desc="商户交易时间" by_interface="true" on_top="true"/>
                <mapping src="chkqtn.sbactp" dest="sbactp" desc="子账户类型" by_interface="true" on_top="true"/>
                <mapping src="spettp" dest="spettp" desc="电子账户消费类型" by_interface="true" on_top="true"/>
                <mapping src="retram" dest="tranam" desc="交易金额" by_interface="true" on_top="true"/>
                <mapping src="remrdt" dest="trandt" desc="交易日期" by_interface="true" on_top="true"/>
                <mapping src="servsq" dest="transq" desc="主交易流水" by_interface="true" on_top="true"/>
                <mapping src="retrsq" dest="retrsq" desc="原平台支付流水" by_interface="true" on_top="true"/>
                <mapping src="retrdt" dest="retrdt" desc="原平台支付日期" by_interface="true" on_top="true"/>
            </in_mappings>
            <out_mappings by_interface="true">
                <mapping src="mntrdt" dest="mntrdt" desc="交易日期" by_interface="true" on_top="true"/>
                <mapping src="mntrsq" dest="mntrsq" desc="主交易流水" by_interface="true" on_top="true"/>
                <mapping src="mntrtm" dest="mntrtm" desc="交易时间" by_interface="true" on_top="true"/>
            </out_mappings>
        </service>
        <method method="chkTransAfter" id="chkTransAfter" longname="交易后处理"/>
    </flow>
</flowtran>
