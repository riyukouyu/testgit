<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<sqls id="CustInfoCountSql" longname="客户信息统计" package="cn.sunline.ltts.busi.dp.namedsql" xsi:noNamespaceSchemaLocation="ltts-model.xsd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <select cache="none" method="selectOne" type="sql" id="selCountAccttp" longname="统计客户账户分类信息">
        <sql type="mysql" desc="统计1、2、3类客户账户"><![CDATA[select  
sum(case when accttp=1 then 1 else 0 end) as global ,
sum(case when accttp=2 then 1 else 0 end) as financ ,
sum(case when accttp=3 then 1 else 0 end) as wallet 
from kna_cust where corpno=#corpno#]]></sql>
        <sql type="oracle"><![CDATA[select  
sum(case when accttp=1 then 1 else 0 end) as global ,
sum(case when accttp=2 then 1 else 0 end) as financ ,
sum(case when accttp=3 then 1 else 0 end) as wallet 
from kna_cust where corpno=#corpno#]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="corpno" ref="LnDict.LNF.corpno" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
        </parameterMap>
        <resultMap class="CustInfoCountType.CountAccttp"/>
    </select>
    <select cache="none" method="selectAll" type="sql" id="selCountAgeGroup" longname="统计客户年龄段信息">
        <sql type="mysql"><![CDATA[select 
sum(case when t.age<18 then 1 else 0 end) as agegp1 ,
sum(case when t.age between 18 and 25 then 1 else 0 end) as agegp2 ,
sum(case when t.age between 26 and 35 then 1 else 0 end) as agegp3 ,
sum(case when t.age between 36 and 45 then 1 else 0 end) as agegp4 ,
sum(case when t.age between 46 and 55 then 1 else 0 end) as agegp5 ,
sum(case when t.age between 56 and 65 then 1 else 0 end) as agegp6 ,
sum(case when t.age >65 then 1 else 0 end) as agegp7 
from 
(select TIMESTAMPDIFF(year, birthd, curdate()) age from cif_cust where corpno=#corpno#) t]]></sql>
        <sql type="oracle"><![CDATA[select 
sum(case when t.age<18 then 1 else 0 end) as agegp1 ,
sum(case when t.age between 18 and 25 then 1 else 0 end) as agegp2 ,
sum(case when t.age between 26 and 35 then 1 else 0 end) as agegp3 ,
sum(case when t.age between 36 and 45 then 1 else 0 end) as agegp4 ,
sum(case when t.age between 46 and 55 then 1 else 0 end) as agegp5 ,
sum(case when t.age between 56 and 65 then 1 else 0 end) as agegp6 ,
sum(case when t.age >65 then 1 else 0 end) as agegp7 
from 
(select TIMESTAMPDIFF(year, birthd, curdate()) age from cif_cust where corpno=#corpno#) t]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="corpno" ref="BaseDict.Comm.corpno" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
        </parameterMap>
        <resultMap class="CustInfoCountType.CountAgeGroup"/>
    </select>
    <select cache="none" method="selectAll" type="sql" id="selCountAccttpThisYear" longname="统计本年度账户分类信息">
        <sql type="mysql"><![CDATA[select 
accttp as accttp, 
sum(case when month(opendt)=1 then 1 else 0 end) as month1  ,
sum(case when month(opendt)=2 then 1 else 0 end) as month2  ,
sum(case when month(opendt)=3 then 1 else 0 end) as month3 , 
sum(case when month(opendt)=4 then 1 else 0 end) as month4 ,
sum(case when month(opendt)=5 then 1 else 0 end) as month5 ,
sum(case when month(opendt)=6 then 1 else 0 end) as month6 ,
sum(case when month(opendt)=7 then 1 else 0 end) as month7 ,
sum(case when month(opendt)=8 then 1 else 0 end) as month8 ,
sum(case when month(opendt)=9 then 1 else 0 end) as month9 ,
sum(case when month(opendt)=10 then 1 else 0 end) as mont10 ,
sum(case when month(opendt)=11 then 1 else 0 end) as mont11 ,
sum(case when month(opendt)=12 then 1 else 0 end) as mont12 
from kna_cust where corpno=#corpno# and year(opendt)=year(now()) GROUP BY accttp ORDER BY accttp asc]]></sql>
        <sql type="oracle"><![CDATA[select 
accttp as accttp, 
sum(case when month(opendt)=1 then 1 else 0 end) as month1  ,
sum(case when month(opendt)=2 then 1 else 0 end) as month2  ,
sum(case when month(opendt)=3 then 1 else 0 end) as month3 , 
sum(case when month(opendt)=4 then 1 else 0 end) as month4 ,
sum(case when month(opendt)=5 then 1 else 0 end) as month5 ,
sum(case when month(opendt)=6 then 1 else 0 end) as month6 ,
sum(case when month(opendt)=7 then 1 else 0 end) as month7 ,
sum(case when month(opendt)=8 then 1 else 0 end) as month8 ,
sum(case when month(opendt)=9 then 1 else 0 end) as month9 ,
sum(case when month(opendt)=10 then 1 else 0 end) as mont10 ,
sum(case when month(opendt)=11 then 1 else 0 end) as mont11 ,
sum(case when month(opendt)=12 then 1 else 0 end) as mont12 
from kna_cust where corpno=#corpno# and year(opendt)=year(now()) GROUP BY accttp ORDER BY accttp asc]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="corpno" ref="BaseDict.Comm.corpno" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
        </parameterMap>
        <resultMap class="CustInfoCountType.CountAccttpThisYear"/>
    </select>
</sqls>
