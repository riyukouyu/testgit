<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<sqls id="DpAcin" longname="存款利息相关SQL" package="cn.sunline.ltts.busi.dp.namedsql" xsi:noNamespaceSchemaLocation="ltts-model.xsd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <select cache="none" method="selectAll" type="sql" id="listKnbPidlBetweenDraw" longname="获取两次提前支取间的结息金额">
        <sql><![CDATA[
    	select
    	    	a.* 
    	from
    	    	knb_pidl a 
    	where
    	    	a.lsinoc = 'POSTING' and a.acctno = #acctno# 
    	    	and indxno > (
    	    	    	select
    	    	    	    	max(indxno) 
    	    	    	from
    	    	    	    	knb_pidl b 
    	    	    	where
    	    	    	    	b.lsinoc = 'HEAD' and b.acctno = #acctno# 
    	    	)
    	]]></sql>
        <sql type="oracle"><![CDATA[
    	select
    	    	a.* 
    	from
    	    	knb_pidl a 
    	where
    	    	a.lsinoc = 'POSTING' and a.acctno = #acctno# 
    	    	and indxno > (
    	    	    	select
    	    	    	    	max(indxno) 
    	    	    	from
    	    	    	    	knb_pidl b 
    	    	    	where
    	    	    	    	b.lsinoc = 'HEAD' and b.acctno = #acctno# 
    	    	)
    	]]></sql>
        <sql type="mysql"><![CDATA[
    	select
    	    	a.* 
    	from
    	    	knb_pidl a 
    	where
    	    	a.lsinoc = 'POSTING' and a.acctno = #acctno# 
    	    	and indxno > (
    	    	    	select
    	    	    	    	max(indxno) 
    	    	    	from
    	    	    	    	knb_pidl b 
    	    	    	where
    	    	    	    	b.lsinoc = 'HEAD' and b.acctno = #acctno# 
    	    	)
    	]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="acctno" ref="DpDict.Acct.acctno" jdbcType="VARCHAR" javaType="BaseType.U_ACCTNO" mode="in" longname="负债帐号" parameterType="condition"/>
        </parameterMap>
        <resultMap class="DpDepoInst.KnbPidl"/>
    </select>
    <select cache="none" method="selectFirst" type="sql" id="selknbPidlByAcctnoPyindt" longname="根据负债账号及日期查询结息明细">
        <sql type="db2"><![CDATA[select * from knb_pidl a where a.acctno = #acctno# and pyindt = #pyindt# 
order by detlsq desc]]></sql>
        <sql type="oracle"><![CDATA[select * from knb_pidl a where a.acctno = #acctno# and pyindt = #pyindt# 
order by detlsq desc]]></sql>
        <sql type="mysql"><![CDATA[select * from knb_pidl a where a.acctno = #acctno# and pyindt = #pyindt# 
order by detlsq desc]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="acctno" ref="DpDict.Acct.acctno" jdbcType="VARCHAR" javaType="BaseType.U_ACCTNO" mode="in" longname="负债账号" parameterType="condition"/>
            <parameter property="pyindt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="付息日期" parameterType="condition"/>
        </parameterMap>
        <resultMap class="IoDpTable.IoDpKnbPidl"/>
    </select>
    <select cache="none" method="selectAll" type="sql" id="listKnbPidlDraw" longname="获取结息金额">
        <sql><![CDATA[
        select
                a.* 
        from
                knb_pidl a 
        where
                a.lsinoc = 'POSTING' and a.acctno = #acctno# 
        ]]></sql>
        <sql type="oracle"><![CDATA[
        select
                a.* 
        from
                knb_pidl a 
        where
                a.lsinoc = 'POSTING' and a.acctno = #acctno# 
        ]]></sql>
        <sql type="mysql"><![CDATA[
        select
                a.* 
        from
                knb_pidl a 
        where
                a.lsinoc = 'POSTING' and a.acctno = #acctno# 
        ]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="acctno" ref="DpDict.Acct.acctno" jdbcType="VARCHAR" javaType="BaseType.U_ACCTNO" mode="in" longname="负债帐号" parameterType="condition"/>
        </parameterMap>
        <resultMap class="DpDepoInst.KnbPidl"/>
    </select>
    <select cache="none" method="selectAll" type="sql" id="listKnbIndl" longname="获取分段利率">
        <sql><![CDATA[
    	select
    	    	a.* 
    	from
    	    	knb_indl a 
    	where
    	    	a.acctno = #acctno# and intrtp = #intrtp# 
    	    	and instdt >= #instdt# and ineddt <= #ineddt# 
    	order by
    	    	a.indxno 
    	]]></sql>
        <sql type="oracle"><![CDATA[
    	select
    	    	a.* 
    	from
    	    	knb_indl a 
    	where
    	    	a.acctno = #acctno# and intrtp = #intrtp# 
    	    	and instdt >= #instdt# and ineddt <= #ineddt# 
    	order by
    	    	a.indxno 
    	]]></sql>
        <sql type="mysql"><![CDATA[
    	select
    	    	a.* 
    	from
    	    	knb_indl a 
    	where
    	    	a.acctno = #acctno# and intrtp = #intrtp# 
    	    	and instdt >= #instdt# and ineddt <= #ineddt# 
    	order by
    	    	a.indxno 
    	]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="acctno" ref="DpDict.Acct.acctno" jdbcType="VARCHAR" javaType="BaseType.U_ACCTNO" mode="in" longname="负债帐号" parameterType="condition"/>
            <parameter property="intrtp" ref="DpDict.Prod.intrtp" jdbcType="VARCHAR" javaType="DpEnumType.E_INTRTP" mode="in" longname="利率类型" parameterType="condition"/>
            <parameter property="instdt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="计息起始日期" parameterType="condition"/>
            <parameter property="ineddt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="计息终止日期" parameterType="condition"/>
        </parameterMap>
        <resultMap class="DpDepoInst.KnbIndl"/>
    </select>
    <dynamicSelect cache="none" method="selectPageWithCount" type="sql" id="selKnbCbdlFixInfo" longname="分页查询计提利息调整信息">
        <parameterMap class="java.util.Map">
            <parameter property="corpno" ref="ApDict.Aplt.corpno" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
            <parameter property="cabrdt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="计提日期" parameterType="condition"/>
            <parameter property="acctno" ref="DpDict.Acct.acctno" jdbcType="VARCHAR" javaType="BaseType.U_ACCTNO" mode="in" longname="负债账号" parameterType="condition"/>
            <parameter property="brchno" ref="DpDict.Acct.brchno" jdbcType="VARCHAR" javaType="BaseType.U_BRCHNO" mode="in" longname="账户所属机构" parameterType="condition"/>
            <parameter property="acctcd" ref="DpDict.Prod.acctcd" jdbcType="VARCHAR" javaType="BaseType.U_DTITCD" mode="in" longname="核算代码" parameterType="condition"/>
            <parameter property="crcycd" ref="DpDict.Acct.crcycd" jdbcType="VARCHAR" javaType="BaseType.U_CRCYCD" mode="in" longname="货币代号" parameterType="condition"/>
            <parameter property="prodcd" ref="DpDict.Prod.prodcd" jdbcType="VARCHAR" javaType="BaseType.U_PRODCD" mode="in" longname="产品编号" parameterType="condition"/>
            <parameter property="adjttp" jdbcType="VARCHAR" javaType="BaseType.U_CHAR08" mode="in" longname="利息调整方式" parameterType="condition"/>
            <parameter property="dealst" jdbcType="VARCHAR" javaType="BaseType.U_CHAR08" mode="in" longname="处理状态" parameterType="condition"/>
        </parameterMap>
        <resultMap class="IoDpTable.KnbCbdlFixInfo"/>
        <dynamicSql type="oracle">
            <str type="Str"><![CDATA[select * from knb_cbdl_fix]]></str>
            <where type="Where">
                <and type="And">
                    <if test="corpno!=null &amp;&amp; corpno!=&quot;&quot;" type="If">
                        <str type="Str"><![CDATA[corpno = #corpno#]]></str>
                    </if>
                    <if test="cabrdt!=null &amp;&amp; cabrdt!=&quot;&quot;" type="If">
                        <str type="Str"><![CDATA[cabrdt = #cabrdt#]]></str>
                    </if>
                    <if test="acctno!=null &amp;&amp; acctno!=&quot;&quot;" type="If">
                        <str type="Str"><![CDATA[acctno = #acctno#]]></str>
                    </if>
                    <if test="crcycd!=null &amp;&amp; crcycd!=&quot;&quot;" type="If">
                        <str type="Str"><![CDATA[crcycd = #crcycd#]]></str>
                    </if>
                    <if test="brchno!=null &amp;&amp; brchno!=&quot;&quot;" type="If">
                        <str type="Str"><![CDATA[brchno = #brchno#]]></str>
                    </if>
                    <if test="prodcd!=null &amp;&amp; prodcd!=&quot;&quot;" type="If">
                        <str type="Str"><![CDATA[prodcd = #prodcd#]]></str>
                    </if>
                    <if test="acctcd!=null &amp;&amp; acctcd!=&quot;&quot;" type="If">
                        <str type="Str"><![CDATA[acctcd = #acctcd#]]></str>
                    </if>
                    <if test="adjttp!=null &amp;&amp; adjttp!=&quot;&quot;" type="If">
                        <str type="Str"><![CDATA[adjttp = #adjttp#]]></str>
                    </if>
                    <if test="dealst!=null &amp;&amp; dealst!=&quot;&quot;" type="If">
                        <str type="Str"><![CDATA[dealst = #dealst#]]></str>
                    </if>
                </and>
            </where>
        </dynamicSql>
        <dynamicSql type="mysql">
            <str type="Str"><![CDATA[select * from knb_cbdl_fix]]></str>
            <where type="Where">
                <and type="And">
                    <if test="corpno!=null &amp;&amp; corpno!=&quot;&quot;" type="If">
                        <str type="Str"><![CDATA[corpno = #corpno#]]></str>
                    </if>
                    <if test="cabrdt!=null &amp;&amp; cabrdt!=&quot;&quot;" type="If">
                        <str type="Str"><![CDATA[cabrdt = #cabrdt#]]></str>
                    </if>
                    <if test="acctno!=null &amp;&amp; acctno!=&quot;&quot;" type="If">
                        <str type="Str"><![CDATA[acctno = #acctno#]]></str>
                    </if>
                    <if test="crcycd!=null &amp;&amp; crcycd!=&quot;&quot;" type="If">
                        <str type="Str"><![CDATA[crcycd = #crcycd#]]></str>
                    </if>
                    <if test="brchno!=null &amp;&amp; brchno!=&quot;&quot;" type="If">
                        <str type="Str"><![CDATA[brchno = #brchno#]]></str>
                    </if>
                    <if test="prodcd!=null &amp;&amp; prodcd!=&quot;&quot;" type="If">
                        <str type="Str"><![CDATA[prodcd = #prodcd#]]></str>
                    </if>
                    <if test="acctcd!=null &amp;&amp; acctcd!=&quot;&quot;" type="If">
                        <str type="Str"><![CDATA[acctcd = #acctcd#]]></str>
                    </if>
                    <if test="adjttp!=null &amp;&amp; adjttp!=&quot;&quot;" type="If">
                        <str type="Str"><![CDATA[adjttp = #adjttp#]]></str>
                    </if>
                    <if test="dealst!=null &amp;&amp; dealst!=&quot;&quot;" type="If">
                        <str type="Str"><![CDATA[dealst = #dealst#]]></str>
                    </if>
                </and>
            </where>
        </dynamicSql>
    </dynamicSelect>
    <select cache="none" method="selectOne" type="sql" id="selKnbCbdlFixCabrin" longname="查询调整利息登记簿">
        <sql type="mysql"><![CDATA[
		select sum(case when adjttp = '1' then cabrin else -1*cabrin end) from knb_cbdl_fix 
		where 
		corpno = #corpno# 
		and acctno = #acctno#
		and cabrdt < #cabrdt# 
		and brchno = #brchno# 
		and acctcd = #acctcd# 
		and crcycd = #crcycd# 
		and prodcd = #prodcd# 
		and dealst = '0'
		group by acctno
		]]></sql>
        <sql type="oracle"><![CDATA[
		select sum(case when adjttp = '1' then cabrin else -1*cabrin end) from knb_cbdl_fix 
		where 
		corpno = #corpno# 
		and acctno = #acctno#
		and cabrdt < #cabrdt# 
		and brchno = #brchno# 
		and acctcd = #acctcd# 
		and crcycd = #crcycd# 
		and prodcd = #prodcd# 
		and dealst = '0'
		group by acctno
		]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="corpno" ref="ApDict.Aplt.corpno" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
            <parameter property="cabrdt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="计提日期" parameterType="condition"/>
            <parameter property="acctno" ref="DpDict.Acct.acctno" jdbcType="VARCHAR" javaType="BaseType.U_ACCTNO" mode="in" longname="负债账号" parameterType="condition"/>
            <parameter property="brchno" ref="DpDict.Acct.brchno" jdbcType="VARCHAR" javaType="BaseType.U_BRCHNO" mode="in" longname="账户所属机构" parameterType="condition"/>
            <parameter property="acctcd" ref="DpDict.Prod.acctcd" jdbcType="VARCHAR" javaType="BaseType.U_DTITCD" mode="in" longname="核算代码" parameterType="condition"/>
            <parameter property="crcycd" ref="DpDict.Acct.crcycd" jdbcType="VARCHAR" javaType="BaseType.U_CRCYCD" mode="in" longname="货币代号" parameterType="condition"/>
            <parameter property="prodcd" ref="DpDict.Prod.prodcd" jdbcType="VARCHAR" javaType="BaseType.U_PRODCD" mode="in" longname="产品编号" parameterType="condition"/>
        </parameterMap>
        <resultMap class="double"/>
    </select>
    <update method="update" id="updKnbCbdlFixStatus" longname="更新调整利息登记簿处理状态">
        <sql type="mysql"><![CDATA[
			update knb_cbdl_fix set dealst = 1  
			where 
			corpno = #corpno# 
			and acctno = #acctno# 
			and cabrdt < #cabrdt# 
			and crcycd = #crcycd# 
			and prodcd = #prodcd# 
			and dealst = '0'
		]]></sql>
        <sql type="oracle"><![CDATA[
			update knb_cbdl_fix set dealst = 1  
			where 
			corpno = #corpno# 
			and acctno = #acctno# 
			and cabrdt < #cabrdt# 
			and crcycd = #crcycd# 
			and prodcd = #prodcd# 
			and dealst = '0'
		]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="corpno" ref="ApDict.Aplt.corpno" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
            <parameter property="cabrdt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="计提日期" parameterType="condition"/>
            <parameter property="acctno" ref="DpDict.Acct.acctno" jdbcType="VARCHAR" javaType="BaseType.U_ACCTNO" mode="in" longname="负债账号" parameterType="condition"/>
            <parameter property="crcycd" ref="DpDict.Acct.crcycd" jdbcType="VARCHAR" javaType="BaseType.U_CRCYCD" mode="in" longname="货币代号" parameterType="condition"/>
            <parameter property="prodcd" ref="DpDict.Prod.prodcd" jdbcType="VARCHAR" javaType="BaseType.U_PRODCD" mode="in" longname="产品编号" parameterType="condition"/>
        </parameterMap>
    </update>
    <dynamicSelect cache="none" method="selectPageWithCount" type="sql" id="selIntxInfo" longname="查询利息税信息">
        <parameterMap class="java.util.Map">
            <parameter property="corpno" ref="ApDict.Aplt.corpno" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
            <parameter property="intxcd" ref="PbDict.Intr.intxcd" jdbcType="VARCHAR" javaType="BaseType.U_TXRTNO" mode="in" longname="税率代码" parameterType="condition"/>
            <parameter property="efctdt" ref="PbDict.Intr.efctdt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="生效日期" parameterType="condition"/>
        </parameterMap>
        <resultMap class="DpInterestType.KupIntxInfo"/>
        <dynamicSql type="oracle">
            <str type="Str"><![CDATA[select * from kup_intx]]></str>
            <where type="Where">
                <and type="And">
                    <if test="corpno!=null &amp;&amp; corpno!=&quot;&quot;" type="If">
                        <str type="Str"><![CDATA[corpno = #corpno#]]></str>
                    </if>
                    <if test="intxcd!=null &amp;&amp; intxcd!=&quot;&quot;" type="If">
                        <str type="Str"><![CDATA[intxcd = #intxcd#]]></str>
                    </if>
                    <if test="efctdt!=null &amp;&amp; efctdt!=&quot;&quot;" type="If">
                        <str type="Str"><![CDATA[efctdt = #efctdt#]]></str>
                    </if>
                </and>
            </where>
        </dynamicSql>
        <dynamicSql type="mysql">
            <str type="Str"><![CDATA[select * from kup_intx]]></str>
            <where type="Where">
                <and type="And">
                    <if test="corpno!=null &amp;&amp; corpno!=&quot;&quot;" type="If">
                        <str type="Str"><![CDATA[corpno = #corpno#]]></str>
                    </if>
                    <if test="intxcd!=null &amp;&amp; intxcd!=&quot;&quot;" type="If">
                        <str type="Str"><![CDATA[intxcd = #intxcd#]]></str>
                    </if>
                    <if test="efctdt!=null &amp;&amp; efctdt!=&quot;&quot;" type="If">
                        <str type="Str"><![CDATA[efctdt = #efctdt#]]></str>
                    </if>
                </and>
            </where>
        </dynamicSql>
    </dynamicSelect>
</sqls>
