<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<flowtran id="borled" longname="通用记账接口（处理多借一贷）" kind="maintain" package="cn.sunline.ltts.busi.intran.trans" xsi:noNamespaceSchemaLocation="ltts-model.xsd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <interface package="cn.sunline.ltts.busi.intran.trans.intf">
        <input packMode="true">
            <field id="crcycd" type="BaseType.U_CRCYCD" required="false" multi="false" array="false" longname="币种" ref="PbDict.Intr.crcycd"/>
            <field id="totlam" type="BaseType.U_ACBLTP" required="false" multi="false" array="false" longname="交易总金额"/>
            <field id="toacct" type="BaseType.U_ACCTNO" required="false" multi="false" array="false" longname="对方帐号"/>
            <field id="quotfs" type="BaseEnumType.E_YES___" required="false" default="1" multi="false" array="false" longname="交易金额大于零标志" desc="默认大于零"/>
            <field id="dscrtx" type="BaseType.U_CHAR200" required="false" multi="false" array="false" longname="描述"/>
            <field id="drInfoList" type="InAcctTranOut.BorlenListIN" required="false" multi="true" array="false" longname="内部户账户信息"/>
            <field id="paydListInfoSecond" type="InAcctTranOut.PaydListSecond" required="false" multi="true" array="false" longname="销账明细2"/>
            <field id="payaListInfoSecond" type="InAcctTranOut.PayaListSecond" required="false" multi="true" array="false" longname="挂账明细2"/>
        </input>
        <output asParm="true" packMode="true">
            <field id="acctno" type="BaseType.U_CHAR35" required="false" multi="false" array="false" longname="账号"/>
            <field id="tranam" type="BaseType.U_TRANAM" required="false" multi="false" array="false" longname="交易金额"/>
            <field id="crctbl" type="BaseType.U_TRANAM" required="false" multi="false" array="false" longname="贷方余额"/>
            <field id="drctbl" type="BaseType.U_TRANAM" required="false" multi="false" array="false" longname="借方余额"/>
            <field id="blncdn" type="InEnumType.E_BLNCDN" required="false" multi="false" array="false" longname="交易后余额方向"/>
            <field id="acctna" type="BaseType.U_ACCTNA" required="false" multi="false" array="false" longname="内部户名称" ref="InDict.inac.acctna"/>
            <field id="subsac" type="BaseType.U_CUACNO" required="false" multi="false" array="false" longname="子户号" ref="InDict.inac.subsac"/>
            <field id="mtrasq" type="BaseType.U_SEQUNO" required="false" multi="false" array="false" longname="请求流水"/>
            <field id="busisq" type="BaseType.U_SEQUNO" required="false" multi="false" array="false" longname="业务跟踪号"/>
            <field id="pckgsq" type="BaseType.U_SEQUNO" required="false" multi="false" array="false" longname="报文流水"/>
        </output>
        <property packMode="true">
            <field id="drsize" type="BaseType.U_DCMTLT" required="false" multi="false" array="false" longname="循环个数"/>
            <field id="counts" type="BaseType.U_DCMTLT" required="false" multi="false" array="false" longname="计数器"/>
            <field id="acctno" type="BaseType.U_CHAR35" required="false" multi="false" array="false" longname="账号"/>
            <field id="tranam" type="BaseType.U_ACBLTP" required="false" multi="false" array="false" longname="交易金额" ref="InDict.inac.tranam"/>
            <field id="brchno" type="BaseType.U_BRCHNO" required="false" multi="false" array="false" longname="转出方机构号"/>
            <field id="custno" type="BaseType.U_CUSTNO" required="false" multi="false" array="false" longname="转出方客户号"/>
            <field id="accatp" type="BaseEnumType.E_ACCATP" required="false" multi="false" array="false" longname="子账户区分类型"/>
            <field id="isinac" type="BaseEnumType.E_YES___" required="false" multi="false" array="false" longname="是否内部户"/>
            <field id="toisin" type="BaseEnumType.E_YES___" required="false" multi="false" array="false" longname="对方账户是否内部户"/>
            <field id="cardno" type="BaseType.U_CARDNO" required="false" multi="false" array="false" longname="凭证号码"/>
            <field id="custac" type="BaseType.U_CUACNO" required="false" multi="false" array="false" longname="电子账号"/>
            <field id="acesno" type="BaseType.U_CUACNO" required="false" multi="false" array="false" longname="子户号"/>
            <field id="deptno" type="BaseType.U_ACCTNO" required="false" multi="false" array="false" longname="负债账号"/>
            <field id="custna" type="BaseType.U_ACCTNA" required="false" multi="false" array="false" longname="客户名称"/>
            <field id="tocardno" type="BaseType.U_CARDNO" required="false" multi="false" array="false" longname="凭证号码"/>
            <field id="tocustac" type="BaseType.U_CUACNO" required="false" multi="false" array="false" longname="电子账号"/>
            <field id="toacesno" type="BaseType.U_CUACNO" required="false" multi="false" array="false" longname="子户号"/>
            <field id="todeptno" type="BaseType.U_ACCTNO" required="false" multi="false" array="false" longname="负债账号"/>
            <field id="tocustna" type="BaseType.U_ACCTNA" required="false" multi="false" array="false" longname="客户名称"/>
            <field id="acctna" type="BaseType.U_ACCTNA" required="false" multi="false" array="false" longname="内部户帐号名称"/>
            <field id="subsac" type="BaseType.U_CUACNO" required="false" multi="false" array="false" longname="子户号"/>
            <field id="toacctna" type="BaseType.U_ACCTNA" required="false" multi="false" array="false" longname="对方账户名"/>
            <field id="tosubsac" type="BaseType.U_CUACNO" required="false" multi="false" array="false" longname="对方子账户"/>
            <field id="inptsr" type="InEnumType.E_INPTSR" required="false" multi="false" array="false" longname="交易来源类别" ref="InDict.inac.inptsr"/>
            <field id="linkno" type="BaseType.U_CHAR40" required="false" multi="false" array="false" longname="连笔号"/>
            <field id="payaListFirst" type="InacTransComplex.IaPayaDetail" required="false" multi="true" array="false" longname="挂账明细1"/>
            <field id="payaListSecond" type="InacTransComplex.IaPayaDetail" required="false" multi="true" array="false" longname="挂账明细2"/>
            <field id="paydListFirst" type="InacTransComplex.IaPaydDetail" required="false" multi="true" array="false" longname="销账明细1"/>
            <field id="paydListSecond" type="InacTransComplex.IaPaydDetail" required="false" multi="true" array="false" longname="销账明细2"/>
            <field id="crosbr" type="BaseEnumType.E_YES___" required="false" multi="false" array="false" longname="是否跨机构"/>
        </property>
        <printer packMode="false"/>
    </interface>
    <flow>
        <method method="BeforeTransferCheck" id="BeforeTransferCheck" longname="交易前检查" desc="交易前检查： 1、借方贷方账户不能相同 2、判断账户类型"/>
        <loop mode="times" id="drInfoList" test="drsize" longname="借方账户遍历记账">
            <method method="getDrInfo" id="getDrInfo" longname="获取账户信息" desc="根据循环次数获取账户信息"/>
            <case id="IaacdrCheck" longname="借方账户判断" desc="借方账户判断： 以“9”开头为内部户帐号 其他暂认为存款帐号">
                <when id="DrIsInac" test="isinac==#dict.BaseEnumType.E_YES___().YES" longname="为内部户" desc="为内部户">
                    <service mappingToProperty="false" serviceName="IoInAccount.IoInAcdr" id="ioinacdr" longname="调账借方交易" desc="调账借方交易">
                        <in_mappings by_interface="true">
                            <mapping src="acctno" dest="input.acctno" by_interface="true" on_top="true"/>
                            <mapping src="crcycd" dest="input.crcycd" by_interface="true" on_top="true"/>
                            <mapping src="toacct" dest="input.toacct" by_interface="true" on_top="true"/>
                            <mapping src="toacctna" dest="input.toacna" by_interface="true" on_top="true"/>
                            <mapping src="tosubsac" dest="input.tosbac" by_interface="true" on_top="true"/>
                            <mapping src="tranam" dest="input.tranam" by_interface="true" on_top="true"/>
                            <mapping src="acctna" dest="input.acctna" by_interface="true" on_top="true"/>
                            <mapping src="dscrtx" dest="input.dscrtx" by_interface="true" on_top="true"/>
                            <mapping src="payaListFirst" dest="input.payadetail" desc="description" by_interface="true" on_top="true"/>
                            <mapping src="paydListFirst" dest="input.payddetail" desc="description" by_interface="true" on_top="true"/>
                            <mapping src="inptsr" dest="input.inptsr" desc="description" by_interface="true" on_top="true"/>
                        </in_mappings>
                        <out_mappings by_interface="true">
                            <mapping src="output.acctno" dest="acctno" by_interface="true" on_top="true"/>
                            <mapping src="output.blncdn" dest="blncdn" by_interface="true" on_top="true"/>
                            <mapping src="output.crctbl" dest="crctbl" by_interface="true" on_top="true"/>
                            <mapping src="output.drctbl" dest="drctbl" by_interface="true" on_top="true"/>
                            <mapping src="output.tranam" dest="tranam" by_interface="true" on_top="true"/>
                        </out_mappings>
                    </service>
                </when>
                <when id="DrIsNotInac" test="isinac==#dict.BaseEnumType.E_YES___().NO" longname="不为内部户时" desc="不为内部户时">
                    <service mappingToProperty="false" serviceName="DpAcctSvcType.addDrawAcctDp" id="addDrawAcctDp" longname="存款支取服务" desc="存款支取服务">
                        <in_mappings by_interface="true">
                            <mapping src="custac" dest="cplDrawAcctIn.acseno" by_interface="true" on_top="true"/>
                            <mapping src="quotfs" dest="cplDrawAcctIn.auacfg" by_interface="true" on_top="true"/>
                            <mapping src="custac" dest="cplDrawAcctIn.custac" by_interface="true" on_top="true"/>
                            <mapping src="toacct" dest="cplDrawAcctIn.toacct" by_interface="true" on_top="true"/>
                            <mapping src="tranam" dest="cplDrawAcctIn.tranam" by_interface="true" on_top="true"/>
                            <mapping src="linkno" dest="cplDrawAcctIn.linkno" by_interface="true" on_top="true"/>
                            <mapping src="deptno" dest="cplDrawAcctIn.acctno" by_interface="true" on_top="true"/>
                            <mapping src="cardno" dest="cplDrawAcctIn.cardno" by_interface="true" on_top="true"/>
                            <mapping src="crcycd" dest="cplDrawAcctIn.crcycd" by_interface="true" on_top="true"/>
                            <mapping src="toacctna" dest="cplDrawAcctIn.opacna" by_interface="true" on_top="true"/>
                        </in_mappings>
                        <out_mappings by_interface="true"/>
                    </service>
                </when>
            </case>
        </loop>
        <method method="CrDeal" id="CrDeal" longname="贷方记账前处理" desc="贷方记账前处理"/>
        <case id="IaaccrCheck" longname="贷方帐号检查" desc="贷方交易检查">
            <when id="CrIsInac" test="toisin==#dict.BaseEnumType.E_YES___().YES" longname="贷方为内部户时" desc="贷方为内部户时">
                <service serviceName="IoInAccount.IoInAccr" id="IoInAccr" longname="调账贷方交易" desc="调账贷方交易">
                    <in_mappings by_interface="true">
                        <mapping src="toacct" dest="input.acctno" by_interface="true" on_top="true"/>
                        <mapping src="crcycd" dest="input.crcycd" by_interface="true" on_top="true"/>
                        <mapping src="acctno" dest="input.toacct" by_interface="true" on_top="true"/>
                        <mapping src="subsac" dest="input.tosbac" by_interface="true" on_top="true"/>
                        <mapping src="totlam" dest="input.tranam" by_interface="true" on_top="true"/>
                        <mapping src="acctna" dest="input.toacna" desc="description" by_interface="true" on_top="true"/>
                        <mapping src="tosubsac" dest="input.subsac" desc="description" by_interface="true" on_top="true"/>
                        <mapping src="toacctna" dest="input.acctna" desc="description" by_interface="true" on_top="true"/>
                        <mapping src="dscrtx" dest="input.dscrtx" by_interface="true" on_top="true"/>
                        <mapping src="payaListSecond" dest="input.payadetail" desc="description" by_interface="true" on_top="true"/>
                        <mapping src="paydListSecond" dest="input.payddetail" desc="description" by_interface="true" on_top="true"/>
                        <mapping src="inptsr" dest="input.inptsr" desc="description" by_interface="true" on_top="true"/>
                    </in_mappings>
                    <out_mappings by_interface="true">
                        <mapping src="output.acctna" dest="acctna" by_interface="true" on_top="true"/>
                        <mapping src="output.acctno" dest="acctno" by_interface="true" on_top="true"/>
                        <mapping src="output.blncdn" dest="blncdn" by_interface="true" on_top="true"/>
                        <mapping src="output.crctbl" dest="crctbl" by_interface="true" on_top="true"/>
                        <mapping src="output.drctbl" dest="drctbl" by_interface="true" on_top="true"/>
                        <mapping src="output.subsac" dest="subsac" by_interface="true" on_top="true"/>
                        <mapping src="output.tranam" dest="tranam" by_interface="true" on_top="true"/>
                    </out_mappings>
                </service>
            </when>
            <when id="CrIsNotInac" test="toisin==#dict.BaseEnumType.E_YES___().NO" longname="贷方不为内部户时" desc="贷方不为内部户时">
                <service mappingToProperty="false" serviceName="DpAcctSvcType.addPostAcctDp" id="addPostAcctDp" longname="存款存入交易" desc="存款存入交易">
                    <in_mappings by_interface="true">
                        <mapping src="tocardno" dest="cplSaveAcctIn.cardno" by_interface="true" on_top="true"/>
                        <mapping src="tocustac" dest="cplSaveAcctIn.custac" by_interface="true" on_top="true"/>
                        <mapping src="linkno" dest="cplSaveAcctIn.linkno" by_interface="true" on_top="true"/>
                        <mapping src="todeptno" dest="cplSaveAcctIn.acctno" by_interface="true" on_top="true"/>
                        <mapping src="toacesno" dest="cplSaveAcctIn.acseno" by_interface="true" on_top="true"/>
                        <mapping src="crcycd" dest="cplSaveAcctIn.crcycd" by_interface="true" on_top="true"/>
                        <mapping src="acctna" dest="cplSaveAcctIn.opacna" by_interface="true" on_top="true"/>
                        <mapping src="acctno" dest="cplSaveAcctIn.toacct" by_interface="true" on_top="true"/>
                        <mapping src="totlam" dest="cplSaveAcctIn.tranam" by_interface="true" on_top="true"/>
                    </in_mappings>
                    <out_mappings by_interface="true"/>
                </service>
            </when>
        </case>
        <method method="AfterTransferCheck" id="AfterTransferCheck" longname="交易后检查" desc="交易后检查： 1、检查交易平衡性"/>
    </flow>
    <outMapping/>
    <propertyToPrinterMapping/>
    <outToPrinterMapping/>
</flowtran>
