<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<flowtran id="nestcm" longname="隔日错账冲正入账" kind="3" package="cn.sunline.ltts.busi.intran.trans" xsi:noNamespaceSchemaLocation="ltts-model.xsd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <interface package="cn.sunline.ltts.busi.intran.trans.intf">
        <input packMode="true">
            <field id="prtrdt" type="BaseType.U_DATE08" required="true" multi="false" array="false" longname="原交易日期" ref="InDict.wrac.prtrdt"/>
            <field id="prtrsq" type="BaseType.U_SEQUNO" required="false" multi="false" array="false" longname="原交易流水" ref="InDict.wrac.prtrsq"/>
            <field id="wronbr" type="BaseType.U_WRONBR" required="true" multi="false" array="false" longname="原错账机构" ref="InDict.wrac.wronbr"/>
            <field id="numbsq" type="BaseType.U_SEQUNO" required="false" multi="false" array="false" longname="套号"/>
        </input>
        <output asParm="true" packMode="false"/>
        <property packMode="true">
            <field id="isckqt" type="BaseEnumType.E_YES___" required="false" multi="false" array="false" longname="额度控制标志"/>
            <field id="isckqt1" type="BaseEnumType.E_YES___" required="false" multi="false" array="false" longname="额度控制标志1"/>
            <field id="acctrt" type="BaseEnumType.E_ACCTROUTTYPE" required="false" multi="false" array="false" longname="账号路由类型" ref="BaseDict.Comm.acctrt"/>
            <field id="limttp" type="QtEnumType.E_LIMTTP" required="false" multi="false" array="false" longname="额度类型"/>
            <field id="risklv" type="QtEnumType.E_RISKLV" required="false" multi="false" array="false" longname="风险承受等级"/>
            <field id="authtp" type="BaseType.U_CHAR16" required="false" multi="false" array="false" longname="认证方式"/>
            <field id="rebktp" type="QtEnumType.E_REBKTP" required="false" multi="false" array="false" longname="收款行范围"/>
            <field id="aclmfg" type="QtEnumType.E_ACLMFG" required="false" multi="false" array="false" longname="累积限额标志"/>
            <field id="servtp" type="MsType.U_CHANNEL" required="false" multi="false" array="false" longname="交易渠道"/>
            <field id="servsq" type="BaseType.U_SEQUNO" required="false" multi="false" array="false" longname="渠道流水"/>
            <field id="servdt" type="BaseType.U_DATE08" required="false" multi="false" array="false" longname="渠道日期"/>
            <field id="dcflag1" type="QtEnumType.E_RECPAY" required="false" multi="false" array="false" longname="额度收方标志"/>
            <field id="brchno" type="BaseType.U_BRCHNO" required="false" multi="false" array="false" longname="机构号" ref="PbDict.Brch.brchno"/>
            <field id="accttp" type="BaseEnumType.E_ACCATP" required="false" multi="false" array="false" longname="账户分类" ref="BaseDict.Comm.accttp"/>
            <field id="sbactp" type="QtEnumType.E_SBACTP" required="false" multi="false" array="false" longname="子账户类型" ref="QtDict.Qt.sbactp"/>
            <field id="otacno" type="PbBaseType.U_CUSTAC" required="false" multi="false" array="false" longname="电子账号"/>
            <field id="inacno" type="PbBaseType.U_CUSTAC" required="false" multi="false" array="false" longname="电子账号"/>
            <field id="tranam" type="BaseType.U_TRANAM" required="false" multi="false" array="false" longname="交易金额"/>
            <field id="isInac1" type="BaseEnumType.E_YES___" required="false" multi="false" array="false" longname="账号1是否内部户"/>
            <field id="isInac2" type="BaseEnumType.E_YES___" required="false" multi="false" array="false" longname="账号2是否内部户"/>
            <field id="wronbr1" type="BaseType.U_WRONBR" required="false" multi="false" array="false" longname="原错账机构"/>
            <field id="numbsq1" type="BaseType.U_SEQUNO" required="false" multi="false" array="false" longname="套号"/>
            <field id="reason1" type="BaseType.U_SHORDS" required="false" multi="false" array="false" longname="错账原因"/>
            <field id="custac1" type="BaseType.U_ACCTNO" required="false" multi="false" array="false" longname="账号1"/>
            <field id="crcycd1" type="BaseType.U_CRCYCD" required="false" multi="false" array="false" longname="币种"/>
            <field id="rebuwo1" type="InEnumType.E_REBUWA" required="false" multi="false" array="false" longname="红蓝字"/>
            <field id="amntcd1" type="BaseEnumType.E_AMNTCD" required="false" multi="false" array="false" longname="借贷标志"/>
            <field id="happbl1" type="BaseType.U_HAPPBL" required="false" multi="false" array="false" longname="发生额"/>
            <field id="charlg1" type="InEnumType.E_PAYATP" required="false" multi="false" array="false" longname="挂销账标志"/>
            <field id="acctna1" type="BaseType.U_ACCTNA" required="false" multi="false" array="false" longname="账号名称"/>
            <field id="wronbr2" type="BaseType.U_WRONBR" required="false" multi="false" array="false" longname="原错账机构"/>
            <field id="numbsq2" type="BaseType.U_SEQUNO" required="false" multi="false" array="false" longname="套号"/>
            <field id="reason2" type="BaseType.U_SHORDS" required="false" multi="false" array="false" longname="错账原因"/>
            <field id="custac2" type="BaseType.U_ACCTNO" required="false" multi="false" array="false" longname="账号2"/>
            <field id="crcycd2" type="BaseType.U_CRCYCD" required="false" multi="false" array="false" longname="币种"/>
            <field id="rebuwo2" type="InEnumType.E_REBUWA" required="false" multi="false" array="false" longname="红蓝字"/>
            <field id="amntcd2" type="BaseEnumType.E_AMNTCD" required="false" multi="false" array="false" longname="借贷标志"/>
            <field id="happbl2" type="BaseType.U_HAPPBL" required="false" multi="false" array="false" longname="发生额"/>
            <field id="charlg2" type="InEnumType.E_PAYATP" required="false" multi="false" array="false" longname="挂销账标志"/>
            <field id="acctna2" type="BaseType.U_ACCTNA" required="false" multi="false" array="false" longname="账号名称"/>
            <field id="istaou" type="BaseEnumType.E_YES___" required="false" multi="false" array="false" longname="是否表外标志"/>
        </property>
        <printer packMode="false"/>
    </interface>
    <flow>
        <method method="befAccNestcm" id="befAccNestcm" longname="隔日错账冲正入账前处理"/>
        <case id="Inac1Check" longname="是否内部户判断" desc="是否内部户判断">
            <when id="IsInac1" test="isInac1==#dict.BaseEnumType.E_YES___().YES" longname="为内部户" desc="为内部户">
                <service mappingToProperty="true" serviceName="WroAccRollBack.InAccNestcm" id="inAccNestcm" test="istaou==#dict.BaseEnumType.E_YES___().NO" longname="内部户隔日错账冲正入账" desc="内部户隔日错账冲正入账">
                    <in_mappings by_interface="false">
                        <mapping src="custac1" dest="custac" by_interface="true" on_top="true"/>
                        <mapping src="custac2" dest="toacct" desc="description" by_interface="true" on_top="true"/>
                        <mapping src="happbl1" dest="happbl" by_interface="true" on_top="true"/>
                        <mapping src="reason1" dest="reason" by_interface="true" on_top="true"/>
                        <mapping src="rebuwo1" dest="rebuwo" by_interface="true" on_top="true"/>
                        <mapping src="crcycd1" dest="crcycd" by_interface="true" on_top="true"/>
                        <mapping src="wronbr1" dest="wronbr" by_interface="true" on_top="true"/>
                        <mapping src="numbsq1" dest="numbsq" by_interface="true" on_top="true"/>
                        <mapping src="charlg1" dest="charlg" by_interface="true" on_top="true"/>
                        <mapping src="amntcd1" dest="amntcd" by_interface="true" on_top="true"/>
                    </in_mappings>
                    <out_mappings by_interface="true"/>
                </service>
                <service serviceName="WroAccRollBack.InOutTableAccount" test="istaou==#dict.BaseEnumType.E_YES___().YES" longname="错账调整表外记账">
                    <in_mappings by_interface="true">
                        <mapping src="custac1" dest="custac" by_interface="true" on_top="true"/>
                        <mapping src="happbl1" dest="happbl" by_interface="true" on_top="true"/>
                        <mapping src="reason1" dest="reason" by_interface="true" on_top="true"/>
                        <mapping src="rebuwo1" dest="rebuwo" by_interface="true" on_top="true"/>
                        <mapping src="crcycd1" dest="crcycd" by_interface="true" on_top="true"/>
                        <mapping src="wronbr1" dest="wronbr" by_interface="true" on_top="true"/>
                        <mapping src="numbsq1" dest="numbsq" by_interface="true" on_top="true"/>
                        <mapping src="charlg1" dest="charlg" by_interface="true" on_top="true"/>
                        <mapping src="amntcd1" dest="amntcd" by_interface="true" on_top="true"/>
                    </in_mappings>
                    <out_mappings by_interface="true"/>
                </service>
            </when>
            <when id="IsNotInac1" test="isInac1==#dict.BaseEnumType.E_YES___().NO" longname="不为内部户时" desc="不为内部户时">
                <service mappingToProperty="true" serviceName="DpAcctSvcType.DpAccNestcm" id="dpAccNestcm" longname="电子账户隔日错账冲正入账" desc="电子账户隔日错账冲正入账">
                    <in_mappings by_interface="true">
                        <mapping src="prtrdt" dest="prtrdt" by_interface="true" on_top="true"/>
                        <mapping src="custac1" dest="custac" by_interface="true" on_top="true"/>
                        <mapping src="happbl1" dest="happbl" by_interface="true" on_top="true"/>
                        <mapping src="reason1" dest="reason" by_interface="true" on_top="true"/>
                        <mapping src="rebuwo1" dest="rebuwo" by_interface="true" on_top="true"/>
                        <mapping src="crcycd1" dest="crcycd" by_interface="true" on_top="true"/>
                        <mapping src="wronbr1" dest="wronbr" by_interface="true" on_top="true"/>
                        <mapping src="numbsq1" dest="numbsq" by_interface="true" on_top="true"/>
                        <mapping src="charlg1" dest="charlg" by_interface="true" on_top="true"/>
                        <mapping src="amntcd1" dest="amntcd" by_interface="true" on_top="true"/>
                        <mapping src="custac2" dest="custac2" by_interface="true" on_top="true"/>
                        <mapping src="acctna2" dest="acctna2" by_interface="true" on_top="true"/>
                    </in_mappings>
                    <out_mappings by_interface="true">
                        <mapping src="tranam" dest="tranam" by_interface="true" on_top="true"/>
                        <mapping src="otacno" dest="otacno" by_interface="true" on_top="true"/>
                        <mapping src="amntcd" dest="amntcd1" by_interface="true" on_top="true"/>
                    </out_mappings>
                </service>
            </when>
        </case>
        <case id="Inac2Check" longname="是否内部户判断" desc="是否内部户判断">
            <when id="IsInac2" test="isInac2==#dict.BaseEnumType.E_YES___().YES" longname="为内部户" desc="为内部户">
                <service mappingToProperty="false" serviceName="WroAccRollBack.InAccNestcm" id="inAccNestcm" longname="内部户隔日错账冲正入账" desc="内部户隔日错账冲正入账">
                    <in_mappings by_interface="false">
                        <mapping src="custac2" dest="custac" by_interface="true" on_top="true"/>
                        <mapping src="custac1" dest="toacct" desc="description" by_interface="true" on_top="true"/>
                        <mapping src="happbl2" dest="happbl" by_interface="true" on_top="true"/>
                        <mapping src="reason2" dest="reason" by_interface="true" on_top="true"/>
                        <mapping src="rebuwo2" dest="rebuwo" by_interface="true" on_top="true"/>
                        <mapping src="crcycd2" dest="crcycd" by_interface="true" on_top="true"/>
                        <mapping src="wronbr2" dest="wronbr" by_interface="true" on_top="true"/>
                        <mapping src="numbsq2" dest="numbsq" by_interface="true" on_top="true"/>
                        <mapping src="charlg2" dest="charlg" by_interface="true" on_top="true"/>
                        <mapping src="amntcd2" dest="amntcd" by_interface="true" on_top="true"/>
                    </in_mappings>
                    <out_mappings by_interface="true"/>
                </service>
            </when>
            <when id="IsNotInac2" test="isInac2==#dict.BaseEnumType.E_YES___().NO" longname="不为内部户时" desc="不为内部户时">
                <service mappingToProperty="true" serviceName="DpAcctSvcType.DpAccNestcm" id="dpAccNestcm" longname="电子账户隔日错账冲正入账" desc="电子账户隔日错账冲正入账">
                    <in_mappings by_interface="true">
                        <mapping src="prtrdt" dest="prtrdt" by_interface="true" on_top="true"/>
                        <mapping src="custac2" dest="custac" by_interface="true" on_top="true"/>
                        <mapping src="happbl2" dest="happbl" by_interface="true" on_top="true"/>
                        <mapping src="reason2" dest="reason" by_interface="true" on_top="true"/>
                        <mapping src="rebuwo2" dest="rebuwo" by_interface="true" on_top="true"/>
                        <mapping src="crcycd2" dest="crcycd" by_interface="true" on_top="true"/>
                        <mapping src="wronbr2" dest="wronbr" by_interface="true" on_top="true"/>
                        <mapping src="numbsq2" dest="numbsq" by_interface="true" on_top="true"/>
                        <mapping src="charlg2" dest="charlg" by_interface="true" on_top="true"/>
                        <mapping src="amntcd2" dest="amntcd" by_interface="true" on_top="true"/>
                        <mapping src="custac1" dest="custac2" by_interface="true" on_top="true"/>
                        <mapping src="acctna1" dest="acctna2" by_interface="true" on_top="true"/>
                    </in_mappings>
                    <out_mappings by_interface="true">
                        <mapping src="tranam" dest="tranam" by_interface="true" on_top="true"/>
                        <mapping src="otacno" dest="inacno" by_interface="true" on_top="true"/>
                        <mapping src="amntcd" dest="amntcd2" by_interface="true" on_top="true"/>
                    </out_mappings>
                </service>
            </when>
        </case>
        <method method="befTran" id="befTran" longname="额度扣减报文设置"/>
        <service serviceName="IoCaSevAccountLimit.IoAcSubQuota" id="IoAcSubQuota2" test="isckqt == #dict.BaseEnumType.E_YES___().YES" longname="电子账户系统扣减客户额度">
            <in_mappings by_interface="true">
                <mapping src="aclmfg" dest="aclmfg" by_interface="true" on_top="true"/>
                <mapping src="authtp" dest="authtp" by_interface="true" on_top="true"/>
                <mapping src="otacno" dest="custac" by_interface="true" on_top="true"/>
                <mapping src="acctrt" dest="acctrt" by_interface="true" on_top="true"/>
                <mapping src="limttp" dest="limttp" by_interface="true" on_top="true"/>
                <mapping src="rebktp" dest="rebktp" by_interface="true" on_top="true"/>
                <mapping src="risklv" dest="risklv" by_interface="true" on_top="true"/>
                <mapping src="servdt" dest="servdt" by_interface="true" on_top="true"/>
                <mapping src="servsq" dest="servsq" by_interface="true" on_top="true"/>
                <mapping src="servtp" dest="servtp" by_interface="true" on_top="true"/>
                <mapping src="tranam" dest="tranam" by_interface="true" on_top="true"/>
                <mapping src="brchno" dest="brchno" by_interface="true" on_top="true"/>
                <mapping src="accttp" dest="accttp" by_interface="true" on_top="true"/>
                <mapping src="sbactp" dest="sbactp" by_interface="true" on_top="true"/>
                <mapping src="dcflag1" dest="dcflag" desc="description" by_interface="true" on_top="true"/>
                <mapping src="prtrdt" dest="oldate" desc="description" by_interface="true" on_top="true"/>
            </in_mappings>
            <out_mappings by_interface="true"/>
        </service>
        <service serviceName="IoCaSevAccountLimit.IoAcSubQuota" id="IoAcSubQuota2" test="isckqt1 == #dict.BaseEnumType.E_YES___().YES" longname="电子账户系统扣减客户额度">
            <in_mappings by_interface="true">
                <mapping src="aclmfg" dest="aclmfg" by_interface="true" on_top="true"/>
                <mapping src="authtp" dest="authtp" by_interface="true" on_top="true"/>
                <mapping src="inacno" dest="custac" by_interface="true" on_top="true"/>
                <mapping src="acctrt" dest="acctrt" by_interface="true" on_top="true"/>
                <mapping src="limttp" dest="limttp" by_interface="true" on_top="true"/>
                <mapping src="rebktp" dest="rebktp" by_interface="true" on_top="true"/>
                <mapping src="risklv" dest="risklv" by_interface="true" on_top="true"/>
                <mapping src="servdt" dest="servdt" by_interface="true" on_top="true"/>
                <mapping src="servsq" dest="servsq" by_interface="true" on_top="true"/>
                <mapping src="servtp" dest="servtp" by_interface="true" on_top="true"/>
                <mapping src="tranam" dest="tranam" by_interface="true" on_top="true"/>
                <mapping src="brchno" dest="brchno" by_interface="true" on_top="true"/>
                <mapping src="accttp" dest="accttp" by_interface="true" on_top="true"/>
                <mapping src="sbactp" dest="sbactp" by_interface="true" on_top="true"/>
                <mapping src="dcflag1" dest="dcflag" desc="description" by_interface="true" on_top="true"/>
                <mapping src="prtrdt" dest="oldate" desc="description" by_interface="true" on_top="true"/>
            </in_mappings>
            <out_mappings by_interface="true"/>
        </service>
    </flow>
</flowtran>
