<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<sqls xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" id="InDayEndSqls" longname="内部户日终" package="cn.sunline.ltts.busi.in.namedsql" xsi:noNamespaceSchemaLocation="ltts-model.xsd">
    <select cache="none" method="selectAll" type="sql" id="selAcctData" longname="获取余额过账数据集">
        <sql type="mysql"><![CDATA[select * from  (select a.acctno acctno,b.ioflag,a.trandt trandt,b.itmcdn itmcdn,b.blncdn blncdn,c.lastdn lastdn,ifnull(a.tranam,0) tranam,a.amntcd amntcd,c.lastdt lastdt,c.drltbl drltbl,c.crltbl crltbl,b.dredbl dredbl,b.credbl credbl ,b.drctbl drctbl, b.crctbl crctbl from gl_ktp_glvc a left outer join gl_kna_acct b on a.acctno = b. acctno left outer join gl_kna_lsbl c  on a.acctno = c. acctno where (#gpoint#  is null or #gpoint#='' or a.acctno >= #gpoint#) order by a.acctno) t where rownum <= #rdnumb#]]></sql>
        <sql type="oracle"><![CDATA[select * from  (select a.acctno acctno,b.ioflag,a.trandt trandt,b.itmcdn itmcdn,b.blncdn blncdn,c.lastdn lastdn,nvl(a.tranam,0) tranam,a.amntcd amntcd,c.lastdt lastdt,c.drltbl drltbl,c.crltbl crltbl,b.dredbl dredbl,b.credbl credbl ,b.drctbl drctbl, b.crctbl crctbl from gl_ktp_glvc a left outer join gl_kna_acct b on a.acctno = b. acctno left outer join gl_kna_lsbl c  on a.acctno = c. acctno where (#gpoint#  is null or #gpoint#='' or a.acctno >= #gpoint#) order by a.acctno) t where rownum <= #rdnumb#]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="gpoint" jdbcType="VARCHAR" javaType="string" mode="in" longname="分组点" parameterType="condition"/>
            <parameter property="rdnumb" jdbcType="VARCHAR" javaType="long" mode="in" longname="分组最大记录数" parameterType="condition"/>
        </parameterMap>
        <resultMap class="InDayEndTypes.InacTranam"/>
    </select>
    <select cache="none" method="selectOne" type="sql" id="selAcctCount" longname="获取内部户数">
        <sql type="oracle" desc="获取日终需要余额更新的内部户总数"><![CDATA[select count(*) from gl_ktp_glvc]]></sql>
        <sql type="mysql" desc="获取日终需要余额更新的内部户总数"><![CDATA[select count(*) from gl_ktp_glvc]]></sql>
        <parameterMap class="java.util.Map"/>
        <resultMap class="long"/>
    </select>
    <select cache="none" method="selectOne" type="sql" id="selAcctPoint" longname="获取余额过账账户分割点">
        <sql type="oracle"><![CDATA[select max(acctno) as gpoint from (select * from gl_ktp_glvc where (#gpoint# is null or #gpoint#='' or acctno > #gpoint#) order by acctno) t where rownum <= #rdnumb#]]></sql>
        <sql type="mysql"><![CDATA[select max(acctno) as gpoint from (select * from gl_ktp_glvc where (#gpoint# is null or #gpoint#='' or acctno > #gpoint#) order by acctno) t where rownum <= #rdnumb#]]></sql>
        <parameterMap class="InDayEndTypes.InacGroupId"/>
        <resultMap class="java.lang.String"/>
    </select>
    <insert id="insGlKtpGlvc" longname="准备待过账数据">
        <sql type="oracle"><![CDATA[
        insert into gl_ktp_glvc(corpno,acctno,trandt,amntcd,tranam) 
        select #corpno#,b.acctno as acctno, b.trandt as trandt,case b.ioflag when 'I' then 'D' else 'R' end as amntcd,sum(b.tranam * case  when b.amntcd in ('D','R') then 1 else -1 end) tranam  
        from gl_kns_glvc b where b.trandt = #trandt# and ckvcfg='1' group by b.acctno,b.trandt,b.ioflag
        ]]></sql>
        <sql type="mysql"><![CDATA[
        insert into gl_ktp_glvc(corpno,acctno,trandt,amntcd,tranam) 
        select #corpno#,b.acctno as acctno, b.trandt as trandt,case b.ioflag when 'I' then 'D' else 'R' end as amntcd,sum(b.tranam * case  when b.amntcd in ('D','R') then 1 else -1 end) tranam  
        from gl_kns_glvc b where b.trandt = #trandt# and ckvcfg='1' group by b.acctno,b.trandt,b.ioflag
        ]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="trandt" ref="InDict.inac.trandt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="交易日期" parameterType="condition"/>
            <parameter property="corpno" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" parameterType="condition"/>
        </parameterMap>
    </insert>
    <delete method="delete" id="delGlktpGlvc" longname="删除过账数据">
        <sql type="oracle"><![CDATA[delete from gl_ktp_glvc where corpno = #corpno#]]></sql>
        <sql type="mysql"><![CDATA[delete from gl_ktp_glvc where corpno = #corpno#]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="corpno" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人编号" parameterType="condition"/>
        </parameterMap>
    </delete>
    <update method="updateOne" id="upGlKnaLsbl" longname="更新上日余额表">
        <sql type="oracle"><![CDATA[
        update gl_kna_lsbl 
        set lastdt = #lastdt#,lastdn = #lastdn#,drltbl = #drltbl#,crltbl = #crltbl#,tmstmp = #tmstmp#
        where acctno = #acctno# and drltbl = #indrlt# and crltbl= #incrlt# and lastdn = #inlsdn#
        ]]></sql>
        <sql type="mysql"><![CDATA[
        update gl_kna_lsbl 
        set lastdt = #lastdt#,lastdn = #lastdn#,drltbl = #drltbl#,crltbl = #crltbl#,tmstmp = #tmstmp#
        where acctno = #acctno# and drltbl = #indrlt# and crltbl= #incrlt# and lastdn = #inlsdn#
        ]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="acctno" ref="InDict.inac.acctno" jdbcType="VARCHAR" javaType="BaseType.U_ACCTNO" mode="in" longname="内部户账号" parameterType="condition"/>
            <parameter property="indrlt" jdbcType="VARCHAR" javaType="BaseType.U_ACBLTP" mode="in" longname="上日借方余额" parameterType="condition"/>
            <parameter property="incrlt" jdbcType="VARCHAR" javaType="BaseType.U_ACBLTP" mode="in" longname="上日贷方余额" parameterType="condition"/>
            <parameter property="inlsdn" jdbcType="VARCHAR" javaType="InEnumType.E_BLNCDN" mode="in" longname="上日余额方向CDR" parameterType="condition"/>
            <parameter property="lastdt" ref="InDict.inac.lastdt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="上日余额日期" parameterType="condition"/>
            <parameter property="lastdn" ref="InDict.inac.lastdn" jdbcType="VARCHAR" javaType="InEnumType.E_BLNCDN" mode="in" longname="上日余额方向CDR" parameterType="condition"/>
            <parameter property="drltbl" ref="InDict.inac.drltbl" jdbcType="VARCHAR" javaType="BaseType.U_ACBLTP" mode="in" longname="上日借方余额" parameterType="condition"/>
            <parameter property="crltbl" ref="InDict.inac.crltbl" jdbcType="VARCHAR" javaType="BaseType.U_ACBLTP" mode="in" longname="上日贷方余额" parameterType="condition"/>
            <parameter property="datetm" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" parameterType="condition"/>
            <parameter property="tmstmp" ref="ApDict.Aplt.tmstmp" jdbcType="DECIMAL" javaType="ApBaseType.U_TMSTMP" mode="in" longname="时间戳" parameterType="condition"/>
        </parameterMap>
    </update>
    <select cache="none" method="selectOne" type="sql" id="selAcctTranam" longname="获取账户指定日期后的借/付发生额">
        <sql type="oracle"><![CDATA[
        select nvl(sum(tranam * (case when amntcd in ('C', 'P') then -1 else 1 end)), 0) 
        from gl_kns_glvc where trandt > #trandt# and acctno = #acctno#
        ]]></sql>
        <sql type="mysql"><![CDATA[
        select ifnull(sum(tranam * (case when amntcd in ('C', 'P') then -1 else 1 end)), 0) 
        from gl_kns_glvc where trandt > #trandt# and acctno = #acctno#
        ]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="trandt" ref="InDict.inac.trandt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="交易日期" parameterType="condition"/>
            <parameter property="acctno" ref="InDict.inac.acctno" jdbcType="VARCHAR" javaType="BaseType.U_ACCTNO" mode="in" longname="内部户账号" parameterType="condition"/>
        </parameterMap>
        <resultMap class="double"/>
    </select>
    <delete method="delete" id="delGlktpRlbl" longname="删除非实时余额入账数据">
        <sql type="oracle"><![CDATA[truncate table gl_ktp_rlbl]]></sql>
        <sql type="mysql"><![CDATA[truncate table gl_ktp_rlbl]]></sql>
        <parameterMap class="java.util.Map"/>
    </delete>
    <insert id="insGlKtpRlbl" longname="准备非实时余额入账数据">
        <sql type="oracle"><![CDATA[
        insert into gl_ktp_rlbl
      	select acctno,
             'd',
             sum(tranam * (case
                   when amntcd in ('C', 'P') then
                    -1
                   else
                    1
                 end)),
             count(1)
        from gl_kns_glvc
       	where trandt = #trandt#
        and ckvcfg = '0'
       	group by acctno
       	]]></sql>
        <sql type="mysql"><![CDATA[
        insert into gl_ktp_rlbl
      	select acctno,
             'd',
             sum(tranam * (case
                   when amntcd in ('C', 'P') then
                    -1
                   else
                    1
                 end)),
             count(1)
        from gl_kns_glvc
       	where trandt = #trandt#
        and ckvcfg = '0'
       	group by acctno
       	]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="trandt" ref="InDict.inac.trandt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="交易日期" parameterType="condition"/>
        </parameterMap>
    </insert>
    <delete method="delete" id="delGlktpRlblByZ" longname="删除交易金额为0的数据">
        <sql type="oracle"><![CDATA[delete from gl_ktp_rlbl where tranam = 0]]></sql>
        <sql type="mysql"><![CDATA[delete from gl_ktp_rlbl where tranam = 0]]></sql>
        <parameterMap class="java.util.Map"/>
    </delete>
    <select cache="none" method="selectOne" type="sql" id="selRlblCount" longname="获取内部户数">
        <sql type="oracle" desc="获取非实时余额的内部户总数"><![CDATA[select count(*) from gl_ktp_rlbl]]></sql>
        <sql type="mysql" desc="获取非实时余额的内部户总数"><![CDATA[select count(*) from gl_ktp_rlbl]]></sql>
        <parameterMap class="java.util.Map"/>
        <resultMap class="long"/>
    </select>
    <select cache="none" method="selectAll" type="sql" id="selRlblData" longname="获取非实时余额入账数据集">
        <sql type="oracle"><![CDATA[
        select a.acctno , a.amntcd , a.tranam , a.record  from gl_ktp_rlbl a 
        where (#grouppoint#  is null or #grouppoint#='' or a.acctno >= #grouppoint#) and rownum <= #groupcount#
        ]]></sql>
        <sql type="mysql"><![CDATA[
        select a.acctno , a.amntcd , a.tranam , a.record  from gl_ktp_rlbl a 
        where (#grouppoint#  is null or #grouppoint#='' or a.acctno >= #grouppoint#) and rownum <= #groupcount#
        ]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="grouppoint" jdbcType="VARCHAR" javaType="string" mode="in" longname="分组点" parameterType="condition"/>
            <parameter property="groupcount" jdbcType="VARCHAR" javaType="long" mode="in" longname="分组最大记录数" parameterType="condition"/>
        </parameterMap>
        <resultMap class="InDayEndTypes.InacRlbl"/>
    </select>
    <update method="update" id="upGlKnaGlvc" longname="更新传票表状态">
        <sql type="oracle"><![CDATA[ 
        update gl_kns_glvc
        set ckvcfg = '1', rlbltg = '1' ,tmstmp = #tmstmp#
        WHERE trandt = #acctdt#
        AND ckvcfg = '0'
        AND acctno =#acctno#]]></sql>
        <sql type="mysql"><![CDATA[ 
        update gl_kns_glvc
        set ckvcfg = '1', rlbltg = '1' ,tmstmp = #tmstmp#
        WHERE trandt = #acctdt#
        AND ckvcfg = '0'
        AND acctno =#acctno#]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="acctno" jdbcType="VARCHAR" javaType="BaseType.U_ACCTNO" mode="in" longname="帐号" parameterType="condition"/>
            <parameter property="acctdt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="交易日期" parameterType="condition"/>
            <parameter property="tmstmp" jdbcType="VARCHAR" javaType="ApBaseType.U_TMSTMP" mode="in" longname="时间戳" parameterType="condition"/>
        </parameterMap>
    </update>
    <select cache="none" method="selectOne" type="sql" id="selRlblPoint" longname="获取余额过账账户分割点">
        <sql type="oracle"><![CDATA[
        select max(acctno) from 
        (select * from gl_ktp_rlbl where (#gpoint# is null or #gpoint#='' or acctno > #gpoint#) order by acctno) t 
        where rownum <= #rdnumb#
        ]]></sql>
        <sql type="mysql"><![CDATA[
        select max(acctno) from 
        (select * from gl_ktp_rlbl where (#gpoint# is null or #gpoint#='' or acctno > #gpoint#) order by acctno) t 
        where rownum <= #rdnumb#
        ]]></sql>
        <parameterMap class="InDayEndTypes.InacGroupId"/>
        <resultMap class="java.lang.String"/>
    </select>
    <delete method="delete" id="delGlktpRlblAll" longname="删除所有临时数据">
        <sql type="oracle"><![CDATA[delete from gl_ktp_rlbl]]></sql>
        <sql type="mysql"><![CDATA[delete from gl_ktp_rlbl]]></sql>
        <parameterMap class="java.util.Map"/>
    </delete>
    <select cache="none" method="selectAll" type="sql" id="selAcctDatas" longname="获取待过账内部户数据">
        <sql type="oracle"><![CDATA[
        select a.acctno acctno,a.trandt trandt,a.tranam tranam,a.amntcd amntcd from gl_ktp_glvc a where corpno=#corpno#
        ]]></sql>
        <sql type="mysql"><![CDATA[
        select a.acctno acctno,a.trandt trandt,a.tranam tranam,a.amntcd amntcd from gl_ktp_glvc a where corpno=#corpno#
        ]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="corpno" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" parameterType="condition"/>
        </parameterMap>
        <resultMap class="InDayEndTypes.InacTranam"/>
    </select>
    <insert id="insGlKtpGlvcEdbl" longname="准备日终余额待过账数据">
        <sql type="oracle"><![CDATA[
        insert into gl_ktp_glvc(acctno,trandt,amntcd,tranam) 
        select b.acctno as acctno, b.trandt as trandt,'D',
        sum(b.tranam * case  when b.amntcd in ('D','P') then 1 else -1 end) tranam  
		from gl_kns_glvc b 
		where b.trandt = #acctdt#  and ckvcfg='1' group by b.acctno, b.trandt
		]]></sql>
        <sql type="mysql"><![CDATA[
        insert into gl_ktp_glvc(acctno,trandt,amntcd,tranam) 
        select b.acctno as acctno, b.trandt as trandt,'D',
        sum(b.tranam * case  when b.amntcd in ('D','P') then 1 else -1 end) tranam  
		from gl_kns_glvc b 
		where b.trandt = #acctdt#  and ckvcfg='1' group by b.acctno, b.trandt
		]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="acctdt" ref="DpDict.Acct.acctdt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="账务日期" parameterType="condition"/>
        </parameterMap>
    </insert>
    <update method="updateOne" id="uptGlAcctEdbl" longname="更新内部户日终余额">
        <sql type="oracle"><![CDATA[
        update gl_kna_acct 
        set dredbl = #dredbl#,credbl = #credbl#,tmstmp=#tmstmp#
        where acctno = #acctno#
        ]]></sql>
        <sql type="mysql"><![CDATA[
        update gl_kna_acct 
        set dredbl = #dredbl#,credbl = #credbl#,tmstmp=#tmstmp#
        where acctno = #acctno#
        ]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="acctno" ref="InDict.inac.acctno" jdbcType="VARCHAR" javaType="BaseType.U_ACCTNO" mode="in" longname="内部户账号" parameterType="condition"/>
            <parameter property="dredbl" ref="InDict.inac.dredbl" jdbcType="VARCHAR" javaType="BaseType.U_ACBLTP" mode="in" longname="当日借方余额" parameterType="condition"/>
            <parameter property="credbl" ref="InDict.inac.credbl" jdbcType="VARCHAR" javaType="BaseType.U_ACBLTP" mode="in" longname="当日贷方余额" parameterType="condition"/>
            <parameter property="tmstmp" ref="ApDict.Aplt.tmstmp" jdbcType="VARCHAR" javaType="ApBaseType.U_TMSTMP" mode="in" longname="时间戳" parameterType="condition"/>
        </parameterMap>
    </update>
    <select cache="none" method="selectOne" type="sql" id="selSumDredblGlAcct" longname="查询日终借方余额汇总">
        <sql type="oracle"><![CDATA[
        select nvl(sum(dredbl),0) from gl_kna_acct where brchno=#brchno# and crcycd=#crcycd# and itemcd=#itemcd#
        ]]></sql>
        <sql type="oracle"><![CDATA[
        select ifnull(sum(dredbl),0) from gl_kna_acct where brchno=#brchno# and crcycd=#crcycd# and itemcd=#itemcd#
        ]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="brchno" ref="PbDict.Brch.brchno" jdbcType="VARCHAR" javaType="BaseType.U_BRCHNO" mode="in" longname="机构号" parameterType="condition"/>
            <parameter property="crcycd" ref="BaseDict.Comm.crcycd" jdbcType="VARCHAR" javaType="BaseType.U_CRCYCD" mode="in" longname="币种" parameterType="condition"/>
            <parameter property="itemcd" ref="InDict.inac.itemcd" jdbcType="VARCHAR" javaType="BaseType.U_ITEMCD" mode="in" longname="科目" parameterType="condition"/>
        </parameterMap>
        <resultMap class="double"/>
    </select>
    <select cache="none" method="selectAll" type="sql" id="selRlblList" longname="获取非实时余额数据">
        <sql type="oracle"><![CDATA[
        select acctno,
             'D' as amntcd,
             SUM(tranam * (CASE
                   WHEN amntcd IN ('C', 'P') THEN
                    -1
                   ELSE
                    1
                 END)) AS tranam,
             COUNT(1) AS record
        FROM gl_kns_glvc
        WHERE trandt = #trandt#
	    AND corpno = #corpno#
        AND ckvcfg = '0'
        GROUP BY acctno
        ]]></sql>
        <sql type="mysql"><![CDATA[
        select acctno,
             'D' as amntcd,
             SUM(tranam * (CASE
                   WHEN amntcd IN ('C', 'P') THEN
                    -1
                   ELSE
                    1
                 END)) AS tranam,
             COUNT(1) AS record
        FROM gl_kns_glvc
        WHERE trandt = #trandt#
	    AND corpno = #corpno#
        AND ckvcfg = '0'
        GROUP BY acctno
        ]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="trandt" ref="InDict.inac.trandt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="交易日期" parameterType="condition"/>
            <parameter property="corpno" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" parameterType="condition"/>
        </parameterMap>
        <resultMap class="InDayEndTypes.InacRlbl"/>
    </select>
    <select cache="none" method="selectOne" type="sql" id="selGlAcctInfoWithLock" longname="获取内部户信息(带锁)">
        <sql type="oracle"><![CDATA[
        select b.ioflag,b.busidn itmcdn,b.blncdn blncdn,c.lastdn lastdn,c.lastdt lastdt,c.drltbl drltbl,c.crltbl crltbl,b.dredbl dredbl,b.credbl credbl ,b.drctbl drctbl, b.crctbl crctbl 
        from gl_kna_acct b join gl_kna_lsbl c  on b.acctno = c. acctno where b.acctno = #acctno# for update 
        ]]></sql>
        <sql type="mysql"><![CDATA[
        select b.ioflag,b.busidn itmcdn,b.blncdn blncdn,c.lastdn lastdn,c.lastdt lastdt,c.drltbl drltbl,c.crltbl crltbl,b.dredbl dredbl,b.credbl credbl ,b.drctbl drctbl, b.crctbl crctbl 
        from gl_kna_acct b join gl_kna_lsbl c  on b.acctno = c. acctno where b.acctno = #acctno# for update 
        ]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="acctno" ref="InDict.inac.acctno" jdbcType="VARCHAR" javaType="BaseType.U_ACCTNO" mode="in" longname="内部户账号" parameterType="condition"/>
        </parameterMap>
        <resultMap class="InDayEndTypes.InacTranam"/>
    </select>
    <select cache="none" method="selectAll" type="sql" id="selGlKnaAcctSyglbl" longname="获取内部户当日余额同步数据">
        <sql type="oracle"><![CDATA[select acctno acctno from gl_kna_acct]]></sql>
        <sql type="mysql"><![CDATA[select acctno acctno from gl_kna_acct]]></sql>
        <parameterMap class="java.util.Map"/>
        <resultMap class="IoInQueryTypes.IoInacTranam"/>
    </select>
    <select cache="none" method="selectOne" type="sql" id="selTranInfoSyglbl" longname="获取账户借/收方发生额">
        <sql type="oracle"><![CDATA[
        select b.acctno as acctno, b.trandt as trandt,'D' as amntcd,
        sum(b.tranam * case  when b.amntcd in ('D','R') then 1 else -1 end) tranam  
		from gl_kns_glvc b 
		where b.acctno = #acctno# and b.trandt = #trandt#  and ckvcfg='1' group by b.acctno,b.trandt
		]]></sql>
        <sql type="mysql"><![CDATA[
        select b.acctno as acctno, b.trandt as trandt,'D' as amntcd,
        sum(b.tranam * case  when b.amntcd in ('D','R') then 1 else -1 end) tranam  
		from gl_kns_glvc b 
		where b.acctno = #acctno# and b.trandt = #trandt#  and ckvcfg='1' group by b.acctno,b.trandt
		]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="acctno" ref="InDict.inac.acctno" jdbcType="VARCHAR" javaType="BaseType.U_ACCTNO" mode="in" longname="内部户账号" parameterType="condition"/>
            <parameter property="trandt" ref="InDict.inac.trandt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="交易日期" parameterType="condition"/>
        </parameterMap>
        <resultMap class="InDayEndTypes.InacTranam"/>
    </select>
    <delete method="delete" id="delGlKnsRlblByTrandt" longname="删除指定交易日期前的非实时余额账户发生汇总明细数据">
        <sql type="oracle"><![CDATA[delete from gl_kns_rlbl where trandt <= #trandt# and corpno = #corpno#]]></sql>
        <sql type="mysql"><![CDATA[delete from gl_kns_rlbl where trandt <= #trandt# and corpno = #corpno#]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="trandt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="交易日期" parameterType="condition"/>
            <parameter property="corpno" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" parameterType="condition"/>
        </parameterMap>
    </delete>
    <insert id="Ins_Lttl" longname="登记利息支出汇总">
        <sql type="mysql"><![CDATA[
        insert into knb_lttl(cabrdt,brchno,acctcd,prodcd,crcycd,cabrin,corpno,tmstmp) 
    	select trandt,acctbr,'',dtitcd,crcycd,sum(tranam) as cabrin,corpno ,#tmstmp#
    	from kns_acsq where trandt=#cabrdt# and bltype = '2'
    	group by trandt,acctbr,dtitcd,crcycd,corpno 
		]]></sql>
        <sql type="oracle"><![CDATA[
        insert into knb_lttl(cabrdt,brchno,acctcd,prodcd,crcycd,cabrin,corpno,tmstmp) 
    	select trandt,acctbr,'',dtitcd,crcycd,sum(tranam) as cabrin,corpno ,#tmstmp#
    	from kns_acsq where trandt=#cabrdt# and bltype = '2'
    	group by trandt,acctbr,dtitcd,crcycd,corpno 
		]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="cabrdt" jdbcType="VARCHAR" javaType="string" mode="in" parameterType="condition"/>
            <parameter property="tmstmp" ref="ApDict.Aplt.tmstmp" jdbcType="VARCHAR" javaType="ApBaseType.U_TMSTMP" mode="in" longname="时间戳" parameterType="condition"/>
        </parameterMap>
    </insert>
    <delete method="delete" id="Del_Lttl" longname="删除利息支出汇总">
        <sql type="mysql"><![CDATA[Delete From knb_lttl Where cabrdt = #cabrdt#]]></sql>
        <sql type="oracle"><![CDATA[Delete From knb_lttl Where cabrdt = #cabrdt#]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="cabrdt" jdbcType="VARCHAR" javaType="string" mode="in" longname="支出日期" parameterType="condition"/>
        </parameterMap>
    </delete>
    <insert id="Ins_new_knb_cbtl" longname="登记计提汇总信息by产品">
        <sql type="mysql"><![CDATA[        
        insert Into knb_cbtl(corpno,cabrdt,brchno,acctcd,prodcd,crcycd,cabrin)
    	select corpno,cabrdt,brchno,acctcd,'DP',crcycd,sum(cabrin) as cabrin
    	from knb_cbdl Where cabrdt=#cabrdt# and corpno=#corpno# 
    	group By cabrdt,brchno,acctcd,crcycd,corpno]]></sql>
        <sql type="oracle"><![CDATA[        
        insert Into knb_cbtl(corpno,cabrdt,brchno,acctcd,prodcd,crcycd,cabrin)
    	select corpno,cabrdt,brchno,acctcd,'DP',crcycd,sum(cabrin) as cabrin
    	from knb_cbdl Where cabrdt=#cabrdt# and corpno=#corpno# 
    	group By cabrdt,brchno,acctcd,crcycd,corpno]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="cabrdt" jdbcType="VARCHAR" javaType="string" mode="in" longname="计提日期" parameterType="condition"/>
            <parameter property="corpno" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
        </parameterMap>
    </insert>
    <insert id="Ins_new_lnb_cbtl" longname="登记贷款计提汇总信息">
        <sql type="mysql"><![CDATA[        
		Insert Into lnb_cbtl
		  (corpno,cabrdt, brchno, acctcd, prodcd, crcycd, cabrin, bltype, wdtype)
		 select aa.corpno,aa.acctdt,aa.brchno,aa.dtitcd,'LN',aa.crcycd,sum(aa.cabrin) cabrin,aa.bltype,aa.wdtype
		from
		(Select 
		  		 a.corpno,
		  		 a.acctdt,
		         a.brchno,
		         b.dtitcd,
		         'LN',
		         a.crcycd,
		         (case
	               when a.prlntg = '0' then
	                ysyjni + ysyjpi + ysxxti
	               else
	                csyjni + csyjpi + csxxoi + csxxpi
	             end) as cabrin,
		         case when a.prlntg = '0' then '1' else '8' end  bltype,
                 case when a.prlntg = '0' then 'B' else 'D' end  wdtype
		    From lna_acct_hist a
		    Join lnb_dtit b
		      On a.lncfno = b.lncfno 
		      and a.corpno = b.corpno
		     where a.acctdt = #acctdt# and a.corpno=#corpno#
		   ) aa
		   Group By aa.corpno, aa.acctdt, aa.brchno, aa.crcycd, aa.dtitcd, aa.bltype, aa.wdtype
		]]></sql>
        <sql type="oracle"><![CDATA[        
			Insert Into lnb_cbtl
		  (corpno,cabrdt, brchno, acctcd, prodcd, crcycd, cabrin, bltype, wdtype)
		 select aa.corpno,aa.acctdt,aa.brchno,aa.dtitcd,'LN',aa.crcycd,sum(aa.cabrin) cabrin,aa.bltype,aa.wdtype
		from
		(Select 
		  		 a.corpno,
		  		 a.acctdt,
		         a.brchno,
		         b.dtitcd,
		         'LN',
		         a.crcycd,
		         (case
	               when a.prlntg = '0' then
	                ysyjni + ysyjpi + ysxxti
	               else
	                csyjni + csyjpi + csxxoi + csxxpi
	             end) as cabrin,
		         case when a.prlntg = '0' then '1' else '8' end  bltype,
                 case when a.prlntg = '0' then 'B' else 'D' end  wdtype
		    From lna_acct_hist a
		    Join lnb_dtit b
		      On a.lncfno = b.lncfno 
		      and a.corpno = b.corpno
		     where a.acctdt = #acctdt# and a.corpno=#corpno#
		   ) aa
		   Group By aa.corpno, aa.acctdt, aa.brchno, aa.crcycd, aa.dtitcd, aa.bltype, aa.wdtype
		]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="acctdt" jdbcType="VARCHAR" javaType="string" mode="in" longname="计提日期" parameterType="condition"/>
            <parameter property="corpno" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
        </parameterMap>
    </insert>
    <select cache="none" method="selectOne" type="sql" id="sellstcbtl" longname="获取上一日计提汇总信息">
        <sql type="mysql"><![CDATA[
        select * from knb_cbtl where cabrdt =#cabrdt# and brchno =#brchno# and crcycd =#crcycd# and prodcd =#prodcd#
        ]]></sql>
        <sql type="oracle"><![CDATA[
        select * from knb_cbtl where cabrdt =#cabrdt# and brchno =#brchno# and crcycd =#crcycd# and prodcd =#prodcd#
        ]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="cabrdt" jdbcType="VARCHAR" javaType="string" mode="in" longname="计提日期" parameterType="condition"/>
            <parameter property="brchno" jdbcType="VARCHAR" javaType="string" mode="in" longname="机构号" parameterType="condition"/>
            <parameter property="crcycd" ref="PbDict.Intr.crcycd" jdbcType="VARCHAR" javaType="BaseType.U_CRCYCD" mode="in" longname="币种" parameterType="condition"/>
            <parameter property="prodcd" jdbcType="VARCHAR" javaType="string" mode="in" longname="产品代码" parameterType="condition"/>
        </parameterMap>
        <resultMap class="IoDpTable.IoKnbCbtl"/>
    </select>
    <select cache="none" method="selectOne" type="sql" id="selOnelttl" longname="获取单条利息支出记录">
        <sql type="mysql"><![CDATA[
        select * from knb_lttl where cabrdt =#cabrdt# and brchno =#brchno# and crcycd =#crcycd# and prodcd =#prodcd#
        ]]></sql>
        <sql type="oracle"><![CDATA[
        select * from knb_lttl where cabrdt =#cabrdt# and brchno =#brchno# and crcycd =#crcycd# and prodcd =#prodcd#
        ]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="cabrdt" jdbcType="VARCHAR" javaType="string" mode="in" longname="计提日期" parameterType="condition"/>
            <parameter property="brchno" jdbcType="VARCHAR" javaType="string" mode="in" longname="机构号" parameterType="condition"/>
            <parameter property="crcycd" ref="PbDict.Intr.crcycd" jdbcType="VARCHAR" javaType="BaseType.U_CRCYCD" mode="in" longname="币种" parameterType="condition"/>
            <parameter property="prodcd" jdbcType="VARCHAR" javaType="string" mode="in" longname="产品代码" parameterType="condition"/>
        </parameterMap>
        <resultMap class="IoDpTable.IoKnbCbtl"/>
    </select>
    <select cache="none" method="selectAll" type="sql" id="selknb_cbtl_selectAll" longname="获取计提利息汇总明细数据">
        <sql type="mysql"><![CDATA[select cabrdt, brchno, acctcd, crcycd, prodcd, cabrin from knb_cbtl where cabrdt=#cabrdt#]]></sql>
        <sql type="oracle"><![CDATA[select cabrdt, brchno, acctcd, crcycd, prodcd, cabrin from knb_cbtl where cabrdt=#cabrdt#]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="cabrdt" jdbcType="VARCHAR" javaType="string" mode="in" longname="汇总日期" parameterType="condition"/>
        </parameterMap>
        <resultMap class="IoDpTable.IoKnbCbtl"/>
    </select>
    <select cache="none" method="selectAll" type="sql" id="selnecbtlSeq" longname="获取总账计提供数批次号序号">
        <sql type="mysql"><![CDATA[select taskid from knb_cbtl_batch where trandt = #trandt#  group by taskid]]></sql>
        <sql type="oracle"><![CDATA[select taskid from knb_cbtl_batch where trandt = #trandt#  group by taskid]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="trandt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="文件日期" parameterType="condition"/>
        </parameterMap>
        <resultMap class="java.util.Map">
            <result property="taskid" javaType="BaseType.U_CHAR10" longname="批次号"/>
        </resultMap>
    </select>
    <insert id="insGldayEndFa" longname="日终总账核算供数">
        <sql type="mysql"><![CDATA[        
        insert into knb_cbtl_batch(corpno,trandt,taskid,opbrch,company,brchno,prodcd,chnlbr,intercom,source,spare1,spare2,crcycd,tranam,trantype,acccat,statms,filedate,tmstmp) 
    	select corpno,#trandt#,#taskid#,(@rowNum:=@rowNum+1) as lineid,acctbr,acctbr,dtitcd,servtp,'0','93','0','0',crcycd,sum(tranam),tranms,bookms,statms,#sysdat#,#tmstmp#  
    	from kns_acsq,(Select (@rowNum :=0) ) b Where trandt=#trandt# 
    	group by dtitcd,tranms,acctbr,crcycd,servtp,statms,bookms,corpno]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="trandt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="数据产生日期" parameterType="condition"/>
            <parameter property="taskid" jdbcType="VARCHAR" javaType="BaseType.U_CHAR10" mode="in" longname="批次号" parameterType="condition"/>
            <parameter property="sysdat" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="交易日期" parameterType="condition"/>
            <parameter property="tmstmp" jdbcType="VARCHAR" javaType="ApBaseType.U_TMSTMP" mode="in" longname="时间戳" parameterType="condition"/>
        </parameterMap>
    </insert>
    <select cache="none" method="selectOne" type="sql" id="selGlFaAmt" longname="日终总账核算供数借贷金额比较">
        <sql type="mysql"><![CDATA[select sum(tranam) as tranam from kns_acsq where trandt=#trandt# and amntcd = #amntcd# ]]></sql>
        <sql type="oracle"><![CDATA[select sum(tranam) as tranam from kns_acsq where trandt=#trandt# and amntcd = #amntcd# ]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="trandt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="交易日期" parameterType="condition"/>
            <parameter property="amntcd" jdbcType="VARCHAR" javaType="BaseEnumType.E_AMNTCD" mode="in" longname="借贷标志" parameterType="condition"/>
        </parameterMap>
        <resultMap class="java.math.BigDecimal"/>
    </select>
    <insert id="insglfabatchByAcct" longname="获取活期定期总分核对供数明细">
        <sql><![CDATA[
		insert into knb_glfa_batch(trandt,taskid,lineid,brchno,depart,prodcd,source,crcycd,direction,tranam,chktype,filedate) 
		select #lastdt#,#taskid#,'',brchno,brchno,acctcd,'0',crcycd,'CR',sum(case when upbldt = #trandt# then lastbl else onlnbl end) as tranam,'1010000',#lastdt# from kna_acct group by brchno,acctcd,crcycd 
		union select #lastdt#,#taskid#,'',brchno,brchno,acctcd,'93',crcycd,'CR',sum(case when upbldt = #trandt# then lastbl else onlnbl end) as tranam,'1010000',#lastdt# from kna_fxac group by brchno,acctcd,crcycd]]></sql>
        <sql type="mysql"><![CDATA[
		insert into knb_glfa_batch(trandt,taskid,lineid,brchno,depart,prodcd,source,crcycd,direction,tranam,chktype,filedate) 
		select #lastdt#,#taskid#,'',brchno,brchno,acctcd,'0',crcycd,'CR',sum(case when upbldt = #trandt# then lastbl else onlnbl end) as tranam,'1010000',#lastdt# from kna_acct group by brchno,acctcd,crcycd 
		union select #lastdt#,#taskid#,'',brchno,brchno,acctcd,'93',crcycd,'CR',sum(case when upbldt = #trandt# then lastbl else onlnbl end) as tranam,'1010000',#lastdt# from kna_fxac group by brchno,acctcd,crcycd]]></sql>
        <sql type="oracle"><![CDATA[
		insert into knb_glfa_batch(trandt,taskid,lineid,brchno,depart,prodcd,source,crcycd,direction,tranam,chktype,filedate) 
		select #lastdt#,#taskid#,'',brchno,brchno,acctcd,'0',crcycd,'CR',sum(case when upbldt = #trandt# then lastbl else onlnbl end) as tranam,'1010000',#lastdt# from kna_acct group by brchno,acctcd,crcycd 
		union select #lastdt#,#taskid#,'',brchno,brchno,acctcd,'93',crcycd,'CR',sum(case when upbldt = #trandt# then lastbl else onlnbl end) as tranam,'1010000',#lastdt# from kna_fxac group by brchno,acctcd,crcycd]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="trandt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="账务日期" parameterType="condition"/>
            <parameter property="lastdt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="上一日期" parameterType="condition"/>
            <parameter property="taskid" jdbcType="VARCHAR" javaType="BaseType.U_CHAR10" mode="in" longname="批次号" parameterType="condition"/>
        </parameterMap>
    </insert>
    <insert id="insglfabatchByGlAcct" longname="获取内部户总分核对供数明细">
        <sql><![CDATA[
        insert into knb_glfa_batch(trandt,taskid,lineid,brchno,depart,prodcd,source,crcycd,direction,tranam,chktype,filedate) 
		select #trandt#,#taskid#,'',t.brchno,t.brchno,t.busino,'1',t.crcycd,case 
		when t.busidn = 'Z' or t.busidn = 'R' or t.busidn = 'B' or t.busidn = 'D'  then 'DR' else 'CR' end,t.tranam,'1010000',#trandt# 
		from
		(select k.brchno,k.crcycd,k.busino,k.busidn,sum((case when (k.busidn = 'B' or k.busidn ='Z' or k.busidn ='R'  ) then h.drltbl -h.crltbl  when k.busidn ='D' then h.drltbl  else h.crltbl end)) as tranam  
		from gl_kna_lsbl h,gl_kna_acct k where h.acctno=k.acctno group by k.brchno,k.crcycd,k.busino,k.busidn) t 
		]]></sql>
        <sql type="mysql"><![CDATA[
        insert into knb_glfa_batch(trandt,taskid,lineid,brchno,depart,prodcd,source,crcycd,direction,tranam,chktype,filedate) 
		select #trandt#,#taskid#,'',t.brchno,t.brchno,t.busino,'1',t.crcycd,case 
		when t.busidn = 'Z' or t.busidn = 'R' or t.busidn = 'B' or t.busidn = 'D'  then 'DR' else 'CR' end,t.tranam,'1010000',#trandt# 
		from
		(select k.brchno,k.crcycd,k.busino,k.busidn,sum((case when (k.busidn = 'B' or k.busidn ='Z' or k.busidn ='R'  ) then h.drltbl -h.crltbl  when k.busidn ='D' then h.drltbl  else h.crltbl end)) as tranam  
		from gl_kna_lsbl h,gl_kna_acct k where h.acctno=k.acctno group by k.brchno,k.crcycd,k.busino,k.busidn) t 
		]]></sql>
        <sql type="oracle"><![CDATA[
        insert into knb_glfa_batch(trandt,taskid,lineid,brchno,depart,prodcd,source,crcycd,direction,tranam,chktype,filedate) 
		select #trandt#,#taskid#,'',t.brchno,t.brchno,t.busino,'1',t.crcycd,case 
		when t.busidn = 'Z' or t.busidn = 'R' or t.busidn = 'B' or t.busidn = 'D'  then 'DR' else 'CR' end,t.tranam,'1010000',#trandt# 
		from
		(select k.brchno,k.crcycd,k.busino,k.busidn,sum((case when (k.busidn = 'B' or k.busidn ='Z' or k.busidn ='R'  ) then h.drltbl -h.crltbl  when k.busidn ='D' then h.drltbl  else h.crltbl end)) as tranam  
		from gl_kna_lsbl h,gl_kna_acct k where h.acctno=k.acctno group by k.brchno,k.crcycd,k.busino,k.busidn) t 
		]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="trandt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="账务日期" parameterType="condition"/>
            <parameter property="taskid" jdbcType="VARCHAR" javaType="BaseType.U_CHAR10" mode="in" longname="批次号" parameterType="condition"/>
        </parameterMap>
    </insert>
    <select cache="none" method="selectAll" type="sql" id="selglfabatch" longname="获取总分核对供数批次号序号">
        <sql><![CDATA[select taskid from knb_glfa_batch where trandt = #trandt#  group by taskid]]></sql>
        <sql type="mysql"><![CDATA[select taskid from knb_glfa_batch where trandt = #trandt#  group by taskid]]></sql>
        <sql type="oracle"><![CDATA[select taskid from knb_glfa_batch where trandt = #trandt#  group by taskid]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="trandt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="文件日期" parameterType="condition"/>
        </parameterMap>
        <resultMap class="java.util.Map">
            <result property="taskid" javaType="BaseType.U_CHAR10" longname="批次号"/>
        </resultMap>
    </select>
    <insert id="insglfabatchByWact" longname="获取钱包总分核对供数明细">
        <sql><![CDATA[Insert Into knb_glfa_batch(trandt,taskid,lineid,brchno,depart,prodcd,source,crcycd,direction,tranam,filedate) 
		select #trandt#,#taskid#,'',brchno,brchno,prodcd,'93',crcycd,'CR',sum(case when upbldt = #trandt# then lastbl else onlnbl end) as tranam,#trandt# from kna_wact group by brchno,prodcd,crcycd ]]></sql>
        <sql type="mysql"><![CDATA[Insert Into knb_glfa_batch(trandt,taskid,lineid,brchno,depart,prodcd,source,crcycd,direction,tranam,filedate) 
		select #trandt#,#taskid#,'',brchno,brchno,prodcd,'93',crcycd,'CR',sum(case when upbldt = #trandt# then lastbl else onlnbl end) as tranam,#trandt# from kna_wact group by brchno,prodcd,crcycd ]]></sql>
        <sql type="oracle"><![CDATA[Insert Into knb_glfa_batch(trandt,taskid,lineid,brchno,depart,prodcd,source,crcycd,direction,tranam,filedate) 
		select #trandt#,#taskid#,'',brchno,brchno,prodcd,'93',crcycd,'CR',sum(case when upbldt = #trandt# then lastbl else onlnbl end) as tranam,#trandt# from kna_wact group by brchno,prodcd,crcycd ]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="trandt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="账务日期" parameterType="condition"/>
            <parameter property="taskid" jdbcType="VARCHAR" javaType="BaseType.U_CHAR10" mode="in" longname="批次号" parameterType="condition"/>
        </parameterMap>
    </insert>
    <select cache="none" method="selectOne" type="sql" id="selglfaInfo" longname="获取上上日余额汇总">
        <sql><![CDATA[select * from knb_glfa_batch where trandt = #trandt# and brchno = #brchno# and prodcd = #prodcd# and crcycd = #crcycd# and chktype = '1010000' ]]></sql>
        <sql type="mysql"><![CDATA[select * from knb_glfa_batch where trandt = #trandt# and brchno = #brchno# and prodcd = #prodcd# and crcycd = #crcycd# and chktype = '1010000' ]]></sql>
        <sql type="oracle"><![CDATA[select * from knb_glfa_batch where trandt = #trandt# and brchno = #brchno# and prodcd = #prodcd# and crcycd = #crcycd# and chktype = '1010000' ]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="trandt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="日期" parameterType="condition"/>
            <parameter property="brchno" jdbcType="VARCHAR" javaType="BaseType.U_BRCHNO" mode="in" longname="机构号" parameterType="condition"/>
            <parameter property="prodcd" jdbcType="VARCHAR" javaType="BaseType.U_PRODCD" mode="in" longname="产品代码" parameterType="condition"/>
            <parameter property="crcycd" ref="BaseDict.Comm.crcycd" jdbcType="VARCHAR" javaType="BaseType.U_CRCYCD" mode="in" longname="币种" parameterType="condition"/>
        </parameterMap>
        <resultMap class="In.KnbGlfaBatch"/>
    </select>
    <delete method="delete" id="delglfabatchByDay" longname="删除总分核对供数明细">
        <sql><![CDATA[delete from knb_glfa_batch where trandt = #trandt#]]></sql>
        <sql type="mysql"><![CDATA[delete from knb_glfa_batch where trandt = #trandt#]]></sql>
        <sql type="oracle"><![CDATA[delete from knb_glfa_batch where trandt = #trandt#]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="trandt" jdbcType="VARCHAR" javaType="string" mode="in" longname="汇总日期" parameterType="condition"/>
        </parameterMap>
    </delete>
    <insert id="insknbFatlAcsq" longname="获取当日发生额汇总明细">
        <sql><![CDATA[insert into knb_fatl_acsq(trandt,brchno,prodcd,crcycd,tranam) select trandt,acctbr,dtitcd,crcycd, sum(case when (amntcd ='C' or amntcd = 'P') then 0-tranam 
		else tranam end) as amt from kns_acsq  where trandt = #trandt# and bltype = '0' and atowtp !='2' group by trandt,acctbr,dtitcd,crcycd ]]></sql>
        <sql type="mysql"><![CDATA[insert into knb_fatl_acsq(trandt,brchno,prodcd,crcycd,tranam) select trandt,acctbr,dtitcd,crcycd, sum(case when (amntcd ='C' or amntcd = 'P') then 0-tranam 
		else tranam end) as amt from kns_acsq  where trandt = #trandt# and bltype = '0' and atowtp !='2' group by trandt,acctbr,dtitcd,crcycd ]]></sql>
        <sql type="oracle"><![CDATA[insert into knb_fatl_acsq(trandt,brchno,prodcd,crcycd,tranam) select trandt,acctbr,dtitcd,crcycd, sum(case when (amntcd ='C' or amntcd = 'P') then 0-tranam 
		else tranam end) as amt from kns_acsq  where trandt = #trandt# and bltype = '0' and atowtp !='2' group by trandt,acctbr,dtitcd,crcycd ]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="trandt" jdbcType="VARCHAR" javaType="string" mode="in" longname="汇总日期" parameterType="condition"/>
        </parameterMap>
    </insert>
    <select cache="none" method="selectAll" type="sql" id="selknbGlfaBatch" longname="获取当日总分核对供数余额">
        <sql><![CDATA[select trandt,brchno,prodcd,crcycd,tranam,direction from knb_glfa_batch where trandt =#trandt#]]></sql>
        <sql type="mysql"><![CDATA[select trandt,brchno,prodcd,crcycd,tranam,direction from knb_glfa_batch where trandt =#trandt#]]></sql>
        <sql type="oracle"><![CDATA[select trandt,brchno,prodcd,crcycd,tranam,direction from knb_glfa_batch where trandt =#trandt#]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="trandt" jdbcType="VARCHAR" javaType="string" mode="in" longname="汇总日期" parameterType="condition"/>
        </parameterMap>
        <resultMap class="IoDpTable.Iofatlacsq"/>
    </select>
    <select cache="none" method="selectOne" type="sql" id="selglacsqInfo" longname="获取上日余额发生额汇总">
        <sql><![CDATA[select tranam from knb_fatl_acsq where trandt = #trandt# and brchno = #brchno# and prodcd = #prodcd# and crcycd = #crcycd# ]]></sql>
        <sql type="mysql"><![CDATA[select tranam from knb_fatl_acsq where trandt = #trandt# and brchno = #brchno# and prodcd = #prodcd# and crcycd = #crcycd# ]]></sql>
        <sql type="oracle"><![CDATA[select tranam from knb_fatl_acsq where trandt = #trandt# and brchno = #brchno# and prodcd = #prodcd# and crcycd = #crcycd# ]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="trandt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="日期" parameterType="condition"/>
            <parameter property="brchno" jdbcType="VARCHAR" javaType="BaseType.U_BRCHNO" mode="in" longname="机构号" parameterType="condition"/>
            <parameter property="prodcd" jdbcType="VARCHAR" javaType="BaseType.U_PRODCD" mode="in" longname="产品代码" parameterType="condition"/>
            <parameter property="crcycd" ref="BaseDict.Comm.crcycd" jdbcType="VARCHAR" javaType="BaseType.U_CRCYCD" mode="in" longname="币种" parameterType="condition"/>
        </parameterMap>
        <resultMap class="java.math.BigDecimal"/>
    </select>
    <delete method="delete" id="delknbfatlAcsq" longname="删除当日发生额汇总">
        <sql><![CDATA[delete from knb_fatl_acsq where trandt = #trandt#]]></sql>
        <sql type="mysql"><![CDATA[delete from knb_fatl_acsq where trandt = #trandt#]]></sql>
        <sql type="oracle"><![CDATA[delete from knb_fatl_acsq where trandt = #trandt#]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="trandt" jdbcType="VARCHAR" javaType="string" mode="in" longname="汇总日期" parameterType="condition"/>
        </parameterMap>
    </delete>
    <delete method="delete" id="Del_Knb_Cbtl" longname="删除计提汇总信息">
        <sql><![CDATA[delete from knb_cbtl Where cabrdt = #cabrdt# and corpno=#corpno#]]></sql>
        <sql type="mysql"><![CDATA[delete from knb_cbtl Where cabrdt = #cabrdt# and corpno=#corpno#]]></sql>
        <sql type="oracle"><![CDATA[delete from knb_cbtl Where cabrdt = #cabrdt# and corpno=#corpno#]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="cabrdt" jdbcType="VARCHAR" javaType="string" mode="in" longname="计提日期" parameterType="condition"/>
            <parameter property="corpno" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
        </parameterMap>
    </delete>
    <delete method="delete" id="Del_Lnb_Cbtl" longname="删除贷款计提汇总信息">
        <sql><![CDATA[delete from lnb_cbtl Where cabrdt = #cabrdt# and corpno=#corpno#]]></sql>
        <sql type="oracle"><![CDATA[delete from lnb_cbtl Where cabrdt = #cabrdt# and corpno=#corpno#]]></sql>
        <sql type="mysql"><![CDATA[delete from lnb_cbtl Where cabrdt = #cabrdt# and corpno=#corpno#]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="cabrdt" jdbcType="VARCHAR" javaType="string" mode="in" longname="计提日期" parameterType="condition"/>
            <parameter property="corpno" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
        </parameterMap>
    </delete>
    <select cache="none" method="selectAll" type="sql" id="selcbtlWriteDate" longname="获取总账计提利息写批量文件数据">
        <sql><![CDATA[select * from knb_cbtl_batch where trandt=#trandt#]]></sql>
        <sql type="mysql"><![CDATA[select * from knb_cbtl_batch where trandt=#trandt#]]></sql>
        <sql type="oracle"><![CDATA[select * from knb_cbtl_batch where trandt=#trandt#]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="trandt" ref="BaseDict.Comm.trandt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="交易日期" parameterType="condition"/>
        </parameterMap>
        <resultMap class="In.KnbCbtlBatch"/>
    </select>
    <select cache="none" method="selectAll" type="sql" id="selglfaWriteData" longname="获取总分核对供数明细">
        <sql type="mysql"><![CDATA[select trandt,taskid,(@rowNum:=@rowNum+1) as lineid,brchno,depart,prodcd,source,crcycd,direction,tranam,chktype,attribute1,attribute2,attribute3,attribute4,attribute5,filedate from knb_glfa_batch,(Select (@rowNum :=0) ) b where taskid=#filesq#]]></sql>
        <sql type="oracle"><![CDATA[select trandt,taskid,rownum as lineid,brchno,depart,prodcd,source,crcycd,direction,tranam,chktype,attribute1,attribute2,attribute3,attribute4,attribute5,filedate from knb_glfa_batch where taskid=#filesq#]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="filesq" jdbcType="VARCHAR" javaType="string" mode="in" longname="文件批次号" parameterType="condition"/>
        </parameterMap>
        <resultMap class="In.KnbGlfaBatch"/>
    </select>
    <select cache="none" method="selectAll" type="sql" id="selknsacsqcollBystatus" longname="根据状态获取清算汇总明细">
        <sql><![CDATA[select  *  from kns_acsq_coll where  clerdt =#clerdt# and clenum =#clenum# and  status=#status#]]></sql>
        <sql type="oracle"><![CDATA[select  *  from kns_acsq_coll where  clerdt =#clerdt# and clenum =#clenum# and  status=#status#]]></sql>
        <sql type="mysql"><![CDATA[select  *  from kns_acsq_coll where  clerdt =#clerdt# and clenum =#clenum# and  status=#status#]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="clerdt" ref="BaseDict.Comm.clerdt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="清算日期" parameterType="condition"/>
            <parameter property="clenum" jdbcType="VARCHAR" javaType="BaseType.U_INTEGE" mode="in" longname="清算场次" parameterType="condition"/>
            <parameter property="status" jdbcType="VARCHAR" javaType="InEnumType.E_CLERST" mode="in" longname="状态" parameterType="condition"/>
        </parameterMap>
        <resultMap class="In.KnsAcsqColl"/>
    </select>
    <select cache="none" method="selectAll" type="sql" id="selKnsacsqcollByDay" longname="根据日期状态获取清算汇总明细">
        <sql><![CDATA[select * from kns_acsq_coll where status=#status# and trandt = #trandt#]]></sql>
        <sql type="mysql"><![CDATA[select * from kns_acsq_coll where status=#status# and trandt = #trandt#]]></sql>
        <sql type="oracle"><![CDATA[select * from kns_acsq_coll where status=#status# and trandt = #trandt#]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="trandt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="记账日期" parameterType="condition"/>
            <parameter property="status" jdbcType="VARCHAR" javaType="InEnumType.E_CLERST" mode="in" longname="清算状态" parameterType="condition"/>
        </parameterMap>
        <resultMap class="IoInTable.IoKnsAcsqColl"/>
    </select>
    <insert id="InscbtlToglfaData" longname="将应计提利息数据插入总分核对数据中">
        <sql><![CDATA[insert into knb_glfa_batch(trandt,taskid,lineid,brchno,depart,prodcd,source,crcycd,direction,tranam,chktype,filedate) 
		select #lastdt#,#taskid#,'',brchno,brchno,acctcd,'93',crcycd,'CR',cabrin,'1020000',#lastdt# from knb_cbtl where cabrdt = #lastdt#]]></sql>
        <sql type="oracle"><![CDATA[insert into knb_glfa_batch(trandt,taskid,lineid,brchno,depart,prodcd,source,crcycd,direction,tranam,chktype,filedate) 
		select #lastdt#,#taskid#,'',brchno,brchno,acctcd,'93',crcycd,'CR',cabrin,'1020000',#lastdt# from knb_cbtl where cabrdt = #lastdt#]]></sql>
        <sql type="mysql"><![CDATA[insert into knb_glfa_batch(trandt,taskid,lineid,brchno,depart,prodcd,source,crcycd,direction,tranam,chktype,filedate) 
		select #lastdt#,#taskid#,'',brchno,brchno,acctcd,'93',crcycd,'CR',cabrin,'1020000',#lastdt# from knb_cbtl where cabrdt = #lastdt#]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="lastdt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="上一日期" parameterType="condition"/>
            <parameter property="taskid" jdbcType="VARCHAR" javaType="BaseType.U_CHAR10" mode="in" longname="批次号" parameterType="condition"/>
        </parameterMap>
    </insert>
    <insert id="InsChrgToglfaData" longname="将费用账务数据插入总分核对数据中">
        <sql><![CDATA[
		insert into knb_glfa_batch(trandt,taskid,lineid,brchno,depart,prodcd,source,crcycd,direction,tranam,chktype,attribute1,filedate) 
		select #lastdt#,#taskid#,'',acctbr,acctbr,dtitcd,'93',crcycd,case when amntcd ='D' then 'DR' else 'CR' end ,sum(tranam),'1030000',tranms,#lastdt#
		from kns_acsq  where trandt = #lastdt# and atowtp='2' group by acctbr ,dtitcd,crcycd,amntcd,tranms 
		]]></sql>
        <sql type="oracle"><![CDATA[
		insert into knb_glfa_batch(trandt,taskid,lineid,brchno,depart,prodcd,source,crcycd,direction,tranam,chktype,attribute1,filedate) 
		select #lastdt#,#taskid#,'',acctbr,acctbr,dtitcd,'93',crcycd,case when amntcd ='D' then 'DR' else 'CR' end ,sum(tranam),'1030000',tranms,#lastdt#
		from kns_acsq  where trandt = #lastdt# and atowtp='2' group by acctbr ,dtitcd,crcycd,amntcd,tranms 
		]]></sql>
        <sql type="mysql"><![CDATA[
		insert into knb_glfa_batch(trandt,taskid,lineid,brchno,depart,prodcd,source,crcycd,direction,tranam,chktype,attribute1,filedate) 
		select #lastdt#,#taskid#,'',acctbr,acctbr,dtitcd,'93',crcycd,case when amntcd ='D' then 'DR' else 'CR' end ,sum(tranam),'1030000',tranms,#lastdt#
		from kns_acsq  where trandt = #lastdt# and atowtp='2' group by acctbr ,dtitcd,crcycd,amntcd,tranms 
		]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="lastdt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="上一日期" parameterType="condition"/>
            <parameter property="taskid" jdbcType="VARCHAR" javaType="BaseType.U_CHAR10" mode="in" longname="批次号" parameterType="condition"/>
        </parameterMap>
    </insert>
    <select cache="none" method="selectAll" type="sql" id="selGldayEndFa" longname="查询核算数据">
        <sql><![CDATA[       
		select acctbr as company ,acctbr as brchno ,dtitcd as prodcd,servtp as chnlbr , '0' as intercom,'93' as source ,'0' as spare1 ,'0' as spare2 ,
		crcycd as crcycd ,sum(tranam) as tranam , tranms as trantype,bookms as acccat,statms as statms
    	from kns_acsq Where trandt=#trandt# 
    	group by dtitcd,tranms,acctbr,crcycd,servtp,statms,bookms]]></sql>
        <sql type="mysql"><![CDATA[       
		select acctbr as company ,acctbr as brchno ,dtitcd as prodcd,servtp as chnlbr , '0' as intercom,'93' as source ,'0' as spare1 ,'0' as spare2 ,
		crcycd as crcycd ,sum(tranam) as tranam , tranms as trantype,bookms as acccat,statms as statms
    	from kns_acsq Where trandt=#trandt# 
    	group by dtitcd,tranms,acctbr,crcycd,servtp,statms,bookms]]></sql>
        <sql type="oracle"><![CDATA[       
		select acctbr as company ,acctbr as brchno ,dtitcd as prodcd,servtp as chnlbr , '0' as intercom,'93' as source ,'0' as spare1 ,'0' as spare2 ,
		crcycd as crcycd ,sum(tranam) as tranam , tranms as trantype,bookms as acccat,statms as statms
    	from kns_acsq Where trandt=#trandt# 
    	group by dtitcd,tranms,acctbr,crcycd,servtp,statms,bookms]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="trandt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="数据产生日期" parameterType="condition"/>
            <parameter property="taskid" jdbcType="VARCHAR" javaType="BaseType.U_CHAR10" mode="in" longname="批次号" parameterType="condition"/>
        </parameterMap>
        <resultMap class="In.KnbCbtlBatch"/>
    </select>
    <select cache="none" method="selectOne" type="sql" id="selMaxIdByTaskid" longname="查询批次下最大序号">
        <sql><![CDATA[       
		select max (opbrch) from knb_cbtl_batch where taskid =#taskid#]]></sql>
        <sql type="mysql"><![CDATA[       
		select max (opbrch) from knb_cbtl_batch where taskid =#taskid#]]></sql>
        <sql type="oracle"><![CDATA[       
		select max (opbrch) from knb_cbtl_batch where taskid =#taskid#]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="taskid" ref="ApDict.Aplt.taskid" jdbcType="VARCHAR" javaType="BaseType.U_CHAR40" mode="in" longname="批量交易批次号" parameterType="condition"/>
        </parameterMap>
        <resultMap class="int"/>
    </select>
    <select cache="none" method="selectAll" type="sql" id="selknlioblWriteData" longname="获取出入金对账明细">
        <sql type="db2"><![CDATA[select info.* from (
		select 
		servsq , busisq , trandt , keepdt , capitp , tranam , ioflag , 
		cardno , cuacno , acctno , brchno , toacct , toscac , 
		toacno , tobrch , status 
		from knl_iobl where trandt >= #lastdt# and trandt<=#nextdt#
		union all
		select 
		servsq , busisq , trandt , keepdt , capitp , tranam , ioflag , 
		incard as cardno , null as cuacno , null as acctno , inbrch as brchno ,
		toacct , toscac , toacno , tobrch , status 
		from knl_spnd where trandt >= #lastdt# and trandt<=#nextdt#
		)info order by trandt asc]]></sql>
        <sql type="oracle"><![CDATA[select info.* from (
		select 
		servsq , busisq , trandt , keepdt , capitp , tranam , ioflag , 
		cardno , cuacno , acctno , brchno , toacct , toscac , 
		toacno , tobrch , status 
		from knl_iobl where trandt >= #lastdt# and trandt<=#nextdt#
		union all
		select 
		servsq , busisq , trandt , keepdt , capitp , tranam , ioflag , 
		incard as cardno , null as cuacno , null as acctno , inbrch as brchno ,
		toacct , toscac , toacno , tobrch , status 
		from knl_spnd where trandt >= #lastdt# and trandt<=#nextdt#
		)info order by trandt asc]]></sql>
        <sql type="mysql"><![CDATA[select info.* from (
		select 
		servsq , busisq , trandt , keepdt , capitp , tranam , ioflag , 
		cardno , cuacno , acctno , brchno , toacct , toscac , 
		toacno , tobrch , status 
		from knl_iobl where trandt >= #lastdt# and trandt<=#nextdt#
		union all
		select 
		servsq , busisq , trandt , keepdt , capitp , tranam , ioflag , 
		incard as cardno , null as cuacno , null as acctno , inbrch as brchno ,
		toacct , toscac , toacno , tobrch , status 
		from knl_spnd where trandt >= #lastdt# and trandt<=#nextdt#
		)info order by trandt asc]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="lastdt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="上日日期" parameterType="condition"/>
            <parameter property="nextdt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="下日日期" parameterType="condition"/>
        </parameterMap>
        <resultMap class="IoDpTable.IoKnlIobl"/>
    </select>
    <select cache="none" method="selectAll" type="sql" id="selKnsAcsqClerInfo" longname="获取待清算账户核准">
        <sql><![CDATA[
        select c.trandt,c.mntrsq,c.prodcd,c.clactp,c.acctbr,c.crcycd,c.amntcd,c.tranam,c.servtp,c.coredt as clerdt,c.clenum,
		(case when c.status in('1','2') then c.status else '0' end) as status,c.coredt
		from (select a.* ,b.status,b.trandt as coredt
		from kns_acsq_cler a 
		left join 
		(select status,clerdt,clenum,trandt from kns_acsq_coll group by status,clerdt,clenum,trandt) b
		on(a.clerdt=b.clerdt and a.clenum=b.clenum)
		where b.trandt>=#lastdt# and b.trandt<=#nextdt# and a.prodcd<>'9930410306') c
		]]></sql>
        <sql type="mysql"><![CDATA[
        select c.trandt,c.mntrsq,c.prodcd,c.clactp,c.acctbr,c.crcycd,c.amntcd,c.tranam,c.servtp,c.coredt as clerdt,c.clenum,
		(case when c.status in('1','2') then c.status else '0' end) as status,c.coredt
		from (select a.* ,b.status,b.trandt as coredt
		from kns_acsq_cler a 
		left join 
		(select status,clerdt,clenum,trandt from kns_acsq_coll group by status,clerdt,clenum,trandt) b
		on(a.clerdt=b.clerdt and a.clenum=b.clenum)
		where b.trandt>=#lastdt# and b.trandt<=#nextdt# and a.prodcd<>'9930410306') c
		]]></sql>
        <sql type="oracle"><![CDATA[
        select c.trandt,c.mntrsq,c.prodcd,c.clactp,c.acctbr,c.crcycd,c.amntcd,c.tranam,c.servtp,c.coredt as clerdt,c.clenum,
		(case when c.status in('1','2') then c.status else '0' end) as status,c.coredt
		from (select a.* ,b.status,b.trandt as coredt
		from kns_acsq_cler a 
		left join 
		(select status,clerdt,clenum,trandt from kns_acsq_coll group by status,clerdt,clenum,trandt) b
		on(a.clerdt=b.clerdt and a.clenum=b.clenum)
		where b.trandt>=#lastdt# and b.trandt<=#nextdt# and a.prodcd<>'9930410306') c
		]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="lastdt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="上一日" parameterType="condition"/>
            <parameter property="nextdt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="下一日" parameterType="condition"/>
        </parameterMap>
        <resultMap class="InQueryTypes.InClerckInfo"/>
    </select>
    <select cache="none" method="selectAll" type="sql" id="selGldayEndFaDetail" longname="查询核算数据">
        <sql><![CDATA[       
		select acctbr as company ,acctbr as brchno ,dtitcd as prodcd,servtp as chnlbr , '0' as intercom,'93' as source ,'0' as spare1 ,'0' as spare2 ,crcycd as crcycd , tranam , tranms as trantype,bookms as acccat,statms as statms,transq as attribute10
    	from kns_acsq Where trandt=#trandt# 
    	]]></sql>
        <sql type="oracle"><![CDATA[       
		select acctbr as company ,acctbr as brchno ,dtitcd as prodcd,servtp as chnlbr , '0' as intercom,'93' as source ,'0' as spare1 ,'0' as spare2 ,crcycd as crcycd , tranam , tranms as trantype,bookms as acccat,statms as statms,transq as attribute10
    	from kns_acsq Where trandt=#trandt# 
    	]]></sql>
        <sql type="mysql"><![CDATA[       
		select acctbr as company ,acctbr as brchno ,dtitcd as prodcd,servtp as chnlbr , '0' as intercom,'93' as source ,'0' as spare1 ,'0' as spare2 ,crcycd as crcycd , tranam , tranms as trantype,bookms as acccat,statms as statms,transq as attribute10
    	from kns_acsq Where trandt=#trandt# 
    	]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="trandt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="数据产生日期" parameterType="condition"/>
            <parameter property="taskid" jdbcType="VARCHAR" javaType="BaseType.U_CHAR10" mode="in" longname="批次号" parameterType="condition"/>
        </parameterMap>
        <resultMap class="In.KnbCbtlBatch"/>
    </select>
    <select cache="none" method="selectAll" type="sql" id="selGlKnsGlvcRpsAcctnoTranam" longname="获取红包过渡户发生额">
        <sql type="db2"><![CDATA[
		select b.brchno,case when b.subsac ='0000003' then '01'  when  b.subsac ='0000002' then '02'   when  b.subsac ='0000001' then '03' end as rpsrtp, b.acctno,b.acctna,
       	sum( case when a.amntcd ='D' then tranam else 0 end) as drtram ,sum( case when a.amntcd ='C' then tranam else 0 end) as crtram,b.crctbl
        from gl_kns_glvc a ,gl_kna_acct b 
        where a.trandt =#trandt# and a.acctno =b.acctno  and b.busino ='9922410142' and b.subsac in ('0000001','0000002','0000003') 
        group by  b.brchno,b.acctno ,b.acctna,b.subsac,b.crctbl order by b.brchno
		]]></sql>
        <sql type="oracle"><![CDATA[
		select b.brchno,case when b.subsac ='0000003' then '01'  when  b.subsac ='0000002' then '02'   when  b.subsac ='0000001' then '03' end as rpsrtp, b.acctno,b.acctna,
       	sum( case when a.amntcd ='D' then tranam else 0 end) as drtram ,sum( case when a.amntcd ='C' then tranam else 0 end) as crtram,b.crctbl
        from gl_kns_glvc a ,gl_kna_acct b 
        where a.trandt =#trandt# and a.acctno =b.acctno  and b.busino ='9922410142' and b.subsac in ('0000001','0000002','0000003') 
        group by  b.brchno,b.acctno ,b.acctna,b.subsac,b.crctbl order by b.brchno
		]]></sql>
        <sql type="mysql"><![CDATA[
		select b.brchno,case when b.subsac ='0000003' then '01'  when  b.subsac ='0000002' then '02'   when  b.subsac ='0000001' then '03' end as rpsrtp, b.acctno,b.acctna,
       	sum( case when a.amntcd ='D' then tranam else 0 end) as drtram ,sum( case when a.amntcd ='C' then tranam else 0 end) as crtram,b.crctbl
        from gl_kns_glvc a ,gl_kna_acct b 
        where a.trandt =#trandt# and a.acctno =b.acctno  and b.busino ='9922410142' and b.subsac in ('0000001','0000002','0000003') 
        group by  b.brchno,b.acctno ,b.acctna,b.subsac,b.crctbl order by b.brchno
		]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="trandt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="交易日期" parameterType="condition"/>
        </parameterMap>
        <resultMap class="InQueryTypes.InTotalTranamInfo"/>
    </select>
    <select cache="none" method="selectAll" type="sql" id="selKnsAcsqClinInfo" longname="查询系统内法人清算数据">
        <sql type="db2"><![CDATA[select trandt,mntrsq from kns_acsq_clin where clerst = #clerst# and trandt = #trandt# group by trandt,mntrsq]]></sql>
        <sql type="mysql"><![CDATA[select trandt,mntrsq from kns_acsq_clin where clerst = #clerst# and trandt = #trandt# group by trandt,mntrsq]]></sql>
        <sql type="oracle"><![CDATA[select trandt,mntrsq from kns_acsq_clin where clerst = #clerst# and trandt = #trandt# group by trandt,mntrsq]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="clerst" jdbcType="VARCHAR" javaType="BaseEnumType.E_CLERST" mode="in" longname="数据同步状态" parameterType="condition"/>
            <parameter property="trandt" ref="BaseDict.Comm.trandt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="交易日期" parameterType="condition"/>
        </parameterMap>
        <resultMap class="IoAccountComplexType.IoAccountClearInfo"/>
    </select>
    <select cache="none" method="selectAll" type="sql" id="selKnsAcsqClinByTransq" longname="根据交易流水查询系统内法人清算数据">
        <sql type="db2"><![CDATA[select * from kns_acsq_clin where trandt = #trandt# and mntrsq = #mntrsq# and clerst = #clerst# for update]]></sql>
        <sql type="mysql"><![CDATA[select * from kns_acsq_clin where trandt = #trandt# and mntrsq = #mntrsq# and clerst = #clerst# for update]]></sql>
        <sql type="oracle"><![CDATA[select * from kns_acsq_clin where trandt = #trandt# and mntrsq = #mntrsq# and clerst = #clerst# for update]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="trandt" ref="BaseDict.Comm.trandt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="交易日期" parameterType="condition"/>
            <parameter property="mntrsq" ref="DpDict.Froz.mntrsq" jdbcType="VARCHAR" javaType="BaseType.U_SEQUNO" mode="in" longname="主交易流水" parameterType="condition"/>
            <parameter property="clerst" jdbcType="VARCHAR" javaType="BaseEnumType.E_CLERST" mode="in" longname="数据同步状态" parameterType="condition"/>
        </parameterMap>
        <resultMap class="IoAccountComplexType.IoAccountClearInfo"/>
    </select>
    <update method="update" id="updKnsAcsqClinByTransq" longname="根据交易流水更新系统内法人清算状态">
        <sql type="db2"><![CDATA[update kns_acsq_clin a set a.clerst = #clerst#,clersq = #clersq# where trandt = #trandt# and mntrsq = #mntrsq#]]></sql>
        <sql type="mysql"><![CDATA[update kns_acsq_clin a set a.clerst = #clerst#,clersq = #clersq# where trandt = #trandt# and mntrsq = #mntrsq#]]></sql>
        <sql type="oracle"><![CDATA[update kns_acsq_clin a set a.clerst = #clerst#,clersq = #clersq# where trandt = #trandt# and mntrsq = #mntrsq#]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="trandt" ref="BaseDict.Comm.trandt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="交易日期" parameterType="condition"/>
            <parameter property="mntrsq" ref="DpDict.Froz.mntrsq" jdbcType="VARCHAR" javaType="BaseType.U_SEQUNO" mode="in" longname="主交易流水" parameterType="condition"/>
            <parameter property="clerst" jdbcType="VARCHAR" javaType="BaseEnumType.E_CLERST" mode="in" longname="数据同步状态" parameterType="condition"/>
            <parameter property="clersq" jdbcType="VARCHAR" javaType="BaseType.U_SEQUNO" mode="in" longname="清算记账流水" parameterType="condition"/>
        </parameterMap>
    </update>
    <update method="update" id="updateKnsAcsqCollByBathid" longname="根据批次号更新清算记录状态">
        <sql><![CDATA[update kns_acsq_coll a set a.status = #status# where bathid =#bathid#]]></sql>
        <sql type="mysql"><![CDATA[update kns_acsq_coll a set a.status = #status# where bathid =#bathid#]]></sql>
        <sql type="db2"><![CDATA[update kns_acsq_coll a set a.status = #status# where bathid =#bathid#]]></sql>
        <sql type="oracle"><![CDATA[update kns_acsq_coll a set a.status = #status# where bathid =#bathid#]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="status" jdbcType="VARCHAR" javaType="InEnumType.E_CLERST" mode="in" longname="状态" parameterType="condition"/>
            <parameter property="bathid" jdbcType="VARCHAR" javaType="BaseType.U_CHAR40" mode="in" longname="批次号" parameterType="condition"/>
        </parameterMap>
    </update>
    <select cache="none" method="selectOne" type="sql" id="selKnsAcsqCollStatus" longname="检查清算并账异常情况">
        <sql><![CDATA[select count(1) from kns_acsq_coll where status ='0']]></sql>
        <sql type="mysql"><![CDATA[select count(1) from kns_acsq_coll where status ='0']]></sql>
        <sql type="oracle"><![CDATA[select count(1) from kns_acsq_coll where status ='0']]></sql>
        <sql type="db2"><![CDATA[select count(1) from kns_acsq_coll where status ='0']]></sql>
        <parameterMap class="java.util.Map"/>
        <resultMap class="int"/>
    </select>
    <select cache="none" method="selectOne" type="sql" id="selKnbCbtlBatchAm" longname="取核算表中的交易总金额">
        <sql><![CDATA[select sum(tranam) as tranam from knb_cbtl_batch where trandt=#trandt#]]></sql>
        <sql type="mysql"><![CDATA[select sum(tranam) as tranam from knb_cbtl_batch where trandt=#trandt#]]></sql>
        <sql type="db2"><![CDATA[select sum(tranam) as tranam from knb_cbtl_batch where trandt=#trandt#]]></sql>
        <sql type="oracle"><![CDATA[select sum(tranam) as tranam from knb_cbtl_batch where trandt=#trandt#]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="trandt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="交易日期" parameterType="condition"/>
        </parameterMap>
        <resultMap class="java.math.BigDecimal"/>
    </select>
    <select cache="none" method="selectOne" type="sql" id="selSumGlFaAmt" longname="查询总发生额">
        <sql type="oracle"><![CDATA[select sum(tranam) as tranam from kns_acsq where trandt=#trandt#]]></sql>
        <sql type="mysql"><![CDATA[select sum(tranam) as tranam from kns_acsq where trandt=#trandt#]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="trandt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="交易日期" parameterType="condition"/>
        </parameterMap>
        <resultMap class="java.math.BigDecimal"/>
    </select>
    <select cache="none" method="selectAll" type="sql" id="selGlKnpBusiList" longname="获取内部户产品信息">
        <sql type="oracle"><![CDATA[
		select * from gl_knp_busi where busist ='5'
        ]]></sql>
        <sql type="mysql"><![CDATA[
		select * from gl_knp_busi where busist ='5'
        ]]></sql>
        <parameterMap class="java.util.Map"/>
        <resultMap class="IoInTable.IoGlKnpBusi"/>
    </select>
    <select cache="none" method="selectAll" type="sql" id="selKnsAcsqList" longname="查询会计流水信息">
        <sql type="oracle"><![CDATA[
			SELECT
			    transq AS trxn_seq,
			    sortno AS data_sort,
			    cuacno AS acctno,
			    acseno AS sub_acct_seq,
			    trandt AS trxn_date,
			    tranam AS trxn_amt,
			    CASE
			        WHEN amntcd = 'R'
			        THEN 'D'
			        WHEN amntcd = 'P'
			        THEN 'C'
			        ELSE amntcd
			    END    AS debit_credit,
			    crcycd AS trxn_ccy,
			    acctbr AS acct_branch,
			    dtitcd AS accounting_alias,
			    atowtp AS accounting_subject,
			    bltype AS bal_attributes,
			    hashvl AS hash_value
			FROM
			    kns_acsq
			WHERE
			    trandt =#trandt# and acctbr=#brchno#
			AND FILEID <> 'loanjx'
			UNION
			SELECT
			    transq AS trxn_seq,
			    sortno AS data_sort,
			    cuacno AS acctno,
			    acseno AS sub_acct_seq,
			    trandt AS trxn_date,
			    CASE
			        WHEN amntcd = 'C'
			        THEN -tranam
			        ELSE tranam
			    END AS trxn_amt,
			    CASE
			        WHEN amntcd = 'C'
			        THEN 'D'
			        ELSE amntcd
			    END    AS debit_credit,
			    crcycd AS trxn_ccy,
			    acctbr AS acct_branch,
			    dtitcd AS accounting_alias,
			    atowtp AS accounting_subject,
			    bltype AS bal_attributes,
			    hashvl AS hash_value
			FROM
			    kns_acsq
			WHERE
			    trandt =#trandt# and acctbr=#brchno#
			AND FILEID = 'loanjx'
       ]]></sql>
        <sql type="mysql"><![CDATA[
			SELECT
			    transq AS trxn_seq,
			    sortno AS data_sort,
			    cuacno AS acctno,
			    acseno AS sub_acct_seq,
			    trandt AS trxn_date,
			    tranam AS trxn_amt,
			    CASE
			        WHEN amntcd = 'R'
			        THEN 'D'
			        WHEN amntcd = 'P'
			        THEN 'C'
			        ELSE amntcd
			    END    AS debit_credit,
			    crcycd AS trxn_ccy,
			    acctbr AS acct_branch,
			    dtitcd AS accounting_alias,
			    atowtp AS accounting_subject,
			    bltype AS bal_attributes,
			    hashvl AS hash_value
			FROM
			    kns_acsq
			WHERE
			    trandt =#trandt# and acctbr=#brchno#
			AND FILEID <> 'loanjx'
			UNION
			SELECT
			    transq AS trxn_seq,
			    sortno AS data_sort,
			    cuacno AS acctno,
			    acseno AS sub_acct_seq,
			    trandt AS trxn_date,
			    CASE
			        WHEN amntcd = 'C'
			        THEN -tranam
			        ELSE tranam
			    END AS trxn_amt,
			    CASE
			        WHEN amntcd = 'C'
			        THEN 'D'
			        ELSE amntcd
			    END    AS debit_credit,
			    crcycd AS trxn_ccy,
			    acctbr AS acct_branch,
			    dtitcd AS accounting_alias,
			    atowtp AS accounting_subject,
			    bltype AS bal_attributes,
			    hashvl AS hash_value
			FROM
			    kns_acsq
			WHERE
			    trandt =#trandt# and acctbr=#brchno#
			AND FILEID = 'loanjx'
       ]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="trandt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="交易日期" parameterType="condition"/>
            <parameter property="brchno" jdbcType="VARCHAR" javaType="BaseType.U_BRCHNO" mode="in" longname="机构号" parameterType="condition"/>
        </parameterMap>
        <resultMap class="InDayEndTypes.GlKnsqData"/>
    </select>
    <select cache="none" method="selectOne" type="sql" id="selKnsAcsqListCount" longname="查询会计流水信息条数">
        <sql type="mysql"><![CDATA[
		select count(*)
		from kns_acsq where trandt =#trandt# and acctbr=#brchno#
        ]]></sql>
        <sql type="oracle"><![CDATA[
		select count(*)
		from kns_acsq where trandt =#trandt# and acctbr=#brchno#
        ]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="trandt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="交易日期" parameterType="condition"/>
            <parameter property="brchno" jdbcType="VARCHAR" javaType="BaseType.U_BRCHNO" mode="in" longname="机构号" parameterType="condition"/>
        </parameterMap>
        <resultMap class="int"/>
    </select>
    <select cache="none" method="selectOne" type="sql" id="selKnsAcsqListTranam" longname="查询会计流水表汇总金额">
        <sql type="mysql"><![CDATA[SELECT
				    SUM(tranam)
				FROM
				    (
				        SELECT
				            SUM(tranam) AS tranam
				        FROM
				            (
				                SELECT
				                    CASE
				                        WHEN AMNTCD = 'C'
				                        THEN -tranam
				                        ELSE tranam
				                    END tranam
				                FROM
				                    kns_acsq
				                WHERE
				                    trandt=#trandt#
				                AND acctbr=#brchno#
				                AND FILEID = 'loanjx' )
				        UNION ALL
				            (
				                SELECT
				                    SUM(tranam) AS tranam
				                FROM
				                    kns_acsq
				                WHERE
				                    trandt=#trandt#
				                AND acctbr=#brchno#
				                AND FILEID <> 'loanjx'))]]></sql>
        <sql type="oracle"><![CDATA[
        	SELECT
				    SUM(tranam)
				FROM
				    (
				        SELECT
				            SUM(tranam) AS tranam
				        FROM
				            (
				                SELECT
				                    CASE
				                        WHEN AMNTCD = 'C'
				                        THEN -tranam
				                        ELSE tranam
				                    END tranam
				                FROM
				                    kns_acsq
				                WHERE
				                    trandt=#trandt#
				                AND acctbr=#brchno#
				                AND FILEID = 'loanjx' )
				        UNION ALL
				            (
				                SELECT
				                    SUM(tranam) AS tranam
				                FROM
				                    kns_acsq
				                WHERE
				                    trandt=#trandt#
				                AND acctbr=#brchno#
				                AND FILEID <> 'loanjx'))
                ]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="trandt" jdbcType="VARCHAR" javaType="BaseType.U_CHAR08" mode="in" longname="交易日期" parameterType="condition"/>
            <parameter property="brchno" jdbcType="VARCHAR" javaType="BaseType.U_BRCHNO" mode="in" longname="交易机构" parameterType="condition"/>
        </parameterMap>
        <resultMap class="decimal"/>
    </select>
    <select cache="none" method="selectAll" type="sql" id="selLoanAccrueList" longname="查询贷款计提信息">
        <sql type="mysql"><![CDATA[
		select  cabrdt as trxn_date, brchno as acct_branch,
				acctcd as accounting_alias, crcycd as ccy_code,
				cabrin as budget_inst_amt,
                bltype as bal_attributes,
                wdtype as accrue_type
		 from lnb_cbtl where cabrdt =#cabrdt# and corpno=#corpno#
       ]]></sql>
        <sql type="oracle"><![CDATA[
		select  cabrdt as trxn_date, brchno as acct_branch,
				acctcd as accounting_alias, crcycd as ccy_code,
				cabrin as budget_inst_amt,
                bltype as bal_attributes,
                wdtype as accrue_type
		 from lnb_cbtl where cabrdt =#cabrdt# and corpno=#corpno#
       ]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="cabrdt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="计提日期" parameterType="condition"/>
            <parameter property="corpno" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
        </parameterMap>
        <resultMap class="InDayEndTypes.GlAccrueData"/>
    </select>
    <select cache="none" method="selectAll" type="sql" id="selDepositAccrueList" longname="查询存款计提信息">
        <sql type="mysql"><![CDATA[
		select  cabrdt as trxn_date, brchno as acct_branch,
				acctcd as accounting_alias, crcycd as ccy_code,
				cabrin as budget_inst_amt
		 from knb_cbtl where cabrdt =#cabrdt# and corpno=#corpno#
       ]]></sql>
        <sql type="oracle"><![CDATA[
		select  cabrdt as trxn_date, brchno as acct_branch,
				acctcd as accounting_alias, crcycd as ccy_code,
				cabrin as budget_inst_amt
		 from knb_cbtl where cabrdt =#cabrdt# and corpno=#corpno#
       ]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="cabrdt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="计提日期" parameterType="condition"/>
            <parameter property="corpno" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
        </parameterMap>
        <resultMap class="InDayEndTypes.GlAccrueData"/>
    </select>
    <select cache="none" method="selectAll" type="sql" id="selLoanQuaClaList" longname="查询贷款损失计提信息">
        <sql type="mysql"><![CDATA[
        select  cabrdt as trxn_date, brchno as acct_branch,
                acctcd as accounting_alias, crcycd as ccy_code,
                cabrin as budget_inst_amt
         from lnb_qctl where cabrdt =#cabrdt# and corpno=#corpno#
       ]]></sql>
        <sql type="oracle"><![CDATA[
        select  cabrdt as trxn_date, brchno as acct_branch,
                acctcd as accounting_alias, crcycd as ccy_code,
                cabrin as budget_inst_amt
         from lnb_qctl where cabrdt =#cabrdt# and corpno=#corpno#
       ]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="cabrdt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="计提日期" parameterType="condition"/>
            <parameter property="corpno" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
        </parameterMap>
        <resultMap class="InDayEndTypes.GlAccrueData"/>
    </select>
    <select cache="none" method="selectOne" type="sql" id="selDepositAccrueListCount" longname="查询存款计提信息条数">
        <sql type="mysql"><![CDATA[
		 select count(*) from knb_cbtl where cabrdt =#cabrdt# and corpno=#corpno#
        ]]></sql>
        <sql type="oracle"><![CDATA[
		 select count(*) from knb_cbtl where cabrdt =#cabrdt# and corpno=#corpno#
        ]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="cabrdt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="交易日期" parameterType="condition"/>
            <parameter property="corpno" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
        </parameterMap>
        <resultMap class="int"/>
    </select>
    <select cache="none" method="selectOne" type="sql" id="selLoanQuaClaListCount" longname="查询贷款损失计提信息条数">
        <sql type="mysql"><![CDATA[
         select count(*) from lnb_qctl where cabrdt =#cabrdt# and corpno=#corpno#
        ]]></sql>
        <sql type="oracle"><![CDATA[
         select count(*) from lnb_qctl where cabrdt =#cabrdt# and corpno=#corpno#
        ]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="cabrdt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="交易日期" parameterType="condition"/>
            <parameter property="corpno" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
        </parameterMap>
        <resultMap class="int"/>
    </select>
    <select cache="none" method="selectOne" type="sql" id="selDepositAccrueListTranam" longname="查询存款计提信息汇总金额">
        <sql type="mysql"><![CDATA[
        select sum(cabrin) from knb_cbtl where cabrdt =#cabrdt# and corpno=#corpno#
        ]]></sql>
        <sql type="oracle"><![CDATA[
        select sum(cabrin) from knb_cbtl where cabrdt =#cabrdt# and corpno=#corpno#
        ]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="cabrdt" jdbcType="VARCHAR" javaType="BaseType.U_CHAR08" mode="in" longname="交易日期" parameterType="condition"/>
            <parameter property="corpno" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
        </parameterMap>
        <resultMap class="decimal"/>
    </select>
    <select cache="none" method="selectOne" type="sql" id="selLoanQuaClaListTranam" longname="查询贷款损失计提信息汇总金额">
        <sql type="mysql"><![CDATA[
        select sum(cabrin) from lnb_qctl where cabrdt =#cabrdt# and corpno=#corpno#
        ]]></sql>
        <sql type="oracle"><![CDATA[
        select sum(cabrin) from lnb_qctl where cabrdt =#cabrdt# and corpno=#corpno#
        ]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="cabrdt" jdbcType="VARCHAR" javaType="BaseType.U_CHAR08" mode="in" longname="交易日期" parameterType="condition"/>
            <parameter property="corpno" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
        </parameterMap>
        <resultMap class="decimal"/>
    </select>
    <select cache="none" method="selectOne" type="sql" id="selLoanAccrueListCount" longname="查询贷款计提信息条数">
        <sql type="mysql"><![CDATA[
		select count(*) from lnb_cbtl where cabrdt =#cabrdt# and corpno=#corpno#
        ]]></sql>
        <sql type="oracle"><![CDATA[
		select count(*) from lnb_cbtl where cabrdt =#cabrdt# and corpno=#corpno#
        ]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="cabrdt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="交易日期" parameterType="condition"/>
            <parameter property="corpno" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
        </parameterMap>
        <resultMap class="int"/>
    </select>
    <select cache="none" method="selectOne" type="sql" id="selLoanAccrueListTranam" longname="查询贷款计提信息汇总金额">
        <sql type="mysql"><![CDATA[
        select sum(cabrin) from lnb_cbtl where cabrdt =#cabrdt# and corpno=#corpno#
        ]]></sql>
        <sql type="oracle"><![CDATA[
        select sum(cabrin) from lnb_cbtl where cabrdt =#cabrdt# and corpno=#corpno#
        ]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="cabrdt" jdbcType="VARCHAR" javaType="BaseType.U_CHAR08" mode="in" longname="交易日期" parameterType="condition"/>
            <parameter property="corpno" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
        </parameterMap>
        <resultMap class="decimal"/>
    </select>
    <delete method="delete" id="delGlLedgerByDay" longname="删除总分核对供数明细">
        <sql type="mysql"><![CDATA[delete from gl_ledger_sum where trxn_date = #trandt# and corpno=#corpno#]]></sql>
        <sql type="oracle"><![CDATA[delete from gl_ledger_sum where trxn_date = #trandt# and corpno=#corpno#]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="trandt" jdbcType="VARCHAR" javaType="string" mode="in" longname="汇总日期" parameterType="condition"/>
            <parameter property="corpno" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
        </parameterMap>
    </delete>
    <select cache="none" method="selectAll" type="sql" id="selLedgerBalList" longname="查询分户余额信息">
        <sql type="mysql"><![CDATA[
		select * from gl_ledger_sum where trxn_date = #acctdt# and corpno=#corpno#
        ]]></sql>
        <sql type="oracle"><![CDATA[
		select * from gl_ledger_sum where trxn_date = #acctdt# and corpno=#corpno#
        ]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="acctdt" jdbcType="VARCHAR" javaType="string" mode="in" longname="账务日期" parameterType="condition"/>
            <parameter property="corpno" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
        </parameterMap>
        <resultMap class="In.GlLedgerSum"/>
    </select>
    <select cache="none" method="selectOne" type="sql" id="selLedgerBalCount" longname="查询分户余额信息条数">
        <sql type="mysql"><![CDATA[
		select count(*) from gl_ledger_sum where trxn_date = #acctdt# and corpno=#corpno#
        ]]></sql>
        <sql type="oracle"><![CDATA[
		select count(*) from gl_ledger_sum where trxn_date = #acctdt# and corpno=#corpno#
        ]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="acctdt" jdbcType="VARCHAR" javaType="string" mode="in" longname="账务日期" parameterType="condition"/>
            <parameter property="corpno" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
        </parameterMap>
        <resultMap class="int"/>
    </select>
    <select cache="none" method="selectOne" type="sql" id="selLedgerBalTranam" longname="查询分户余额信息汇总金额">
        <sql type="mysql"><![CDATA[
		   select sum(acct_bal) from gl_ledger_sum where trxn_date = #acctdt# and corpno=#corpno#
        ]]></sql>
        <sql type="oracle"><![CDATA[
		   select sum(acct_bal) from gl_ledger_sum where trxn_date = #acctdt# and corpno=#corpno#
        ]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="acctdt" jdbcType="VARCHAR" javaType="string" mode="in" longname="账务日期" parameterType="condition"/>
            <parameter property="corpno" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
        </parameterMap>
        <resultMap class="decimal"/>
    </select>
    <select cache="none" method="selectAll" type="sql" id="selGlAcsqSum" longname="分类查询会计流水汇总信息">
        <sql type="mysql"><![CDATA[
			SELECT
			    #trandt# AS trxn_date,
			    'C'        AS file_type,
			    accounting_subject,
			    COUNT(*)       record_number,
			    SUM(total_amt) total_amt,
			    corpno,
			    brchno
			FROM
			    (
			    (
			        SELECT
			            a.trandt AS trxn_date,
			            'C'      AS file_type,
			            a.atowtp AS accounting_subject,
			            a.tranam AS total_amt,
			            a.corpno,
			            b.brchno
			        FROM
			            kns_acsq a
			        LEFT JOIN
			            kub_brch b
			        ON
			            a.acctbr = b.brchno
			        WHERE
			            b.corpno=#corpno#
			        AND b.brchtp<>'4'
			        AND a.trandt =#trandt#
			        AND a.FILEID <> 'loanjx')
			UNION ALL
			    (
			        SELECT
			            a.trandt AS trxn_date,
			            'C'      AS file_type,
			            a.atowtp AS accounting_subject,
			            CASE
			                WHEN a.AMNTCD = 'C'
			                THEN -tranam
			                ELSE tranam
			            END total_amt,
			            a.corpno,
			            b.brchno
			        FROM
			            kns_acsq a
			        LEFT JOIN
			            kub_brch b
			        ON
			            a.acctbr = b.brchno
			        WHERE
			            b.corpno=#corpno#
			        AND b.brchtp<>'4'
			        AND a.trandt =#trandt#
			        AND a.FILEID = 'loanjx') )
			GROUP BY
			    brchno,
			    corpno,
			    accounting_subject
       ]]></sql>
        <sql type="oracle"><![CDATA[
			SELECT
			    #trandt# AS trxn_date,
			    'C'        AS file_type,
			    accounting_subject,
			    COUNT(*)       record_number,
			    SUM(total_amt) total_amt,
			    corpno,
			    brchno
			FROM
			    (
			    (
			        SELECT
			            a.trandt AS trxn_date,
			            'C'      AS file_type,
			            a.atowtp AS accounting_subject,
			            a.tranam AS total_amt,
			            a.corpno,
			            b.brchno
			        FROM
			            kns_acsq a
			        LEFT JOIN
			            kub_brch b
			        ON
			            a.acctbr = b.brchno
			        WHERE
			            b.corpno=#corpno#
			        AND b.brchtp<>'4'
			        AND a.trandt =#trandt#
			        AND a.FILEID <> 'loanjx')
			UNION ALL
			    (
			        SELECT
			            a.trandt AS trxn_date,
			            'C'      AS file_type,
			            a.atowtp AS accounting_subject,
			            CASE
			                WHEN a.AMNTCD = 'C'
			                THEN -tranam
			                ELSE tranam
			            END total_amt,
			            a.corpno,
			            b.brchno
			        FROM
			            kns_acsq a
			        LEFT JOIN
			            kub_brch b
			        ON
			            a.acctbr = b.brchno
			        WHERE
			            b.corpno=#corpno#
			        AND b.brchtp<>'4'
			        AND a.trandt =#trandt#
			        AND a.FILEID = 'loanjx') )
			GROUP BY
			    brchno,
			    corpno,
			    accounting_subject
       ]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="trandt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="日期" parameterType="condition"/>
            <parameter property="corpno" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
        </parameterMap>
        <resultMap class="In.GlCheckRecord"/>
    </select>
    <select cache="none" method="selectAll" type="sql" id="selGlCheckRecordList" longname="查询总账核对信息">
        <sql type="mysql"><![CDATA[
		select * from gl_check_record where trxn_date=#trandt# and corpno=#corpno#
        ]]></sql>
        <sql type="oracle"><![CDATA[
		select * from gl_check_record where trxn_date=#trandt# and corpno=#corpno#
        ]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="trandt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="日期" parameterType="condition"/>
            <parameter property="corpno" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
        </parameterMap>
        <resultMap class="In.GlCheckRecord"/>
    </select>
    <insert id="Ins_Acct_Lsbl" longname="登记负债账号活期余额">
        <sql type="oracle"><![CDATA[Insert Into h_kna_acct(acctdt,acctno,acctna,custac,crcycd,csextg,brchno,onlnbl,upbldt,lastbl,acctst,acctcd,corpno)
			Select #acctdt#,acctno,acctna,custac,crcycd,csextg,brchno,onlnbl,upbldt,lastbl,acctst,acctcd,corpno
			From kna_acct where corpno = #corpno#]]></sql>
        <sql type="mysql"><![CDATA[Insert Into h_kna_acct(acctdt,acctno,acctna,custac,crcycd,csextg,brchno,onlnbl,upbldt,lastbl,acctst,acctcd,corpno)
			Select #acctdt#,acctno,acctna,custac,crcycd,csextg,brchno,onlnbl,upbldt,lastbl,acctst,acctcd,corpno
			From kna_acct where corpno = #corpno#]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="acctdt" jdbcType="VARCHAR" javaType="string" mode="in" longname="账务日期" parameterType="condition"/>
            <parameter property="corpno" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
        </parameterMap>
    </insert>
    <insert id="Ins_Fxac_Lsbl" longname="登记负债账号定期余额">
        <sql type="oracle"><![CDATA[Insert Into h_kna_fxac(acctdt,acctno,acctna,custac,crcycd,csextg,brchno,onlnbl,upbldt,lastbl,acctst,acctcd,corpno)
			Select #acctdt#,acctno,acctna,custac,crcycd,csextg,brchno,onlnbl,upbldt,lastbl,acctst,acctcd,corpno
			From kna_fxac where corpno = #corpno#]]></sql>
        <sql type="mysql"><![CDATA[Insert Into h_kna_fxac(acctdt,acctno,acctna,custac,crcycd,csextg,brchno,onlnbl,upbldt,lastbl,acctst,acctcd,corpno)
			Select #acctdt#,acctno,acctna,custac,crcycd,csextg,brchno,onlnbl,upbldt,lastbl,acctst,acctcd,corpno
			From kna_fxac where corpno = #corpno#]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="acctdt" jdbcType="VARCHAR" javaType="string" mode="in" longname="账务日期" parameterType="condition"/>
            <parameter property="corpno" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
        </parameterMap>
    </insert>
    <select cache="none" method="selectFirst" type="sql" id="Sel_H_Acct" longname="查询活期历史表是否存在记录">
        <sql type="oracle"><![CDATA[select acctno from h_kna_acct where acctdt=#acctdt#]]></sql>
        <sql type="mysql"><![CDATA[select acctno from h_kna_acct where acctdt=#acctdt#]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="acctdt" jdbcType="VARCHAR" javaType="string" mode="in" longname="账务日期" parameterType="condition"/>
        </parameterMap>
        <resultMap class="java.lang.String">
            <result property="acctno" javaType="BaseType.U_ACCTNO" jdbcType="VARCHAR" column="acctno" longname="账号"/>
        </resultMap>
    </select>
    <select cache="none" method="selectFirst" type="sql" id="Sel_H_Fxac" longname="查询定期历史表是否存在记录">
        <sql type="oracle"><![CDATA[select acctno from h_kna_fxac where acctdt=#acctdt#]]></sql>
        <sql type="mysql"><![CDATA[select acctno from h_kna_fxac where acctdt=#acctdt#]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="acctdt" jdbcType="VARCHAR" javaType="string" mode="in" longname="账务日期" parameterType="condition"/>
        </parameterMap>
        <resultMap class="java.lang.String">
            <result property="acctno" javaType="BaseType.U_ACCTNO" jdbcType="VARCHAR" column="acctno" longname="账号"/>
        </resultMap>
    </select>
    <select cache="none" method="selectAll" type="sql" id="selLnaAcctHistByAcctdt" longname="根据日期查询贷款账户历史表是否存在数据">
        <sql type="oracle"><![CDATA[select acctno from lna_acct_hist where corpno=#corpno# and acctdt=#acctdt#]]></sql>
        <sql type="mysql"><![CDATA[select acctno from lna_acct_hist where corpno=#corpno# and acctdt=#acctdt#]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="acctdt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="账务日期" parameterType="condition"/>
            <parameter property="corpno" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
        </parameterMap>
        <resultMap class="java.lang.String">
            <result property="acctno" javaType="BaseType.U_ACCTNO" jdbcType="VARCHAR" column="acctno" longname="贷款账号"/>
        </resultMap>
    </select>
    <insert id="insLnaAcctHistByAcctdt" longname="登记贷款账户主表历史信息(账务日期为日切前)">
        <sql type="oracle"><![CDATA[
		insert into lna_acct_hist(corpno,acctdt,acctno,lncfno,cntrno,custac,custno,acctna,busibr,brchno,prodcd,prodna,initdt,instdt,matudt,
		termfm,clssst,prlntg,acctst,mlbksq,crcycd,cntram,lncfam,lendam,frozam,lendbl,lnnpbl,lnopbl,lndpbl,lnbpbl,
		fundam,ysyjni,csyjni,ysxxoi,csxxoi,ysyjpi,csyjpi,ysxxpi,csxxpi,yjxxci,cixxxx,yjxxti,ysxxti,txxxin,hxxxpr,
		hxxxin,srxxin,ysxxfe,srxxfe,ysxxpe,srxxpe,resvam,lastdt,remark,sortno,openbr,openus,closus,closdt,tmstmp)
		
		select 
		a.corpno, #acctdt#,a.acctno,a.lncfno,a.cntrno,a.custac,a.custno,a.acctna,a.busibr,a.brchno,a.prodcd,a.prodna,a.initdt,a.instdt,a.matudt,
		a.termfm,a.clssst,a.prlntg,a.acctst,a.mlbksq,a.crcycd,a.cntram,a.lncfam,a.lendam,a.frozam,a.lendbl,a.lnnpbl,a.lnopbl,a.lndpbl,a.lnbpbl,
		a.fundam,a.ysyjni,a.csyjni,a.ysxxoi,a.csxxoi,a.ysyjpi,a.csyjpi,a.ysxxpi,a.csxxpi,a.yjxxci,a.cixxxx,a.yjxxti,a.ysxxti,a.txxxin,a.hxxxpr,
		a.hxxxin,a.srxxin,a.ysxxfe,a.srxxfe,a.ysxxpe,a.srxxpe,a.resvam,a.lastdt,a.remark,a.sortno,a.openbr,a.openus,a.closus,a.closdt ,#tmstmp#
		from lna_acct a 
		where a.corpno=#corpno# and a.lastdt <= #acctdt#
		union all
		
		select 
		a.corpno,#acctdt#,a.acctno,a.lncfno,a.cntrno,a.custac,a.custno,a.acctna,a.busibr,a.brchno,a.prodcd,a.prodna,a.initdt,a.instdt,a.matudt,
		a.termfm,a.clssst,a.prlntg,a.acctst,a.mlbksq,a.crcycd,a.cntram,a.lncfam,a.lendam,a.frozam,a.lendbl,a.lnnpbl,a.lnopbl,a.lndpbl,a.lnbpbl,
		a.fundam,a.ysyjni,a.csyjni,a.ysxxoi,a.csxxoi,a.ysyjpi,a.csyjpi,a.ysxxpi,a.csxxpi,a.yjxxci,a.cixxxx,a.yjxxti,a.ysxxti,a.txxxin,a.hxxxpr,
		a.hxxxin,a.srxxin,a.ysxxfe,a.srxxfe,a.ysxxpe,a.srxxpe,a.resvam,a.lastdt,a.remark,a.sortno,a.openbr,a.openus,a.closus,a.closdt,#tmstmp#
		from lna_acct_last a,lna_acct b
		where a.acctno=b.acctno and b.corpno=#corpno#
		and b.lastdt>#acctdt#]]></sql>
        <sql type="mysql"><![CDATA[
		insert into lna_acct_hist(corpno,acctdt,acctno,lncfno,cntrno,custac,custno,acctna,busibr,brchno,prodcd,prodna,initdt,instdt,matudt,
		termfm,clssst,prlntg,acctst,mlbksq,crcycd,cntram,lncfam,lendam,frozam,lendbl,lnnpbl,lnopbl,lndpbl,lnbpbl,
		fundam,ysyjni,csyjni,ysxxoi,csxxoi,ysyjpi,csyjpi,ysxxpi,csxxpi,yjxxci,cixxxx,yjxxti,ysxxti,txxxin,hxxxpr,
		hxxxin,srxxin,ysxxfe,srxxfe,ysxxpe,srxxpe,resvam,lastdt,remark,sortno,openbr,openus,closus,closdt,tmstmp)
		
		select 
		a.corpno, #acctdt#,a.acctno,a.lncfno,a.cntrno,a.custac,a.custno,a.acctna,a.busibr,a.brchno,a.prodcd,a.prodna,a.initdt,a.instdt,a.matudt,
		a.termfm,a.clssst,a.prlntg,a.acctst,a.mlbksq,a.crcycd,a.cntram,a.lncfam,a.lendam,a.frozam,a.lendbl,a.lnnpbl,a.lnopbl,a.lndpbl,a.lnbpbl,
		a.fundam,a.ysyjni,a.csyjni,a.ysxxoi,a.csxxoi,a.ysyjpi,a.csyjpi,a.ysxxpi,a.csxxpi,a.yjxxci,a.cixxxx,a.yjxxti,a.ysxxti,a.txxxin,a.hxxxpr,
		a.hxxxin,a.srxxin,a.ysxxfe,a.srxxfe,a.ysxxpe,a.srxxpe,a.resvam,a.lastdt,a.remark,a.sortno,a.openbr,a.openus,a.closus,a.closdt ,#tmstmp#
		from lna_acct a 
		where a.corpno=#corpno# and a.lastdt <= #acctdt#
		union all
		
		select 
		a.corpno,#acctdt#,a.acctno,a.lncfno,a.cntrno,a.custac,a.custno,a.acctna,a.busibr,a.brchno,a.prodcd,a.prodna,a.initdt,a.instdt,a.matudt,
		a.termfm,a.clssst,a.prlntg,a.acctst,a.mlbksq,a.crcycd,a.cntram,a.lncfam,a.lendam,a.frozam,a.lendbl,a.lnnpbl,a.lnopbl,a.lndpbl,a.lnbpbl,
		a.fundam,a.ysyjni,a.csyjni,a.ysxxoi,a.csxxoi,a.ysyjpi,a.csyjpi,a.ysxxpi,a.csxxpi,a.yjxxci,a.cixxxx,a.yjxxti,a.ysxxti,a.txxxin,a.hxxxpr,
		a.hxxxin,a.srxxin,a.ysxxfe,a.srxxfe,a.ysxxpe,a.srxxpe,a.resvam,a.lastdt,a.remark,a.sortno,a.openbr,a.openus,a.closus,a.closdt,#tmstmp#
		from lna_acct_last a,lna_acct b
		where a.acctno=b.acctno and b.corpno=#corpno#
		and b.lastdt>#acctdt#]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="corpno" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
            <parameter property="acctdt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="账务日期" parameterType="condition"/>
            <parameter property="tmstmp" jdbcType="VARCHAR" javaType="BaseType.U_LONGIN" mode="in" longname="时间戳" parameterType="condition"/>
        </parameterMap>
    </insert>
    <insert id="insLnaAcctHistByLastdt" longname="登记贷款账户主表历史信息(账务日期为日切后)">
        <sql type="oracle"><![CDATA[
        insert into lna_acct_hist(corpno,acctdt,acctno,lncfno,cntrno,custac,custno,acctna,busibr,brchno,prodcd,prodna,initdt,instdt,matudt,
		termfm,clssst,prlntg,acctst,mlbksq,crcycd,cntram,lncfam,lendam,frozam,lendbl,lnnpbl,lnopbl,lndpbl,lnbpbl,
		fundam,ysyjni,csyjni,ysxxoi,csxxoi,ysyjpi,csyjpi,ysxxpi,csxxpi,yjxxci,cixxxx,yjxxti,ysxxti,txxxin,hxxxpr,
		hxxxin,srxxin,ysxxfe,srxxfe,ysxxpe,srxxpe,resvam,lastdt,remark,sortno,openbr,openus,closus,closdt,tmstmp)
		select a.corpno,#acctdt#,a.acctno,a.lncfno,a.cntrno,a.custac,a.custno,a.acctna,a.busibr,a.brchno,a.prodcd,a.prodna,a.initdt,a.instdt,a.matudt,
		a.termfm,a.clssst,a.prlntg,a.acctst,a.mlbksq,a.crcycd,a.cntram,a.lncfam,a.lendam,a.frozam,a.lendbl,a.lnnpbl,a.lnopbl,a.lndpbl,a.lnbpbl,
		a.fundam,a.ysyjni,a.csyjni,a.ysxxoi,a.csxxoi,a.ysyjpi,a.csyjpi,a.ysxxpi,a.csxxpi,a.yjxxci,a.cixxxx,a.yjxxti,a.ysxxti,a.txxxin,a.hxxxpr,
		a.hxxxin,a.srxxin,a.ysxxfe,a.srxxfe,a.ysxxpe,a.srxxpe,a.resvam,a.lastdt,a.remark,a.sortno,a.openbr,a.openus,a.closus,a.closdt,#tmstmp#
		from lna_acct_last a,lna_acct b
		where a.acctno = b.acctno and b.lastdt > #acctdt# ]]></sql>
        <sql type="mysql"><![CDATA[
        insert into lna_acct_hist(corpno,acctdt,acctno,lncfno,cntrno,custac,custno,acctna,busibr,brchno,prodcd,prodna,initdt,instdt,matudt,
		termfm,clssst,prlntg,acctst,mlbksq,crcycd,cntram,lncfam,lendam,frozam,lendbl,lnnpbl,lnopbl,lndpbl,lnbpbl,
		fundam,ysyjni,csyjni,ysxxoi,csxxoi,ysyjpi,csyjpi,ysxxpi,csxxpi,yjxxci,cixxxx,yjxxti,ysxxti,txxxin,hxxxpr,
		hxxxin,srxxin,ysxxfe,srxxfe,ysxxpe,srxxpe,resvam,lastdt,remark,sortno,openbr,openus,closus,closdt,tmstmp)
		select a.corpno,#acctdt#,a.acctno,a.lncfno,a.cntrno,a.custac,a.custno,a.acctna,a.busibr,a.brchno,a.prodcd,a.prodna,a.initdt,a.instdt,a.matudt,
		a.termfm,a.clssst,a.prlntg,a.acctst,a.mlbksq,a.crcycd,a.cntram,a.lncfam,a.lendam,a.frozam,a.lendbl,a.lnnpbl,a.lnopbl,a.lndpbl,a.lnbpbl,
		a.fundam,a.ysyjni,a.csyjni,a.ysxxoi,a.csxxoi,a.ysyjpi,a.csyjpi,a.ysxxpi,a.csxxpi,a.yjxxci,a.cixxxx,a.yjxxti,a.ysxxti,a.txxxin,a.hxxxpr,
		a.hxxxin,a.srxxin,a.ysxxfe,a.srxxfe,a.ysxxpe,a.srxxpe,a.resvam,a.lastdt,a.remark,a.sortno,a.openbr,a.openus,a.closus,a.closdt,#tmstmp#
		from lna_acct_last a,lna_acct b
		where a.acctno = b.acctno and b.lastdt > #acctdt# ]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="acctdt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="账务日期" parameterType="condition"/>
            <parameter property="tmstmp" jdbcType="VARCHAR" javaType="BaseType.U_LONGIN" mode="in" longname="时间戳" parameterType="condition"/>
        </parameterMap>
    </insert>
    <insert id="insHKnlBill" longname="账户余额发生明细数据转储">
        <sql type="oracle"><![CDATA[
        insert into h_knl_bill
        select * from knl_bill a where a.corpno=#corpno# and a.trandt = #trandt#]]></sql>
        <sql type="mysql"><![CDATA[
        insert into h_knl_bill
        select * from knl_bill a where a.corpno=#corpno# and a.trandt = #trandt#]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="trandt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="交易日期" parameterType="condition"/>
            <parameter property="corpno" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
        </parameterMap>
    </insert>
    <delete method="delete" id="delKnlBillByTrandt" longname="删除指定交易日期的账户余额发生明细数据">
        <sql type="oracle"><![CDATA[delete knl_bill a where a.corpno=#corpno# and a.trandt < #trandt#]]></sql>
        <sql type="mysql"><![CDATA[delete from knl_bill where corpno=#corpno# and trandt < #trandt#]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="trandt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="交易日期" parameterType="condition"/>
            <parameter property="corpno" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
        </parameterMap>
    </delete>
    <insert id="insglledgerByDepositAcct" longname="存款分户数据汇总">
        <sql type="mysql"><![CDATA[ 
        insert into gl_ledger_sum(trxn_date,acct_branch,ccy_code,accounting_subject,
        accounting_alias,bal_attributes,acct_bal,bal_type,corpno)
		select #lastdt# as trxn_date, brchno as acct_branch, crcycd as ccy_code,
		'0' as accounting_subject, acctcd as accounting_alias, '0' as  bal_attributes,
		sum(case when upbldt = #trandt# then lastbl else onlnbl end) as acct_bal,
		'C' as bal_type,corpno
		from kna_acct where corpno=#corpno# group by brchno,acctcd,crcycd 
		union all
		select #lastdt# as trxn_date, brchno as acct_branch, crcycd as ccy_code,
		'0' as accounting_subject, acctcd as accounting_alias, '0' as  bal_attributes,
		sum(case when upbldt = #trandt# then lastbl else onlnbl end) as acct_bal,
		'C' as bal_type,corpno
		from kna_fxac where corpno=#corpno# group by brchno,acctcd,crcycd
		]]></sql>
        <sql type="oracle"><![CDATA[ 
		insert into gl_ledger_sum(trxn_date,acct_branch,ccy_code,accounting_subject, accounting_alias,bal_attributes,acct_bal,bal_type,corpno)
		SELECT #lastdt#,acct_branch,ccy_code,'0',accounting_alias,'0',sum(acct_bal) acct_bal,'C',corpno 
		FROM (
		select #lastdt# as trxn_date, brchno as acct_branch, crcycd as ccy_code, '0' as accounting_subject,
		acctcd as accounting_alias, '0' as bal_attributes, (case when upbldt = #trandt# then lastbl
		else onlnbl end) as acct_bal, 'C' as bal_type,corpno 
		from kna_acct where corpno=#corpno#
		union all
		select #lastdt# as trxn_date, brchno as acct_branch, crcycd
		as ccy_code, '0' as accounting_subject, acctcd as accounting_alias, '0' as bal_attributes,
		(case when upbldt = #trandt# then lastbl else onlnbl end) as acct_bal, 'C' as bal_type,corpno
		from kna_fxac where corpno=#corpno#
		)
		group by acct_branch,ccy_code,accounting_alias,corpno
		]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="trandt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="账务日期" parameterType="condition"/>
            <parameter property="lastdt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="上一日期" parameterType="condition"/>
            <parameter property="corpno" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
        </parameterMap>
    </insert>
    <insert id="insglledgerByGlAcct" longname="内部户分户数据汇总">
        <sql type="mysql"><![CDATA[ 
		insert into gl_ledger_sum(trxn_date,acct_branch,ccy_code,accounting_subject,
        accounting_alias,bal_attributes,acct_bal,bal_type,corpno)
		select 
		#trandt# as trxn_date,
	    k.brchno as acct_branch,
	    k.crcycd as ccy_code,
		'1' as accounting_subject,
	    k.busino as accounting_alias,
	    '0' as bal_attributes,
	    sum(
	    (case
	    when (k.busidn = 'B' or k.busidn ='Z' or k.busidn ='R' ) then h.drltbl -h.crltbl 
	    when k.busidn ='D' then h.drltbl  else h.crltbl 
	    end)
	    ) as acct_bal,
	    case when k.busidn = 'Z' or k.busidn = 'R' or k.busidn = 'B' or k.busidn = 'D'  then 'D' else 'C' end as bal_type,
	    k.corpno
	    from gl_kna_lsbl h,gl_kna_acct k where h.acctno=k.acctno and k.corpno=#corpno# group by k.brchno,k.crcycd,k.busino,k.busidn,k.corpno
		]]></sql>
        <sql type="oracle"><![CDATA[ 
		insert into gl_ledger_sum(trxn_date,acct_branch,ccy_code,accounting_subject,
        accounting_alias,bal_attributes,acct_bal,bal_type,corpno)
		select 
		#trandt# as trxn_date,
	    k.brchno as acct_branch,
	    k.crcycd as ccy_code,
		'1' as accounting_subject,
	    k.busino as accounting_alias,
	    '0' as bal_attributes,
	    sum(
	    (case
	    when (k.busidn = 'B' or k.busidn ='Z' or k.busidn ='R' ) then h.drltbl -h.crltbl 
	    when k.busidn ='D' then h.drltbl  else h.crltbl 
	    end)
	    ) as acct_bal,
	    case when k.busidn = 'Z' or k.busidn = 'R' or k.busidn = 'B' or k.busidn = 'D'  then 'D' else 'C' end as bal_type,
	    k.corpno
	    from gl_kna_lsbl h,gl_kna_acct k where h.acctno=k.acctno and k.corpno=#corpno# group by k.brchno,k.crcycd,k.busino,k.busidn,k.corpno
		]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="trandt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="账务日期" parameterType="condition"/>
            <parameter property="corpno" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
        </parameterMap>
    </insert>
    <select cache="none" method="selectAll" type="sql" id="selLoanSum" longname="查询贷款汇总信息">
        <sql type="oracle"><![CDATA[
        select a.crcycd,
	   	b.dtitcd,
	   	a.brchno,
	   	sum(a.lnnpbl) as lnnpbl,
	   	sum(a.lnopbl) as lnopbl,
	   	sum(a.lndpbl) as lndpbl,
	   	sum(a.lnbpbl) as lnbpbl,
	   	sum(a.ysyjni) as ysyjni,
	   	sum(a.csyjni) as csyjni,
	   	sum(a.ysxxoi) as ysxxoi,
	   	sum(a.csxxoi) as csxxoi,
	   	sum(a.ysyjpi) as ysyjpi,
	   	sum(a.csyjpi) as csyjpi,
	   	sum(a.ysxxpi) as ysxxpi,
	   	sum(a.csxxpi) as csxxpi,
	   	sum(a.yjxxci) as yjxxci,
	   	sum(a.cixxxx) as cixxxx,
	   	sum(a.yjxxti) as yjxxti,
	   	sum(a.ysxxti) as ysxxti,
	   	sum(a.txxxin) as txxxin,
	   	sum(a.hxxxpr) as hxxxpr,
	   	sum(a.hxxxin) as hxxxin,
	   	sum(a.srxxin) as srxxin,
   		sum(a.resvam) as resvam
		from lna_acct_hist a, lnb_dtit b
		where a.lncfno = b.lncfno
		and a.corpno = b.corpno
		and a.acctdt = #acctdt#
		and a.corpno = #corpno#
		GROUP BY a.Crcycd, b.dtitcd, a.Brchno]]></sql>
        <sql type="mysql"><![CDATA[
        select a.crcycd,
	   	b.dtitcd,
	   	a.brchno,
	   	sum(a.lnnpbl) as lnnpbl,
	   	sum(a.lnopbl) as lnopbl,
	   	sum(a.lndpbl) as lndpbl,
	   	sum(a.lnbpbl) as lnbpbl,
	   	sum(a.ysyjni) as ysyjni,
	   	sum(a.csyjni) as csyjni,
	   	sum(a.ysxxoi) as ysxxoi,
	   	sum(a.csxxoi) as csxxoi,
	   	sum(a.ysyjpi) as ysyjpi,
	   	sum(a.csyjpi) as csyjpi,
	   	sum(a.ysxxpi) as ysxxpi,
	   	sum(a.csxxpi) as csxxpi,
	   	sum(a.yjxxci) as yjxxci,
	   	sum(a.cixxxx) as cixxxx,
	   	sum(a.yjxxti) as yjxxti,
	   	sum(a.ysxxti) as ysxxti,
	   	sum(a.txxxin) as txxxin,
	   	sum(a.hxxxpr) as hxxxpr,
	   	sum(a.hxxxin) as hxxxin,
	   	sum(a.srxxin) as srxxin,
   		sum(a.resvam) as resvam
		from lna_acct_hist a, lnb_dtit b
		where a.lncfno = b.lncfno
		and a.corpno = b.corpno
		and a.acctdt = #acctdt#
		and a.corpno = #corpno#
		GROUP BY a.Crcycd, b.dtitcd, a.Brchno]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="acctdt" jdbcType="VARCHAR" javaType="string" mode="in" longname="账务日期" parameterType="condition"/>
            <parameter property="corpno" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
        </parameterMap>
        <resultMap class="InDayEndTypes.CbglLoanTranData"/>
    </select>
    <insert id="insertGlCheckRecord" longname="插入分户账汇总数据到对账文件信息表">
        <sql type="mysql"><![CDATA[
		insert into gl_check_record(acct_branch,ccy_code,trxn_date,accounting_subject,record_number,total_amt,file_type,corpno)
		select a.acct_branch,a.ccy_code,a.trxn_date, a.accounting_subject,count(*) as record_number,sum(acct_bal) as total_amt,
		'G' as file_type,a.corpno
		from gl_ledger_sum a where a.trxn_date = #trandt# and a.corpno=#corpno# group by a.trxn_date,a.accounting_subject,a.ccy_code,a.acct_branch,a.corpno
       ]]></sql>
        <sql type="oracle"><![CDATA[
		insert into gl_check_record(acct_branch,ccy_code,trxn_date,accounting_subject,record_number,total_amt,file_type,corpno)
		select a.acct_branch,a.ccy_code,a.trxn_date, a.accounting_subject,count(*) as record_number,sum(acct_bal) as total_amt,
		'G' as file_type,a.corpno
		from gl_ledger_sum a where a.trxn_date = #trandt# and a.corpno=#corpno# group by a.trxn_date,a.accounting_subject,a.ccy_code,a.acct_branch,a.corpno
       ]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="trandt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="日期" parameterType="condition"/>
            <parameter property="corpno" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
        </parameterMap>
    </insert>
    <select cache="none" method="selectAll" type="sql" id="selTxBusiAddeList" longname="查询营改增登记信息">
        <sql type="mysql"><![CDATA[
        select finadt as trxn_date, brchno as acct_branch, 
		acctcd as accounting_alias, crcycd as ccy_code, ystxam as budget_inst_amt 
		from tx_busi_adde where finadt = #cabrdt# and corpno= #corpno#]]></sql>
        <sql type="oracle"><![CDATA[
        select finadt as trxn_date, brchno as acct_branch, 
		acctcd as accounting_alias, crcycd as ccy_code, ystxam as budget_inst_amt 
		from tx_busi_adde where finadt = #cabrdt# and corpno= #corpno#]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="cabrdt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="财务日期" parameterType="condition"/>
            <parameter property="corpno" ref="BaseDict.Comm.corpno" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
        </parameterMap>
        <resultMap class="InDayEndTypes.GlAccrueData"/>
    </select>
    <select cache="none" method="selectOne" type="sql" id="selTxBusiAddeListCount" longname="营改增登记表记录数">
        <sql type="mysql"><![CDATA[select count(*) from tx_busi_adde where finadt = #cabrdt# and corpno= #corpno#]]></sql>
        <sql type="oracle"><![CDATA[select count(*) from tx_busi_adde where finadt = #cabrdt# and corpno= #corpno#]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="cabrdt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="财务日期" parameterType="condition"/>
            <parameter property="corpno" ref="BaseDict.Comm.corpno" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
        </parameterMap>
        <resultMap class="int"/>
    </select>
    <select cache="none" method="selectOne" type="sql" id="selTxBusiAddeListTranam" longname="查询贷款计提信息汇总金额">
        <sql type="mysql"><![CDATA[
        select sum(ystxam) from tx_busi_adde where finadt =#cabrdt# and corpno=#corpno#
        ]]></sql>
        <sql type="oracle"><![CDATA[
        select sum(ystxam) from tx_busi_adde where finadt =#cabrdt# and corpno=#corpno#
        ]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="cabrdt" jdbcType="VARCHAR" javaType="BaseType.U_CHAR08" mode="in" longname="交易日期" parameterType="condition"/>
            <parameter property="corpno" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
        </parameterMap>
        <resultMap class="decimal"/>
    </select>
    <select cache="none" method="selectOne" type="sql" id="insBusinoToSecondCorpno" longname="复制内部户业务编码到二级法人">
        <sql type="mysql"><![CDATA[
		insert into gl_knp_busi select 
		#secorp#, busino, busina, busien, busitp, ioflag, blncdn, pmodtg, ispaya, rmsign, fnsign, 
		isbein, beintp, nobusi, ovbusi, isopen, provop, counop, offiop, credop, kpacfg, etactp, 
		rlbltg, cractp, itemcd, acbrlv, asgnbr, subsac, bgdate, eddate, busist, tyinno, tranus, tmstmp 
		from gl_knp_busi where corpno = #cecorp# and busino = #busino#
		]]></sql>
        <sql type="oracle"><![CDATA[
		insert into gl_knp_busi select 
		#secorp#, busino, busina, busien, busitp, ioflag, blncdn, pmodtg, ispaya, rmsign, fnsign, 
		isbein, beintp, nobusi, ovbusi, isopen, provop, counop, offiop, credop, kpacfg, etactp, 
		rlbltg, cractp, itemcd, acbrlv, asgnbr, subsac, bgdate, eddate, busist, tyinno, tranus, tmstmp 
		from gl_knp_busi where corpno = #cecorp# and busino = #busino#
		]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="secorp" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="二级法人代码" parameterType="condition"/>
            <parameter property="cecorp" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="中心法人代码" parameterType="condition"/>
            <parameter property="busino" ref="InDict.inac.busino" jdbcType="VARCHAR" javaType="BaseType.U_BUSINO" mode="in" longname="业务代码" parameterType="condition"/>
        </parameterMap>
        <resultMap class="java.util.Map"/>
    </select>
    <select cache="none" method="selectAll" type="sql" id="selDcnClearData" longname="获取跨DCN清算数据">
        <sql type="mysql"><![CDATA[
			SELECT acctbr,trandt,crcycd, busino ,acctno,amntcd, sum(tranam) as tranam,subsac FROM(
			select c.acctbr,c.trandt,c.crcycd, a.busino ,b.acctno,c.amntcd, c.tranam,b.subsac
			from gl_knp_busi a 
			left join gl_kna_acct b on a.busino = b.busino 
			left join kns_acsq c on a.busino = c.dtitcd
			where a.corpno = #corpno# 
			and a.pmodtg = 0 
			and a.rlbltg = 2 
			and c.trandt = #trandt# )
			group by acctbr,trandt,crcycd, busino ,acctno,amntcd,subsac
		]]></sql>
        <sql type="oracle"><![CDATA[
			SELECT acctbr,trandt,crcycd, busino ,acctno,amntcd, sum(tranam) as tranam,subsac FROM(
			select c.acctbr,c.trandt,c.crcycd, a.busino ,b.acctno,c.amntcd, c.tranam,b.subsac
			from gl_knp_busi a 
			left join gl_kna_acct b on a.busino = b.busino 
			left join kns_acsq c on a.busino = c.dtitcd
			where a.corpno = #corpno# 
			and a.pmodtg = 0 
			and a.rlbltg = 2 
			and c.trandt = #trandt# )
			group by acctbr,trandt,crcycd, busino ,acctno,amntcd,subsac
		]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="trandt" ref="InDict.inac.trandt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="交易日期" parameterType="condition"/>
            <parameter property="corpno" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" parameterType="condition"/>
        </parameterMap>
        <resultMap class="InDayEndTypes.DcnClearData"/>
    </select>
</sqls>
