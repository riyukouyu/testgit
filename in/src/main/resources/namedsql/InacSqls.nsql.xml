<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<sqls xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" id="InacSqls" longname="内部户查询其他模块SQL语句" package="cn.sunline.ltts.busi.in.namedsql" xsi:noNamespaceSchemaLocation="ltts-model.xsd">
    <select cache="none" method="selectOne" type="sql" id="queryInAcctSubsacByItemcd" longname="根据科目币种部门查找最大子户号">
        <sql type="mysql"><![CDATA[ 
			Select  /*+ Index(a idx_gl_kna_acct_itemcd )*/
			Max(subsac) As subsac2
			From gl_kna_acct a
 			Where itemcd = #itemcd# 
 			And crcycd = #crcycd# 
 			And brchno = #brchno# 
 			And subsac >= '000000' 
 			And subsac <= '900000' 
 		]]></sql>
        <sql type="oracle"><![CDATA[ 
			Select  /*+ Index(a idx_gl_kna_acct_itemcd )*/
			Max(subsac) As subsac2
			From gl_kna_acct a
 			Where itemcd = #itemcd# 
 			And crcycd = #crcycd# 
 			And brchno = #brchno# 
 			And subsac >= '000000' 
 			And subsac <= '900000' 
 		]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="itemcd" jdbcType="VARCHAR" javaType="BaseType.U_ITEMCD" mode="in" parameterType="condition"/>
            <parameter property="crcycd" jdbcType="VARCHAR" javaType="BaseType.U_CRCYCD" mode="in" parameterType="condition"/>
            <parameter property="brchno" jdbcType="VARCHAR" javaType="BaseType.U_BRCHNO" mode="in" parameterType="condition"/>
        </parameterMap>
        <resultMap class="java.util.Map">
            <result property="subsac" javaType="BaseType.U_CUACNO" jdbcType="VARCHAR" column="subsac2"/>
        </resultMap>
    </select>
    <select cache="none" method="selectOne" type="sql" id="queryGlAcctSubsacByItemcd" longname="根据科目币种部门查找最大子户号">
        <sql type="mysql"><![CDATA[ 
			Select  /*+ Index(a idx_gl_kna_acct_itemcd )*/
			Max(subsac) As subsac2
			From gl_kna_acct a
 			Where itemcd = #itemcd# 
 			And crcycd = #crcycd# 
 			And brchno = #brchno# 
 			And subsac like #subsac#
 		]]></sql>
        <sql type="oracle"><![CDATA[ 
			Select  /*+ Index(a idx_gl_kna_acct_itemcd )*/
			Max(subsac) As subsac2
			From gl_kna_acct a
 			Where itemcd = #itemcd# 
 			And crcycd = #crcycd# 
 			And brchno = #brchno# 
 			And subsac like #subsac#
 		]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="itemcd" jdbcType="VARCHAR" javaType="BaseType.U_ITEMCD" mode="in" parameterType="condition"/>
            <parameter property="crcycd" jdbcType="VARCHAR" javaType="BaseType.U_CRCYCD" mode="in" parameterType="condition"/>
            <parameter property="brchno" jdbcType="VARCHAR" javaType="BaseType.U_BRCHNO" mode="in" parameterType="condition"/>
            <parameter property="subsac" jdbcType="VARCHAR" javaType="BaseType.U_CUACNO" mode="in" parameterType="condition"/>
        </parameterMap>
        <resultMap class="java.util.Map">
            <result property="subsac" javaType="BaseType.U_CUACNO" jdbcType="VARCHAR" column="subsac2"/>
        </resultMap>
    </select>
    <select cache="none" method="selectOne" type="sql" id="queryMaxSerial" longname="取最大serial">
        <sql type="mysql"><![CDATA[ 
			select  max(substr(acctno,19,4)) as serial
			from gl_kna_acct 
 			where acctno >= concat(#acctno#,'0000')
				and acctno <= concat(#acctno#,'9999')
 		]]></sql>
        <sql type="oracle"><![CDATA[ 
			select  max(substr(acctno,19,4)) as serial
			from gl_kna_acct 
 			where acctno >= concat(#acctno#,'0000')
				and acctno <= concat(#acctno#,'9999')
 		]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="acctno" jdbcType="VARCHAR" javaType="BaseType.U_ACCTNO" mode="in" parameterType="condition"/>
        </parameterMap>
        <resultMap class="java.lang.String">
            <result property="serial" javaType="BaseType.U_SEQUNO" jdbcType="VARCHAR" column="serial"/>
        </resultMap>
    </select>
    <select cache="none" method="selectOne" type="sql" id="queryBrchNoShort" longname="取机构简码">
        <sql type="mysql"><![CDATA[ 
			select brnosh from kub_brch
			where brchno = #acctno#
 		]]></sql>
        <sql type="oracle"><![CDATA[ 
			select brnosh from kub_brch
			where brchno = #acctno#
 		]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="acctno" jdbcType="VARCHAR" javaType="BaseType.U_ACCTNO" mode="in" parameterType="condition"/>
        </parameterMap>
        <resultMap class="java.lang.String">
            <result property="brnosh" javaType="BaseType.U_BRCHNO" jdbcType="VARCHAR" column="brnosh"/>
        </resultMap>
    </select>
    <update method="update" id="updateGlAcctBalance" longname="更新内部户余额">
        <sql type="mysql"><![CDATA[
  			update gl_kna_acct
  			set blncdn = #blncdn#,
  	    		crctbl = #crctbl#,
   	    		drctbl = #drctbl#,
   	    		credbl = #credbl#,
   	    		dredbl = #dredbl#,
   	    		lstrdt = #lstrdt#,
   	    		lstrsq = #lstrsq#,
				tmstmp = #tmstmp#
  			where acctno = #acctno#
  		]]></sql>
        <sql type="oracle"><![CDATA[
 			update gl_kna_acct
 			set blncdn = #blncdn#,
 	    		crctbl = #crctbl#,
  	    		drctbl = #drctbl#,
  	    		credbl = #credbl#,
  	    		dredbl = #dredbl#,
  	    		lstrdt = #lstrdt#,
  	    		lstrsq = #lstrsq#,
			tmstmp = #tmstmp#
 			where acctno = #acctno#
  		]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="acctno" jdbcType="VARCHAR" javaType="BaseType.U_ACCTNO" mode="in" parameterType="condition"/>
            <parameter property="blncdn" jdbcType="VARCHAR" javaType="InEnumType.E_BLNCDN" mode="in" parameterType="condition"/>
            <parameter property="crctbl" jdbcType="DECIMAL" javaType="BaseType.U_ACBLTP" mode="in" parameterType="condition"/>
            <parameter property="drctbl" jdbcType="DECIMAL" javaType="BaseType.U_ACBLTP" mode="in" parameterType="condition"/>
            <parameter property="credbl" jdbcType="DECIMAL" javaType="BaseType.U_ACBLTP" mode="in" parameterType="condition"/>
            <parameter property="dredbl" jdbcType="DECIMAL" javaType="BaseType.U_ACBLTP" mode="in" parameterType="condition"/>
            <parameter property="lstrdt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" parameterType="condition"/>
            <parameter property="lstrsq" jdbcType="VARCHAR" javaType="BaseType.U_SEQUNO" mode="in" parameterType="condition"/>
            <parameter property="tmstmp" jdbcType="VARCHAR" javaType="ApBaseType.U_TMSTMP" mode="in" longname="时间戳" parameterType="condition"/>
        </parameterMap>
    </update>
    <select cache="none" method="selectOne" type="sql" id="queryGlBill" longname="查询内部户账单">
        <sql type="mysql"><![CDATA[ 
		select /*+ Index(a idx_gl_knl_bill_transq )*/
		max(billsq) as billsq
		from gl_knl_bill a
		where trandt = #sttsdt# and transq = #sttssq# and acctno = #acctno# and amntcd = #amntcd# and tranam = #tranam# 
 		]]></sql>
        <sql type="oracle"><![CDATA[ 
		select /*+ Index(a idx_gl_knl_bill_transq )*/
		max(billsq) as billsq
		from gl_knl_bill a
		where trandt = #sttsdt# and transq = #sttssq# and acctno = #acctno# and amntcd = #amntcd# and tranam = #tranam# 
 		]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="sttsdt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" parameterType="condition"/>
            <parameter property="sttssq" jdbcType="VARCHAR" javaType="BaseType.U_SEQUNO" mode="in" parameterType="condition"/>
            <parameter property="acctno" jdbcType="VARCHAR" javaType="BaseType.U_ACCTNO" mode="in" parameterType="condition"/>
            <parameter property="amntcd" jdbcType="VARCHAR" javaType="BaseEnumType.E_AMNTCD" mode="in" parameterType="condition"/>
            <parameter property="tranam" jdbcType="DECIMAL" javaType="BaseType.U_ACBLTP" mode="in" parameterType="condition"/>
        </parameterMap>
        <resultMap class="java.lang.String"/>
    </select>
    <update method="update" id="updateGlBill" longname="更新内部账单冲账状态">
        <sql type="mysql"><![CDATA[
		update /*+ Index(a idx_gl_knl_bill_transq )*/
		gl_knl_bill a
		set corrtg = #corrtg#
		where trandt = #sttsdt# and transq = #sttssq# and acctno = #acctno# and amntcd = #amntcd# and tranam = #tranam#
  		]]></sql>
        <sql type="oracle"><![CDATA[
		update /*+ Index(a idx_gl_knl_bill_transq )*/
		gl_knl_bill a
		set corrtg = #corrtg#
		where trandt = #sttsdt# and transq = #sttssq# and acctno = #acctno# and amntcd = #amntcd# and tranam = #tranam#
  		]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="sttsdt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" parameterType="condition"/>
            <parameter property="sttssq" jdbcType="VARCHAR" javaType="BaseType.U_SEQUNO" mode="in" parameterType="condition"/>
            <parameter property="acctno" jdbcType="VARCHAR" javaType="BaseType.U_ACCTNO" mode="in" parameterType="condition"/>
            <parameter property="amntcd" jdbcType="VARCHAR" javaType="BaseEnumType.E_AMNTCD" mode="in" parameterType="condition"/>
            <parameter property="tranam" jdbcType="DECIMAL" javaType="BaseType.U_ACBLTP" mode="in" parameterType="condition"/>
            <parameter property="corrtg" jdbcType="VARCHAR" javaType="InEnumType.E_CORRTG" mode="in" parameterType="condition"/>
        </parameterMap>
    </update>
    <update method="update" id="updateGlBillBala" longname="更新冲账期间内部户账单余额">
        <sql type="mysql"><![CDATA[
		update /*+ Index(a idx_gl_knl_bill_acctno )*/
		gl_knl_bill a
		set tranbl = tranbl + #tranam#
		where trandt = #trandt# and acctno = #acctno# and billsq >= #stblsq# and billsq < #billsq#
  		]]></sql>
        <sql type="oracle"><![CDATA[
		update /*+ Index(a idx_gl_knl_bill_acctno )*/
		gl_knl_bill a
		set tranbl = tranbl + #tranam#
		where trandt = #trandt# and acctno = #acctno# and billsq >= #stblsq# and billsq < #billsq#
  		]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="trandt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" parameterType="condition"/>
            <parameter property="acctno" jdbcType="VARCHAR" javaType="BaseType.U_ACCTNO" mode="in" parameterType="condition"/>
            <parameter property="billsq" jdbcType="VARCHAR" javaType="BaseType.U_SEQUNO" mode="in" parameterType="condition"/>
            <parameter property="stblsq" jdbcType="VARCHAR" javaType="BaseType.U_SEQUNO" mode="in" parameterType="condition"/>
            <parameter property="tranam" jdbcType="DECIMAL" javaType="BaseType.U_ACBLTP" mode="in" parameterType="condition"/>
        </parameterMap>
    </update>
    <select cache="none" method="selectOne" type="sql" id="queryGlRlbl" longname="查询非实时余额内部户单会话当日发生额">
        <sql type="mysql"><![CDATA[ 
		select trandt as trandt2,acctno as acctno2,sessid as sessid2,tranam,transq
		from gl_kns_rlbl
		where trandt = #trandt# and acctno = #acctno# and sessid = #sessid# and corpno = #corpno#
		]]></sql>
        <sql type="oracle"><![CDATA[ 
		select trandt as trandt2,acctno as acctno2,sessid as sessid2,tranam,transq
		from gl_kns_rlbl
		where trandt = #trandt# and acctno = #acctno# and sessid = #sessid# and corpno = #corpno#
		]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="trandt" ref="PbDict.Intr.trandt" jdbcType="VARCHAR" javaType="PbBaseType.U_DATE08" mode="in" longname="交易日期" parameterType="condition"/>
            <parameter property="acctno" ref="InDict.inac.acctno" jdbcType="VARCHAR" javaType="BaseType.U_ACCTNO" mode="in" longname="内部户账号" parameterType="condition"/>
            <parameter property="sessid" ref="InDict.inac.sessid" jdbcType="VARCHAR" javaType="BaseType.U_SESSID" mode="in" longname="会话ID" parameterType="condition"/>
            <parameter property="corpno" ref="BaseDict.Comm.corpno" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人编号" parameterType="condition"/>
        </parameterMap>
        <resultMap class="java.util.Map">
            <result property="trandt" javaType="BaseType.U_DATE08" jdbcType="VARCHAR" column="trandt2"/>
            <result property="acctno" javaType="BaseType.U_ACCTNO" jdbcType="VARCHAR" column="acctno2"/>
            <result property="sessid" javaType="BaseType.U_SESSID" jdbcType="VARCHAR" column="sessid2"/>
            <result property="tranam" javaType="BaseType.U_ACBLTP" jdbcType="DECIMAL" column="tranam"/>
            <result property="transq" javaType="BaseType.U_SEQUNO" jdbcType="VARCHAR" column="transq"/>
        </resultMap>
    </select>
    <insert id="insertGlRlbl" longname="登记非实时余额内部户发生额">
        <sql type="mysql"><![CDATA[
		insert into gl_kns_rlbl(trandt,acctno,sessid,tranam,transq)
		values(#trandt#,#acctno#,#sessid#,#tranam#,#transq#)
		]]></sql>
        <sql type="oracle"><![CDATA[
		insert into gl_kns_rlbl(trandt,acctno,sessid,tranam,transq)
		values(#trandt#,#acctno#,#sessid#,#tranam#,#transq#)
		]]></sql>
        <parameterMap class="In.GlKnsRlbl"/>
    </insert>
    <update method="update" id="updateGlRlbl" longname="更新非实时余额内部户当日发生额">
        <sql type="mysql"><![CDATA[
		update gl_kns_rlbl 
		set tranam = tranam + #tranam#,transq = #transq# 
		where trandt = #trandt# and acctno = #acctno# and sessid = #sessid# and corpno = #corpno#
		]]></sql>
        <sql type="oracle"><![CDATA[
		update gl_kns_rlbl 
		set tranam = tranam + #tranam#,transq = #transq# 
		where trandt = #trandt# and acctno = #acctno# and sessid = #sessid# and corpno = #corpno#
		]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="trandt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" parameterType="condition"/>
            <parameter property="acctno" jdbcType="VARCHAR" javaType="BaseType.U_ACCTNO" mode="in" parameterType="condition"/>
            <parameter property="sessid" jdbcType="VARCHAR" javaType="BaseType.U_SESSID" mode="in" parameterType="condition"/>
            <parameter property="transq" jdbcType="VARCHAR" javaType="BaseType.U_SEQUNO" mode="in" parameterType="condition"/>
            <parameter property="tranam" jdbcType="DECIMAL" javaType="BaseType.U_ACBLTP" mode="in" parameterType="condition"/>
            <parameter property="corpno" ref="BaseDict.Comm.corpno" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人编号" parameterType="condition"/>
        </parameterMap>
    </update>
    <select cache="none" method="selectOne" type="sql" id="querySumRlbl" longname="非实时余额内部户查询当日全部发生额">
        <sql type="oracle"><![CDATA[ 
		select nvl(sum(tranam),0) as tranam
		from gl_kns_rlbl 
		where trandt = #trandt#
		and   acctno = #acctno# 
 		]]></sql>
        <sql type="mysql"><![CDATA[
       	select ifnull(sum(tranam),0) as tranam
		from gl_kns_rlbl 
		where trandt = #trandt#
		and   acctno = #acctno# ]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="trandt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" parameterType="condition"/>
            <parameter property="acctno" jdbcType="VARCHAR" javaType="BaseType.U_ACCTNO" mode="in" parameterType="condition"/>
        </parameterMap>
        <resultMap class="java.util.Map">
            <result property="tranam" javaType="BaseType.U_ACBLTP" jdbcType="DECIMAL" column="tranam"/>
        </resultMap>
    </select>
    <select cache="none" method="selectOne" type="sql" id="qrySumRlbl" longname="非实时余额内部户查询全部发生额">
        <sql type="oracle"><![CDATA[ 
		select nvl(sum(tranam),0) as tranam
		from gl_kns_rlbl 
		where acctno = #acctno# 
 		]]></sql>
        <sql type="mysql"><![CDATA[
       	select ifnull(sum(tranam),0) as tranam
		from gl_kns_rlbl 
		where acctno = #acctno# 
 		]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="acctno" jdbcType="VARCHAR" javaType="BaseType.U_ACCTNO" mode="in" parameterType="condition"/>
        </parameterMap>
        <resultMap class="java.util.Map">
            <result property="tranam" javaType="BaseType.U_ACBLTP" jdbcType="DECIMAL" column="tranam"/>
        </resultMap>
    </select>
    <select cache="none" method="selectFirst" type="sql" id="qryStacno" longname="查询套号">
        <sql type="mysql"><![CDATA[ 
		select  /*+index (a IDX_GL_KNS_GLVC_TRANSQ)*/ stacno 
		from gl_kns_glvc a
		where trandt = #trandt# and transq = #transq#  and stacno <> '*'
 		]]></sql>
        <sql type="oracle"><![CDATA[ 
		select  /*+index (a IDX_GL_KNS_GLVC_TRANSQ)*/ stacno 
		from gl_kns_glvc a
		where trandt = #trandt# and transq = #transq#  and stacno <> '*'
 		]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="trandt" ref="BaseDict.Comm.trandt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="交易日期" parameterType="condition"/>
            <parameter property="transq" ref="BaseDict.Comm.transq" jdbcType="VARCHAR" javaType="BaseType.U_SEQUNO" mode="in" longname="交易流水" parameterType="condition"/>
        </parameterMap>
        <resultMap class="java.lang.String"/>
    </select>
    <select cache="none" method="selectAll" type="sql" id="CheckBalanceOfGlvcByTransq" longname="交易平衡检查">
        <sql type="oracle"><![CDATA[
		select crcycd,nvl(sum(case when amntcd='C' then tranam else -tranam end),0) as tranam
		from kns_acsq
		where 	trandt=#trandt# and mntrsq=#transq# 
		    and ioflag='I'
         		    group by crcycd
		    having sum(case when amntcd='C' then tranam else -tranam end) <> 0.00
		]]></sql>
        <sql type="mysql"><![CDATA[
		select crcycd,ifnull(sum(case when amntcd='C' then tranam else -tranam end),0) as tranam
		from kns_acsq
		where 	trandt=#trandt# and mntrsq=#transq# 
		    and ioflag='I'
         		    group by crcycd
		    having sum(case when amntcd='C' then tranam else -tranam end) <> 0.00
		]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="trandt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" parameterType="condition"/>
            <parameter property="transq" jdbcType="VARCHAR" javaType="BaseType.U_SEQUNO" mode="in" parameterType="condition"/>
        </parameterMap>
        <resultMap class="InQueryTypes.BalanceOfCmda"/>
    </select>
    <select cache="none" method="selectOne" type="sql" id="queryMaxCommnm" longname="取最大传票顺序号">
        <sql type="mysql"><![CDATA[ 
		select  max(commnm) as commnm
		from fns_cmbk 
		where commsq = #commsq#
		and trandt = #trandt#
 		]]></sql>
        <sql type="oracle"><![CDATA[ 
		select  max(commnm) as commnm
		from fns_cmbk 
		where commsq = #commsq#
		and trandt = #trandt#
 		]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="commsq" jdbcType="VARCHAR" javaType="BaseType.U_SEQUNO" mode="in" parameterType="condition"/>
            <parameter property="trandt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" parameterType="condition"/>
        </parameterMap>
        <resultMap class="java.lang.String">
            <result property="commnm" javaType="BaseType.U_SEQUNO" jdbcType="VARCHAR" column="commnm"/>
        </resultMap>
    </select>
    <select cache="none" method="selectAll" type="sql" id="CheckBalanceOfFnsCmbk" longname="财务记账登记簿平衡检查">
        <sql type="oracle"><![CDATA[
		     SELECT Crcycd,
				   nvl(SUM(CASE
							   WHEN Amntcd = 'C' THEN
								Tranam
							   WHEN Amntcd = 'R' THEN
								Tranam
							   ELSE
								-tranam
						   END),
					   0) AS Tranam
			  FROM fns_cmbk
			 WHERE Commsq = #commsq#
			   AND Trandt = #trandt#
			   AND Transt = '0'
			   AND Ioflag = 'I'
			 GROUP BY Crcycd
			HAVING SUM(CASE
				WHEN Amntcd = 'C' THEN
				 Tranam
				WHEN Amntcd = 'R' THEN
				 Tranam
				ELSE
				 -tranam
			END) <> 0.00
		]]></sql>
        <sql type="mysql"><![CDATA[
		     SELECT Crcycd,
				   ifnull(SUM(CASE
							   WHEN Amntcd = 'C' THEN
								Tranam
							   WHEN Amntcd = 'R' THEN
								Tranam
							   ELSE
								-tranam
						   END),
					   0) AS Tranam
			  FROM fns_cmbk
			 WHERE Commsq = #commsq#
			   AND Trandt = #trandt#
			   AND Transt = '0'
			   AND Ioflag = 'I'
			 GROUP BY Crcycd
			HAVING SUM(CASE
				WHEN Amntcd = 'C' THEN
				 Tranam
				WHEN Amntcd = 'R' THEN
				 Tranam
				ELSE
				 -tranam
			END) <> 0.00
		]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="commsq" jdbcType="VARCHAR" javaType="BaseType.U_SEQUNO" mode="in" parameterType="condition"/>
            <parameter property="trandt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" parameterType="condition"/>
        </parameterMap>
        <resultMap class="InQueryTypes.BalanceOfCmda"/>
    </select>
    <select cache="none" method="selectOne" type="sql" id="queryinAcctApi" longname="内部户信息查询">
        <sql type="oracle"><![CDATA[
        select a.rlbltg,b.lastdn,b.crltbl,a.crctbl,b.drltbl,a.drctbl,a.busidn,a.blncdn,a.ovmony ,a.pmodtg from gl_kna_acct a,gl_kna_lsbl b
		where a.acctno = b.acctno and a.acctno=#acctno#
		]]></sql>
        <sql type="mysql"><![CDATA[
        select a.rlbltg,b.lastdn,b.crltbl,a.crctbl,b.drltbl,a.drctbl,a.busidn,a.blncdn,a.ovmony ,a.pmodtg from gl_kna_acct a,gl_kna_lsbl b
		where a.acctno = b.acctno and a.acctno=#acctno#
		]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="acctno" ref="InDict.inac.acctno" jdbcType="VARCHAR" javaType="BaseType.U_ACCTNO" mode="in" longname="内部户账号" parameterType="condition"/>
        </parameterMap>
        <resultMap class="IoInQueryTypes.IoInAcctTmp"/>
    </select>
    <select cache="none" method="selectAll" type="sql" id="selGlKnaAcct" longname="查询内部账户信息">
        <sql><![CDATA[select * from gl_kna_acct order by acctno]]></sql>
        <sql type="mysql"><![CDATA[select * from gl_kna_acct order by acctno]]></sql>
        <sql type="oracle"><![CDATA[select * from gl_kna_acct order by acctno]]></sql>
        <parameterMap class="java.util.Map"/>
        <resultMap class="In.GlKnaAcct"/>
    </select>
    <select cache="none" method="selectAll" type="sql" id="selGlKnaLsbl" longname="查询内部账户上日余额信息">
        <sql><![CDATA[select * from gl_kna_lsbl order by acctno]]></sql>
        <sql type="mysql"><![CDATA[select * from gl_kna_lsbl order by acctno]]></sql>
        <sql type="oracle"><![CDATA[select * from gl_kna_lsbl order by acctno]]></sql>
        <parameterMap class="java.util.Map"/>
        <resultMap class="In.GlKnaLsbl"/>
    </select>
    <select cache="none" method="selectOne" type="sql" id="queryInAcctBySubsac" longname="根据子户号和业务代码查询内部户信息">
        <sql><![CDATA[ 
		Select a.*
		From gl_kna_acct a
		Where a.busino= #busino# 
		And a.crcycd = #crcycd# 
		And a.brchno = #brchno# 
		And a.subsac =#subsac#
 		]]></sql>
        <sql type="mysql"><![CDATA[ 
		Select a.*
		From gl_kna_acct a
		Where a.busino= #busino# 
		And a.crcycd = #crcycd# 
		And a.brchno = #brchno# 
		And a.subsac =#subsac#
 		]]></sql>
        <sql type="oracle"><![CDATA[ 
		Select a.*
		From gl_kna_acct a
		Where a.busino= #busino# 
		And a.crcycd = #crcycd# 
		And a.brchno = #brchno# 
		And a.subsac =#subsac#
 		]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="busino" ref="InDict.inac.busino" jdbcType="VARCHAR" javaType="BaseType.U_BUSINO" mode="in" longname="业务代码" parameterType="condition"/>
            <parameter property="crcycd" jdbcType="VARCHAR" javaType="BaseType.U_CRCYCD" mode="in" parameterType="condition"/>
            <parameter property="brchno" jdbcType="VARCHAR" javaType="BaseType.U_BRCHNO" mode="in" parameterType="condition"/>
            <parameter property="subsac" ref="InDict.inac.subsac" jdbcType="VARCHAR" javaType="BaseType.U_CUACNO" mode="in" longname="子户号" parameterType="condition"/>
        </parameterMap>
        <resultMap class="In.GlKnaAcct"/>
    </select>
    <select cache="none" method="selectOne" type="sql" id="queryInBaseAcct" longname="查询基准账户">
        <sql><![CDATA[ 
		Select a.*
		From gl_kna_acct a
		Where a.busino= #busino# 
		And a.crcycd = #crcycd# 
		And a.brchno = #brchno# 
		And a.inactp = '1'
 		]]></sql>
        <sql type="mysql"><![CDATA[ 
		Select a.*
		From gl_kna_acct a
		Where a.busino= #busino# 
		And a.crcycd = #crcycd# 
		And a.brchno = #brchno# 
		And a.inactp = '1'
 		]]></sql>
        <sql type="oracle"><![CDATA[ 
		Select a.*
		From gl_kna_acct a
		Where a.busino= #busino# 
		And a.crcycd = #crcycd# 
		And a.brchno = #brchno# 
		And a.inactp = '1'
 		]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="busino" ref="InDict.inac.busino" jdbcType="VARCHAR" javaType="BaseType.U_BUSINO" mode="in" longname="业务代码" parameterType="condition"/>
            <parameter property="crcycd" jdbcType="VARCHAR" javaType="BaseType.U_CRCYCD" mode="in" parameterType="condition"/>
            <parameter property="brchno" jdbcType="VARCHAR" javaType="BaseType.U_BRCHNO" mode="in" parameterType="condition"/>
        </parameterMap>
        <resultMap class="In.GlKnaAcct"/>
    </select>
    <select cache="none" method="selectAll" type="sql" id="queryKnsAcsqGroupByBrchForClear" longname="统计清算交易流水信息">
        <sql type="mysql"><![CDATA[
		select corpno,acctbr,crcycd,ifnull(sum(case when amntcd='C' then tranam else -tranam end),0) as tranam
		from kns_acsq
		where 	trandt=#trandt# and mntrsq=#transq# 
		    and ioflag='I'
         		    group by crcycd,acctbr,corpno
         		    having sum(case when amntcd='C' then tranam else -tranam end)<>0.00
		]]></sql>
        <sql type="oracle"><![CDATA[
		select corpno,acctbr,crcycd,nvl(sum(case when amntcd='C' then tranam else -tranam end),0) as tranam
		from kns_acsq
		where 	trandt=#trandt# and mntrsq=#transq# 
		    and ioflag='I'
         		    group by crcycd,acctbr,corpno
         		    having sum(case when amntcd='C' then tranam else -tranam end)<>0.00
		]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="trandt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" parameterType="condition"/>
            <parameter property="transq" jdbcType="VARCHAR" javaType="BaseType.U_SEQUNO" mode="in" parameterType="condition"/>
        </parameterMap>
        <resultMap class="InQueryTypes.KnsAcsqGroupInfo"/>
    </select>
    <insert id="insertKnsAcsqColl" longname="登记清算流水汇总登记簿">
        <sql><![CDATA[
        insert into kns_acsq_coll
		(toacct, acctno,brchno,prodcd,crcycd,clactp,cranam,dranam,drcunt,crcunt,status,clenum,clerdt) 
		select toacct, acctno,toacbr,prodcd,crcycd,clactp, sum(case when amntcd ='C' then tranam else 0 end  )as cranam ,
		sum(case when amntcd ='D' then tranam else 0 end  ) as dranam, sum(case when amntcd ='D' then 1 else 0 end  )as drcunt,
		sum(case when amntcd ='C' then 1 else 0 end  )as crcunt, '0' , #clenum# , #clerdt# 
		from kns_acsq_cler  where clerdt = #clerdt# and clerst='0' and clenum =#clenum# 
		and prodcd !=#prodcd# group by toacct, acctno,clerdt,toacbr,prodcd,crcycd,clactp
		]]></sql>
        <sql type="mysql"><![CDATA[
        insert into kns_acsq_coll
		(toacct, acctno,brchno,prodcd,crcycd,clactp,cranam,dranam,drcunt,crcunt,status,clenum,clerdt) 
		select toacct, acctno,toacbr,prodcd,crcycd,clactp, sum(case when amntcd ='C' then tranam else 0 end  )as cranam ,
		sum(case when amntcd ='D' then tranam else 0 end  ) as dranam, sum(case when amntcd ='D' then 1 else 0 end  )as drcunt,
		sum(case when amntcd ='C' then 1 else 0 end  )as crcunt, '0' , #clenum# , #clerdt# 
		from kns_acsq_cler  where clerdt = #clerdt# and clerst='0' and clenum =#clenum# 
		and prodcd !=#prodcd# group by toacct, acctno,clerdt,toacbr,prodcd,crcycd,clactp
		]]></sql>
        <sql type="oracle"><![CDATA[
        insert into kns_acsq_coll
		(toacct, acctno,brchno,prodcd,crcycd,clactp,cranam,dranam,drcunt,crcunt,status,clenum,clerdt) 
		select toacct, acctno,toacbr,prodcd,crcycd,clactp, sum(case when amntcd ='C' then tranam else 0 end  )as cranam ,
		sum(case when amntcd ='D' then tranam else 0 end  ) as dranam, sum(case when amntcd ='D' then 1 else 0 end  )as drcunt,
		sum(case when amntcd ='C' then 1 else 0 end  )as crcunt, '0' , #clenum# , #clerdt# 
		from kns_acsq_cler  where clerdt = #clerdt# and clerst='0' and clenum =#clenum# 
		and prodcd !=#prodcd# group by toacct, acctno,clerdt,toacbr,prodcd,crcycd,clactp
		]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="clerdt" ref="BaseDict.Comm.clerdt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="清算日期" parameterType="condition"/>
            <parameter property="clenum" jdbcType="VARCHAR" javaType="BaseType.U_INTEGE" mode="in" longname="清算场次" parameterType="condition"/>
            <parameter property="prodcd" ref="CcDict.Parm.prodcd" jdbcType="VARCHAR" javaType="CcBaseType.U_PRODCD" mode="in" longname="产品代码" parameterType="condition"/>
        </parameterMap>
    </insert>
    <select cache="none" method="selectAll" type="sql" id="selKnsAcsqColl" longname="查询清算流水汇总登记簿">
        <sql><![CDATA[
        select  a.* from kns_acsq_coll a 
		where a.clerdt = #clerdt#
		and a.status = '0' 
		and a.clenum =  #clenum#
		union all
		select  b.* from kns_acsq_coll b 
		where b.status = '3' 
		]]></sql>
        <sql type="mysql"><![CDATA[
        select  a.* from kns_acsq_coll a 
		where a.clerdt = #clerdt#
		and a.status = '0' 
		and a.clenum =  #clenum#
		union all
		select  b.* from kns_acsq_coll b 
		where b.status = '3' 
		]]></sql>
        <sql type="oracle"><![CDATA[
        select  a.* from kns_acsq_coll a 
		where a.clerdt = #clerdt#
		and a.status = '0' 
		and a.clenum =  #clenum#
		union all
		select  b.* from kns_acsq_coll b 
		where b.status = '3' 
		]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="clerdt" ref="BaseDict.Comm.clerdt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="清算日期" parameterType="condition"/>
            <parameter property="clenum" jdbcType="VARCHAR" javaType="BaseType.U_INTEGE" mode="in" longname="清算场次" parameterType="condition"/>
        </parameterMap>
        <resultMap class="In.KnsAcsqColl"/>
    </select>
    <select cache="none" method="selectOne" type="sql" id="selClenumKnsAcsqColl" longname="查询场次">
        <sql><![CDATA[select max(clenum) from kns_acsq_coll where clerdt = #clerdt#]]></sql>
        <sql type="mysql"><![CDATA[select max(clenum) from kns_acsq_coll where clerdt = #clerdt#]]></sql>
        <sql type="oracle"><![CDATA[select max(clenum) from kns_acsq_coll where clerdt = #clerdt#]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="clerdt" ref="BaseDict.Comm.clerdt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="清算日期" parameterType="condition"/>
        </parameterMap>
        <resultMap class="java.lang.String"/>
    </select>
    <update method="update" id="updKnsAcsqCler" longname="更新会计流水清算表清算状态">
        <sql><![CDATA[update kns_acsq_cler a set a.clerst = '1',tmstmp=#tmstmp# where a.clerdt = #clerdt# and a.clerst = '0' and a.clenum =#clenum#]]></sql>
        <sql type="mysql"><![CDATA[update kns_acsq_cler a set a.clerst = '1',tmstmp=#tmstmp# where a.clerdt = #clerdt# and a.clerst = '0' and a.clenum =#clenum#]]></sql>
        <sql type="oracle"><![CDATA[update kns_acsq_cler a set a.clerst = '1',tmstmp=#tmstmp# where a.clerdt = #clerdt# and a.clerst = '0' and a.clenum =#clenum#]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="clerdt" ref="BaseDict.Comm.clerdt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="清算日期" parameterType="condition"/>
            <parameter property="clenum" jdbcType="VARCHAR" javaType="BaseType.U_INTEGE" mode="in" longname="清算场次" parameterType="condition"/>
            <parameter property="tmstmp" ref="ApDict.Aplt.tmstmp" jdbcType="VARCHAR" javaType="ApBaseType.U_TMSTMP" mode="in" longname="时间戳" parameterType="condition"/>
        </parameterMap>
    </update>
    <select cache="none" method="selectAll" type="sql" id="selKnsAcsqDpAcct" longname="查询会计流水表中的存款本金记录">
        <sql><![CDATA[
		select a.*
		from kns_acsq a
		where 	a.trandt=#trandt# and a.mntrsq=#mntrsq# 
		    and ioflag='I' 
		]]></sql>
        <sql type="mysql"><![CDATA[
		select a.*
		from kns_acsq a
		where 	a.trandt=#trandt# and a.mntrsq=#mntrsq# 
		    and ioflag='I' 
		]]></sql>
        <sql type="oracle"><![CDATA[
		select a.*
		from kns_acsq a
		where 	a.trandt=#trandt# and a.mntrsq=#mntrsq# 
		    and ioflag='I' 
		]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="trandt" ref="BaseDict.Comm.trandt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="交易日期" parameterType="condition"/>
            <parameter property="mntrsq" ref="DpDict.Froz.mntrsq" jdbcType="VARCHAR" javaType="BaseType.U_SEQUNO" mode="in" longname="主交易流水" parameterType="condition"/>
        </parameterMap>
        <resultMap class="IoAccountComplexType.IoAccounttingIntf"/>
    </select>
    <select cache="none" method="selectOne" type="sql" id="selSupplyCount" longname="查询清算头寸汇总明细总数">
        <sql type="oracle"><![CDATA[
        with RD(crcycd, acctbr, amntcd, crdamt, crdcnt) as (select crcycd,acctbr,amntcd,sum(tranam),count(1) 
		from kns_acsq_cler 
		where trandt = #trandt#  
		and clerst = #clerst# 
		and amntcd = 'D'
		group by acctbr, amntcd,crcycd),
		RC(crcycd, acctbr, amntcd, debamt, debcnt) as (select crcycd,acctbr,amntcd,sum(tranam),count(1) 
		from kns_acsq_cler 
		where trandt = #trandt#  
		and clerst = #clerst# 
		and amntcd = 'C'
		group by acctbr, amntcd,crcycd)
		select count(1) from RD left join RC on RD.acctbr = RC.acctbr
		]]></sql>
        <sql type="mysql"><![CDATA[
		SELECT * FROM 
		(
			SELECT crcycd, acctbr, amntcd, SUM(tranam), COUNT(1) FROM kns_acsq_cler
			WHERE
				trandt = #trandt#
				AND clerst = #clerst#
				AND amntcd = 'D'
			GROUP BY acctbr, amntcd, crcycd
		) a
		LEFT JOIN
		(
			SELECT crcycd, acctbr, amntcd, SUM(tranam), COUNT(1) FROM kns_acsq_cler
			WHERE
				trandt = #trandt#
				AND clerst = #clerst#
				AND amntcd = 'C'
			GROUP BY acctbr, amntcd, crcycd
		) b 
		ON a.acctbr = b.acctbr]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="trandt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" parameterType="condition"/>
            <parameter property="clerst" jdbcType="VARCHAR" javaType="BaseEnumType.E_CLERST" mode="in" parameterType="condition"/>
        </parameterMap>
        <resultMap class="long"/>
    </select>
    <select cache="none" method="selectAll" type="sql" id="selSupplyDetail" longname="查询清算头寸汇总明细数据">
        <sql><![CDATA[
        select toacct, acctno,toacbr as acctbr,prodcd,crcycd,clactp, 
		sum(case when amntcd ='D' then tranam else 0 end )as debamt, 
		sum(case when amntcd ='D' then 1 else 0 end )as debcnt,
		sum(case when amntcd ='C' then tranam else 0 end )as crdamt,
		sum(case when amntcd ='C' then 1 else 0 end )as crdcnt, '0' status
		from kns_acsq_cler where clerst='0' and prodcd <>'9930410306' 
		group by toacct, acctno,clerdt,toacbr,prodcd,crcycd,clactp
		union all
		select toacct, acctno,brchno as acctbr,prodcd,crcycd,clactp,
		cranam,dranam,drcunt,crcunt,status
		from kns_acsq_coll where status='3'
		]]></sql>
        <sql type="mysql"><![CDATA[
        select toacct, acctno,toacbr as acctbr,prodcd,crcycd,clactp, 
		sum(case when amntcd ='D' then tranam else 0 end )as debamt, 
		sum(case when amntcd ='D' then 1 else 0 end )as debcnt,
		sum(case when amntcd ='C' then tranam else 0 end )as crdamt,
		sum(case when amntcd ='C' then 1 else 0 end )as crdcnt, '0' status
		from kns_acsq_cler where clerst='0' and prodcd <>'9930410306' 
		group by toacct, acctno,clerdt,toacbr,prodcd,crcycd,clactp
		union all
		select toacct, acctno,brchno as acctbr,prodcd,crcycd,clactp,
		cranam,dranam,drcunt,crcunt,status
		from kns_acsq_coll where status='3'
		]]></sql>
        <sql type="oracle"><![CDATA[
        select toacct, acctno,toacbr as acctbr,prodcd,crcycd,clactp, 
		sum(case when amntcd ='D' then tranam else 0 end )as debamt, 
		sum(case when amntcd ='D' then 1 else 0 end )as debcnt,
		sum(case when amntcd ='C' then tranam else 0 end )as crdamt,
		sum(case when amntcd ='C' then 1 else 0 end )as crdcnt, '0' status
		from kns_acsq_cler where clerst='0' and prodcd <>'9930410306' 
		group by toacct, acctno,clerdt,toacbr,prodcd,crcycd,clactp
		union all
		select toacct, acctno,brchno as acctbr,prodcd,crcycd,clactp,
		cranam,dranam,drcunt,crcunt,status
		from kns_acsq_coll where status='3'
		]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="clerst" jdbcType="VARCHAR" javaType="BaseEnumType.E_CLERST" mode="in" parameterType="condition"/>
        </parameterMap>
        <resultMap class="InQueryTypes.SupplyDetail"/>
    </select>
    <select cache="none" method="selectOne" type="sql" id="selUserByBusino" longname="根据产品号查询产品新增柜员">
        <sql><![CDATA[select tranus from kup_dppb_user a where busibi = #busibi# and prodcd = #busino# and prtrtp = #prtrtp#]]></sql>
        <sql type="mysql"><![CDATA[select tranus from kup_dppb_user a where busibi = #busibi# and prodcd = #busino# and prtrtp = #prtrtp#]]></sql>
        <sql type="oracle"><![CDATA[select tranus from kup_dppb_user a where busibi = #busibi# and prodcd = #busino# and prtrtp = #prtrtp#]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="busibi" ref="DpDict.Prod.busibi" jdbcType="VARCHAR" javaType="DpEnumType.E_BUSIBI" mode="in" longname="业务大类" parameterType="condition"/>
            <parameter property="busino" ref="InDict.inac.busino" jdbcType="VARCHAR" javaType="BaseType.U_BUSINO" mode="in" longname="业务代码" parameterType="condition"/>
            <parameter property="prtrtp" jdbcType="VARCHAR" javaType="DpEnumType.E_PRTRTP" mode="in" longname="产品业务类型" parameterType="condition"/>
        </parameterMap>
        <resultMap class="java.lang.String"/>
    </select>
    <select cache="none" method="selectOne" type="sql" id="selKupDppbUserByBusino" longname="根据产品号查询柜员登记簿">
        <sql><![CDATA[select * from kup_dppb_user where prodcd = #busino# and prtrtp=#prtrtp#]]></sql>
        <sql type="mysql"><![CDATA[select * from kup_dppb_user where prodcd = #busino# and prtrtp=#prtrtp#]]></sql>
        <sql type="oracle"><![CDATA[select * from kup_dppb_user where prodcd = #busino# and prtrtp=#prtrtp#]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="busino" ref="PbDict.Dcmt.busino" jdbcType="VARCHAR" javaType="BaseType.U_BUSINO" mode="in" longname="业务编码" parameterType="condition"/>
            <parameter property="prtrtp" jdbcType="VARCHAR" javaType="DpEnumType.E_PRTRTP" mode="in" longname="产品交易类型" parameterType="condition"/>
        </parameterMap>
        <resultMap class="IoDpProdParts.IoKupDppbUser"/>
    </select>
    <select cache="none" method="selectAll" type="sql" id="selKupDppbUserByBusina" longname="根据产品名称查询内部户产品表">
        <sql><![CDATA[select * from gl_knp_busi where busina =#busina# and busino<> #busino# ]]></sql>
        <sql type="mysql"><![CDATA[select * from gl_knp_busi where busina =#busina# and busino<> #busino# ]]></sql>
        <sql type="oracle"><![CDATA[select * from gl_knp_busi where busina =#busina# and busino<> #busino# ]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="busina" ref="InDict.inac.busina" jdbcType="VARCHAR" javaType="BaseType.U_CHAR80" mode="in" longname="业务代码中文名称说明" parameterType="condition"/>
            <parameter property="busino" ref="PbDict.Dcmt.busino" jdbcType="VARCHAR" javaType="BaseType.U_BUSINO" mode="in" longname="业务编码" parameterType="condition"/>
        </parameterMap>
        <resultMap class="IoInTable.IoGlKnpBusi"/>
    </select>
    <select cache="none" method="selectAll" type="sql" id="selKnsCmbkUserByBusina" longname="根据套号查询传票登记簿">
        <sql><![CDATA[select a.* from kns_cmbk a  where a.acstno =#acstno# and a.trandt =#trandt# and a.iavcst<>'2']]></sql>
        <sql type="mysql"><![CDATA[select a.* from kns_cmbk a  where a.acstno =#acstno# and a.trandt =#trandt# and a.iavcst<>'2']]></sql>
        <sql type="oracle"><![CDATA[select a.* from kns_cmbk a  where a.acstno =#acstno# and a.trandt =#trandt# and a.iavcst<>'2']]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="acstno" ref="InDict.inac.acstno" jdbcType="VARCHAR" javaType="BaseType.U_SEQUNO" mode="in" longname="套号" parameterType="condition"/>
            <parameter property="trandt" ref="InDict.inac.trandt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="交易日期" parameterType="condition"/>
        </parameterMap>
        <resultMap class="In.KnsCmbk"/>
    </select>
    <delete method="delete" id="delKnsClerDetl" longname="资金清算流水明细表">
        <sql><![CDATA[
        delete from kns_cler_detl
       	where trandt <= #trandt#
		]]></sql>
        <sql type="mysql"><![CDATA[
        delete from kns_cler_detl
       	where trandt <= #trandt#
		]]></sql>
        <sql type="oracle"><![CDATA[
        delete from kns_cler_detl
       	where trandt <= #trandt#
		]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="trandt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="交易日期" parameterType="condition"/>
        </parameterMap>
    </delete>
    <delete method="delete" id="delKnsCler" longname="资金清算流水表">
        <sql><![CDATA[
        delete from kns_cler
       	where trandt = #trandt#
        and status = #status#
        ]]></sql>
        <sql type="mysql"><![CDATA[
        delete from kns_cler
       	where trandt = #trandt#
        and status = #status#
        ]]></sql>
        <sql type="oracle"><![CDATA[
        delete from kns_cler
       	where trandt = #trandt#
        and status = #status#
        ]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="trandt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="交易日期" parameterType="condition"/>
            <parameter property="status" jdbcType="VARCHAR" javaType="BaseEnumType.E_YES___" mode="in" longname="入账状态" parameterType="condition"/>
        </parameterMap>
    </delete>
    <insert id="insKnsClerFromKnsAcsqDetl" longname="准备清算数据">
        <sql><![CDATA[     
         insert into kns_cler_detl
         (corpno,
          trandt,
          clerod,
          lwbrch,
          lwacbr,
          crcycd,
          clerlv,
          clerbr,
          clacbr,
          clerdn,
          tranam,
          status,
          stacno)        
         select 
         		a.corpno,
        	    #trandt#,
                1,
                b.lwbrch,
                b.lwacbr,
                a.crcycd,
                b.clerlv,
                b.upbrch,
                b.upacbr,
                'D',
                a.tranam,
                '0',
                a.transq
           from (select v.corpno,
           				v.acctbr as tranbr, 
                        v.crcycd,
                        v.transq as transq ,
                        sum(case when v.amntcd='D' then v.tranam else -v.tranam end ) as tranam                                            
                   from kns_acsq v
                  where 
                   acctbr =#acctbr# and 
                  exists (
                  select c.transq
			from kns_brcl_trsq  c
			where 	c.trandt= #trandt#
			   and c.transq =v.transq        		    
          		    )
                  group by v.acctbr,
                           v.crcycd,
                           v.transq
                            having sum(case when v.amntcd='D' then v.tranam else -v.tranam end )!=0) a,
                kub_clbr b
          where a.tranbr = b.lwacbr
            and (a.crcycd = b.crcycd or b.crcycd = '%' or
                a.crcycd <> 'CNY' and b.crcycd = '*')]]></sql>
        <sql type="mysql"><![CDATA[     
         insert into kns_cler_detl
         (corpno,
          trandt,
          clerod,
          lwbrch,
          lwacbr,
          crcycd,
          clerlv,
          clerbr,
          clacbr,
          clerdn,
          tranam,
          status,
          stacno)        
         select 
         		a.corpno,
        	    #trandt#,
                1,
                b.lwbrch,
                b.lwacbr,
                a.crcycd,
                b.clerlv,
                b.upbrch,
                b.upacbr,
                'D',
                a.tranam,
                '0',
                a.transq
           from (select v.corpno,
           				v.acctbr as tranbr, 
                        v.crcycd,
                        v.transq as transq ,
                        sum(case when v.amntcd='D' then v.tranam else -v.tranam end ) as tranam                                            
                   from kns_acsq v
                  where 
                   acctbr =#acctbr# and 
                  exists (
                  select c.transq
			from kns_brcl_trsq  c
			where 	c.trandt= #trandt#
			   and c.transq =v.transq        		    
          		    )
                  group by v.acctbr,
                           v.crcycd,
                           v.transq
                            having sum(case when v.amntcd='D' then v.tranam else -v.tranam end )!=0) a,
                kub_clbr b
          where a.tranbr = b.lwacbr
            and (a.crcycd = b.crcycd or b.crcycd = '%' or
                a.crcycd <> 'CNY' and b.crcycd = '*')]]></sql>
        <sql type="oracle"><![CDATA[     
         insert into kns_cler_detl
         (corpno,
          trandt,
          clerod,
          lwbrch,
          lwacbr,
          crcycd,
          clerlv,
          clerbr,
          clacbr,
          clerdn,
          tranam,
          status,
          stacno)        
         select 
         		a.corpno,
        	    #trandt#,
                1,
                b.lwbrch,
                b.lwacbr,
                a.crcycd,
                b.clerlv,
                b.upbrch,
                b.upacbr,
                'D',
                a.tranam,
                '0',
                a.transq
           from (select v.corpno,
           				v.acctbr as tranbr, 
                        v.crcycd,
                        v.transq as transq ,
                        sum(case when v.amntcd='D' then v.tranam else -v.tranam end ) as tranam                                            
                   from kns_acsq v
                  where 
                   acctbr =#acctbr# and 
                  exists (
                  select c.transq
			from kns_brcl_trsq  c
			where 	c.trandt= #trandt#
			   and c.transq =v.transq        		    
          		    )
                  group by v.acctbr,
                           v.crcycd,
                           v.transq
                            having sum(case when v.amntcd='D' then v.tranam else -v.tranam end )!=0) a,
                kub_clbr b
          where a.tranbr = b.lwacbr
            and (a.crcycd = b.crcycd or b.crcycd = '%' or
                a.crcycd <> 'CNY' and b.crcycd = '*')]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="trandt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="交易日期" parameterType="condition"/>
            <parameter property="acctbr" jdbcType="VARCHAR" javaType="BaseType.U_BRCHNO" mode="in" longname="省中心" parameterType="condition"/>
        </parameterMap>
    </insert>
    <insert id="insKnsClerFromKnsAcsqDr" longname="准备清算借方数据">
        <sql><![CDATA[      
insert into kns_cler
         (trandt,
          clerod,
          lwbrch,
          lwacbr,
          crcycd,
          clerlv,
          clerbr,
          clacbr,
          clerdn,
          tranam,
          status)        
         select  
        trandt,
          clerod,
          lwbrch,
          lwacbr,
          crcycd,
          clerlv,
          clerbr,
          clacbr,
          clerdn,
          sum(tranam),
          status 
         
         from kns_cler_detl where trandt =#trandt#  and lwbrch =#acctbr# and tranam >0 group by trandt,clerod,lwbrch,lwacbr,crcycd,clerlv,clerbr,clacbr,clerdn ,status         
        
        ]]></sql>
        <sql type="oracle"><![CDATA[      
insert into kns_cler
         (trandt,
          clerod,
          lwbrch,
          lwacbr,
          crcycd,
          clerlv,
          clerbr,
          clacbr,
          clerdn,
          tranam,
          status)        
         select  
        trandt,
          clerod,
          lwbrch,
          lwacbr,
          crcycd,
          clerlv,
          clerbr,
          clacbr,
          clerdn,
          sum(tranam),
          status 
         
         from kns_cler_detl where trandt =#trandt#  and lwbrch =#acctbr# and tranam >0 group by trandt,clerod,lwbrch,lwacbr,crcycd,clerlv,clerbr,clacbr,clerdn ,status         
        
        ]]></sql>
        <sql type="mysql"><![CDATA[      
insert into kns_cler
         (trandt,
          clerod,
          lwbrch,
          lwacbr,
          crcycd,
          clerlv,
          clerbr,
          clacbr,
          clerdn,
          tranam,
          status)        
         select  
        trandt,
          clerod,
          lwbrch,
          lwacbr,
          crcycd,
          clerlv,
          clerbr,
          clacbr,
          clerdn,
          sum(tranam),
          status 
         
         from kns_cler_detl where trandt =#trandt#  and lwbrch =#acctbr# and tranam >0 group by trandt,clerod,lwbrch,lwacbr,crcycd,clerlv,clerbr,clacbr,clerdn ,status         
        
        ]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="trandt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="交易日期" parameterType="condition"/>
            <parameter property="acctbr" jdbcType="VARCHAR" javaType="BaseType.U_BRCHNO" mode="in" longname="省中心" parameterType="condition"/>
        </parameterMap>
    </insert>
    <insert id="insKnsClerFromKnsAcsqCr" longname="准备清算贷方数据">
        <sql><![CDATA[      
insert into kns_cler
         (trandt,
          clerod,
          lwbrch,
          lwacbr,
          crcycd,
          clerlv,
          clerbr,
          clacbr,
          clerdn,
          tranam,
          status)        
         select  
        trandt,
          clerod,
          lwbrch,
          lwacbr,
          crcycd,
          clerlv,
          clerbr,
          clacbr,
          clerdn,
          sum(tranam),
          status 
         
         from kns_cler_detl where trandt =#trandt#  and lwbrch =#acctbr# and tranam <0 group by trandt,clerod,lwbrch,lwacbr,crcycd,clerlv,clerbr,clacbr,clerdn ,status         
        
        ]]></sql>
        <sql type="mysql"><![CDATA[      
insert into kns_cler
         (trandt,
          clerod,
          lwbrch,
          lwacbr,
          crcycd,
          clerlv,
          clerbr,
          clacbr,
          clerdn,
          tranam,
          status)        
         select  
        trandt,
          clerod,
          lwbrch,
          lwacbr,
          crcycd,
          clerlv,
          clerbr,
          clacbr,
          clerdn,
          sum(tranam),
          status 
         
         from kns_cler_detl where trandt =#trandt#  and lwbrch =#acctbr# and tranam <0 group by trandt,clerod,lwbrch,lwacbr,crcycd,clerlv,clerbr,clacbr,clerdn ,status         
        
        ]]></sql>
        <sql type="oracle"><![CDATA[      
insert into kns_cler
         (trandt,
          clerod,
          lwbrch,
          lwacbr,
          crcycd,
          clerlv,
          clerbr,
          clacbr,
          clerdn,
          tranam,
          status)        
         select  
        trandt,
          clerod,
          lwbrch,
          lwacbr,
          crcycd,
          clerlv,
          clerbr,
          clacbr,
          clerdn,
          sum(tranam),
          status 
         
         from kns_cler_detl where trandt =#trandt#  and lwbrch =#acctbr# and tranam <0 group by trandt,clerod,lwbrch,lwacbr,crcycd,clerlv,clerbr,clacbr,clerdn ,status         
        
        ]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="trandt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="交易日期" parameterType="condition"/>
            <parameter property="acctbr" jdbcType="VARCHAR" javaType="BaseType.U_BRCHNO" mode="in" longname="省中心" parameterType="condition"/>
        </parameterMap>
    </insert>
    <select cache="none" method="selectAll" type="sql" id="queryClerBrchList" longname="查询核算部门列表">
        <sql><![CDATA[Select * From kns_cler 
		 	 Where trandt = #trandt# 
		 	   And clerlv > 0
		 	   And tranam <> 0
		 	   And status = '0'
		 	 Order by crcycd desc,clerlv desc ]]></sql>
        <sql type="mysql"><![CDATA[Select * From kns_cler 
		 	 Where trandt = #trandt# 
		 	   And clerlv > 0
		 	   And tranam <> 0
		 	   And status = '0'
		 	 Order by crcycd desc,clerlv desc ]]></sql>
        <sql type="oracle"><![CDATA[Select * From kns_cler 
		 	 Where trandt = #trandt# 
		 	   And clerlv > 0
		 	   And tranam <> 0
		 	   And status = '0'
		 	 Order by crcycd desc,clerlv desc ]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="trandt" ref="InDict.inac.trandt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="交易日期" parameterType="condition"/>
        </parameterMap>
        <resultMap class="In.KnsCler"/>
    </select>
    <update method="update" id="updateClerData" longname="更新清算数据">
        <sql><![CDATA[
  			update kns_cler
         	set 
         		status = #status#,
			stacno = #stacno#

       		where trandt = #trandt#
         	  and clerbr = #clerbr#
         	  and crcycd = #crcycd#
         	  and clerlv = #clerlv#
			  and tranam <> 0 
			  and status = '0'			
  		]]></sql>
        <sql type="mysql"><![CDATA[
  			update kns_cler
         	set 
         		status = #status#,
			stacno = #stacno#

       		where trandt = #trandt#
         	  and clerbr = #clerbr#
         	  and crcycd = #crcycd#
         	  and clerlv = #clerlv#
			  and tranam <> 0 
			  and status = '0'			
  		]]></sql>
        <sql type="oracle"><![CDATA[
  			update kns_cler
         	set 
         		status = #status#,
			stacno = #stacno#

       		where trandt = #trandt#
         	  and clerbr = #clerbr#
         	  and crcycd = #crcycd#
         	  and clerlv = #clerlv#
			  and tranam <> 0 
			  and status = '0'			
  		]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="trandt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="交易日期" parameterType="condition"/>
            <parameter property="clerbr" jdbcType="VARCHAR" javaType="BaseType.U_BRCHNO" mode="in" longname="清算机构" parameterType="condition"/>
            <parameter property="crcycd" jdbcType="VARCHAR" javaType="BaseType.U_CRCYCD" mode="in" longname="清算币种" parameterType="condition"/>
            <parameter property="clerlv" jdbcType="VARCHAR" javaType="PbEnumType.E_CLERLV" mode="in" longname="清算层级" parameterType="condition"/>
            <parameter property="stacno" jdbcType="VARCHAR" javaType="BaseType.U_SEQUNO" mode="in" longname="套号" parameterType="condition"/>
            <parameter property="status" jdbcType="VARCHAR" javaType="BaseEnumType.E_YES___" mode="in" longname="入账状态" parameterType="condition"/>
        </parameterMap>
    </update>
    <select cache="none" method="selectAll" type="sql" id="CheckBalanceOfGlvcByAcctbr" longname="系统内清算后平衡检查">
        <sql type="oracle"><![CDATA[
		   
			select crcycd,acctbr,nvl(sum(case when amntcd='C' then tranam else -tranam end),0) as tranam
			from kns_acsq
			where 	trandt=#trandt# 
			    and ioflag='I'
          		    group by crcycd,acctbr
			    having sum(case when amntcd='C' then tranam else -tranam end) <> 0.00
		   
		]]></sql>
        <sql type="mysql"><![CDATA[
		   
			select crcycd,acctbr,ifnull(sum(case when amntcd='C' then tranam else -tranam end),0) as tranam
			from kns_acsq
			where 	trandt=#trandt# 
			    and ioflag='I'
          		    group by crcycd,acctbr
			    having sum(case when amntcd='C' then tranam else -tranam end) <> 0.00
		   
		]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="trandt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" parameterType="condition"/>
        </parameterMap>
        <resultMap class="InQueryTypes.BalanceOfCmda"/>
    </select>
    <delete method="delete" id="delKnsAcsqColl" longname="删除清算数据">
        <sql><![CDATA[delete from kns_acsq_coll  where clerdt =#clerdt# and clenum =#clenum#]]></sql>
        <sql type="mysql"><![CDATA[delete from kns_acsq_coll  where clerdt =#clerdt# and clenum =#clenum#]]></sql>
        <sql type="oracle"><![CDATA[delete from kns_acsq_coll  where clerdt =#clerdt# and clenum =#clenum#]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="clerdt" ref="BaseDict.Comm.clerdt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="清算日期" parameterType="condition"/>
            <parameter property="clenum" jdbcType="VARCHAR" javaType="BaseType.U_INTEGE" mode="in" longname="清算场次" parameterType="condition"/>
        </parameterMap>
    </delete>
    <select cache="none" method="selectOne" type="sql" id="SelAccoutInacByBusino" longname="根据产品查询有效内部户记录数">
        <sql><![CDATA[select count(*) as count from gl_kna_acct where acctst ='1' and busino =#busino#]]></sql>
        <sql type="mysql"><![CDATA[select count(*) as count from gl_kna_acct where acctst ='1' and busino =#busino#]]></sql>
        <sql type="oracle"><![CDATA[select count(*) as count from gl_kna_acct where acctst ='1' and busino =#busino#]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="busino" ref="InDict.inac.busino" jdbcType="VARCHAR" javaType="BaseType.U_BUSINO" mode="in" longname="业务代码" parameterType="condition"/>
        </parameterMap>
        <resultMap class="int"/>
    </select>
    <delete method="delete" id="delKupDppbUserByProdcd" longname="根据产品代码和业务大类删除柜员登记薄">
        <sql><![CDATA[delete from kup_dppb_user where prodcd=#prodcd# and busibi=#busibi#]]></sql>
        <sql type="mysql"><![CDATA[delete from kup_dppb_user where prodcd=#prodcd# and busibi=#busibi#]]></sql>
        <sql type="oracle"><![CDATA[delete from kup_dppb_user where prodcd=#prodcd# and busibi=#busibi#]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="prodcd" ref="PbDict.Dcmt.prodcd" jdbcType="VARCHAR" javaType="BaseType.U_CHAR32" mode="in" longname="产品代码" parameterType="condition"/>
            <parameter property="busibi" ref="DpDict.Prod.busibi" jdbcType="VARCHAR" javaType="DpEnumType.E_BUSIBI" mode="in" longname="业务大类" parameterType="condition"/>
        </parameterMap>
    </delete>
    <select cache="none" method="selectAll" type="sql" id="CheckBalanceOfGlvcByTrandtAndTransq" longname="检查所有交易的平衡">
        <sql type="oracle"><![CDATA[
        SELECT mntrsq,crcycd,nvl(case when amntcd='C' then tranam else -tranam end,0) as tranam,acctbr 
		FROM kns_acsq WHERE mntrsq 
		in(
			select mntrsq
			from kns_acsq
			where   trandt=#trandt#
			and corpno=#corpno# 
			and ioflag='I'
			group by mntrsq,crcycd
			having sum(case when amntcd='C' then tranam else -tranam end) <> 0.00
		)]]></sql>
        <sql type="mysql"><![CDATA[
        SELECT mntrsq,crcycd,ifnull(case when amntcd='C' then tranam else -tranam end,0) as tranam,acctbr 
		FROM kns_acsq WHERE mntrsq 
		in(
			select mntrsq
			from kns_acsq
			where   trandt=#trandt#
			and corpno=#corpno# 
			and ioflag='I'
			group by mntrsq,crcycd
			having sum(case when amntcd='C' then tranam else -tranam end) <> 0.00
		)]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="trandt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" parameterType="condition"/>
            <parameter property="corpno" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" parameterType="condition"/>
        </parameterMap>
        <resultMap class="InQueryTypes.BalanceOfCmda"/>
    </select>
    <delete method="delete" id="deleteKnsBrclTrsq" longname="删除机构账不平上日流水">
        <sql><![CDATA[delete from kns_brcl_trsq where trandt <=#trandt#]]></sql>
        <sql type="mysql"><![CDATA[delete from kns_brcl_trsq where trandt <=#trandt#]]></sql>
        <sql type="oracle"><![CDATA[delete from kns_brcl_trsq where trandt <=#trandt#]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="trandt" ref="BaseDict.Comm.trandt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="交易日期" parameterType="condition"/>
        </parameterMap>
    </delete>
    <insert id="insertKnsBrclTrsq" longname="插入机构账不平流水">
        <sql><![CDATA[			
		   insert into kns_brcl_trsq 
			select trandt,transq
			from kns_acsq
			where 	trandt=#trandt# 
			    and ioflag='I'
          		    group by trandt,transq,crcycd,acctbr
			    having sum(case when amntcd='C' then tranam else -tranam end) <> 0.00]]></sql>
        <sql type="mysql"><![CDATA[			
		   insert into kns_brcl_trsq 
			select trandt,transq
			from kns_acsq
			where 	trandt=#trandt# 
			    and ioflag='I'
          		    group by trandt,transq,crcycd,acctbr
			    having sum(case when amntcd='C' then tranam else -tranam end) <> 0.00]]></sql>
        <sql type="mysql"><![CDATA[			
		   insert into kns_brcl_trsq 
			select trandt,transq
			from kns_acsq
			where 	trandt=#trandt# 
			    and ioflag='I'
          		    group by trandt,transq,crcycd,acctbr
			    having sum(case when amntcd='C' then tranam else -tranam end) <> 0.00]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="trandt" ref="BaseDict.Comm.trandt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="交易日期" parameterType="condition"/>
        </parameterMap>
    </insert>
    <delete method="delete" id="delHistKnsCler" longname="清理资金清算流水表">
        <sql><![CDATA[
        delete from kns_cler where trandt < #trandt#
         ]]></sql>
        <sql type="mysql"><![CDATA[
        delete from kns_cler where trandt < #trandt#
         ]]></sql>
        <sql type="oracle"><![CDATA[
        delete from kns_cler where trandt < #trandt#
         ]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="trandt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="交易日期" parameterType="condition"/>
        </parameterMap>
    </delete>
    <select cache="none" method="selectAll" type="sql" id="selBrchnoForClear" longname="查询需要清算的机构">
        <sql><![CDATA[         
        select lwbrch  as acctbr
	 	from  kub_clbr 
		where lwbrch !='999000'
		]]></sql>
        <sql type="mysql"><![CDATA[         
        select lwbrch  as acctbr
	 	from  kub_clbr 
		where lwbrch !='999000'
		]]></sql>
        <sql type="oracle"><![CDATA[         
        select lwbrch  as acctbr
	 	from  kub_clbr 
		where lwbrch !='999000'
		]]></sql>
        <parameterMap class="java.util.Map"/>
        <resultMap class="InQueryTypes.KnsAcsqGroupInfo"/>
    </select>
    <update method="update" id="updateGlAcctCractpByBusino" longname="根据内部户产品修改账户冲销标志">
        <sql type="oracle"><![CDATA[
  			update gl_kna_acct
  			set cractp = #cractp#,
                            kpacfg = #kpacfg#,
                            rlbltg = #rlbltg#,
				tmstmp=#tmstmp#
  			where busino = #busino#
        ]]></sql>
        <sql type="db2"><![CDATA[
  			update gl_kna_acct
  			set cractp = #cractp#,
                            kpacfg = #kpacfg#,
                            rlbltg = #rlbltg#,
				tmstmp=#tmstmp#
  			where busino = #busino#
  		]]></sql>
        <sql type="mysql"><![CDATA[
  			update gl_kna_acct
  			set cractp = #cractp#,
                            kpacfg = #kpacfg#,
                            rlbltg = #rlbltg#,
				tmstmp=#tmstmp#
  			where busino = #busino#
        ]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="busino" jdbcType="VARCHAR" javaType="BaseType.U_BUSINO" mode="in" longname="业务代码" parameterType="condition"/>
            <parameter property="cractp" jdbcType="VARCHAR" javaType="InEnumType.E_CRACTP" mode="in" longname="冲销标志" parameterType="condition"/>
            <parameter property="tmstmp" jdbcType="VARCHAR" javaType="ApBaseType.U_TMSTMP" mode="in" longname="时间戳" parameterType="condition"/>
            <parameter property="kpacfg" ref="InDict.inac.kpacfg" jdbcType="VARCHAR" javaType="InEnumType.E_KPACFG" mode="in" longname="记账控制" parameterType="condition"/>
            <parameter property="rlbltg" ref="InDict.inac.rlbltg" jdbcType="VARCHAR" javaType="InEnumType.E_RLBLTG" mode="in" longname="余额更新方式" parameterType="condition"/>
        </parameterMap>
    </update>
    <select cache="none" method="selectFirst" type="sql" id="selknbPidlByAcctnoPyindt" longname="根据负债账号及日期查询结息明细">
        <sql type="db2"><![CDATA[
        select * from knb_pidl a where a.acctno = #acctno# and pyindt = #pyindt# order by detlsq desc
        ]]></sql>
        <sql type="mysql"><![CDATA[
        select * from knb_pidl a where a.acctno = #acctno# and pyindt = #pyindt# order by detlsq desc
        ]]></sql>
        <sql type="oracle"><![CDATA[
        select * from knb_pidl a where a.acctno = #acctno# and pyindt = #pyindt# order by detlsq desc
        ]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="acctno" ref="DpDict.Acct.acctno" jdbcType="VARCHAR" javaType="BaseType.U_ACCTNO" mode="in" longname="负债账号" parameterType="condition"/>
            <parameter property="pyindt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="付息日期" parameterType="condition"/>
        </parameterMap>
        <resultMap class="IoDpTable.IoDpKnbPidl"/>
    </select>
    <select cache="none" method="selectAll" type="sql" id="selKnsAscqCollBuStatus" longname="根据状态查询清算汇总表数据">
        <sql><![CDATA[select toacct,acctno,brchno,prodcd,crcycd,clactp, 
			sum(dranam) as dranam,
			sum(drcunt) as drcunt,
			sum(cranam) as cranam ,
			sum(crcunt) as crcunt
			from kns_acsq_coll where status='3' 
			group by toacct,acctno,brchno,prodcd,crcycd,clactp
		]]></sql>
        <sql type="mysql"><![CDATA[select toacct,acctno,brchno,prodcd,crcycd,clactp, 
			sum(dranam) as dranam,
			sum(drcunt) as drcunt,
			sum(cranam) as cranam ,
			sum(crcunt) as crcunt
			from kns_acsq_coll where status='3' 
			group by toacct,acctno,brchno,prodcd,crcycd,clactp
		]]></sql>
        <sql type="oracle"><![CDATA[select toacct,acctno,brchno,prodcd,crcycd,clactp, 
			sum(dranam) as dranam,
			sum(drcunt) as drcunt,
			sum(cranam) as cranam ,
			sum(crcunt) as crcunt
			from kns_acsq_coll where status='3' 
			group by toacct,acctno,brchno,prodcd,crcycd,clactp
		]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="clerdt" ref="BaseDict.Comm.clerdt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="清算日期" parameterType="condition"/>
            <parameter property="clenum" jdbcType="VARCHAR" javaType="BaseType.U_INTEGE" mode="in" longname="清算场次" parameterType="condition"/>
        </parameterMap>
        <resultMap class="In.KnsAcsqColl"/>
    </select>
    <update method="update" id="updKnsAcsqCollData" longname="更新清算汇总表状态">
        <sql><![CDATA[update kns_acsq_coll set status='2' where status='3']]></sql>
        <sql type="mysql"><![CDATA[update kns_acsq_coll set status='2' where status='3']]></sql>
        <sql type="oracle"><![CDATA[update kns_acsq_coll set status='2' where status='3']]></sql>
        <parameterMap class="java.util.Map"/>
    </update>
    <update method="update" id="updateKnsAcsqClerFailure" longname="更新清算明细为清算失败">
        <sql><![CDATA[update
		kns_acsq_cler set clerst='2',tmstmp = #tmstmp#
		where clerdt =#clerdt# and clenum=#clenum# and toacbr=#acctbr# 
		and prodcd=#prodcd# and clactp=#clactp#  and clerst ='1']]></sql>
        <sql type="mysql"><![CDATA[update
		kns_acsq_cler set clerst='2',tmstmp = #tmstmp#
		where clerdt =#clerdt# and clenum=#clenum# and toacbr=#acctbr# 
		and prodcd=#prodcd# and clactp=#clactp#  and clerst ='1']]></sql>
        <sql type="oracle"><![CDATA[update
		kns_acsq_cler set clerst='2',tmstmp = #tmstmp#
		where clerdt =#clerdt# and clenum=#clenum# and toacbr=#acctbr# 
		and prodcd=#prodcd# and clactp=#clactp#  and clerst ='1']]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="clerdt" ref="BaseDict.Comm.clerdt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="清算日期" parameterType="condition"/>
            <parameter property="clenum" jdbcType="VARCHAR" javaType="BaseType.U_INTEGE" mode="in" longname="清算场次" parameterType="condition"/>
            <parameter property="acctbr" ref="InDict.inac.acctbr" jdbcType="VARCHAR" javaType="BaseType.U_BRCHNO" mode="in" longname="记账机构" parameterType="condition"/>
            <parameter property="prodcd" ref="PbDict.Dcmt.prodcd" jdbcType="VARCHAR" javaType="BaseType.U_CHAR32" mode="in" longname="产品代码" parameterType="condition"/>
            <parameter property="clactp" jdbcType="VARCHAR" javaType="BaseEnumType.E_CLACTP" mode="in" longname="系统内账号类型" parameterType="condition"/>
            <parameter property="trandt" ref="PbDict.Intr.trandt" jdbcType="VARCHAR" javaType="PbBaseType.U_DATE08" mode="in" longname="交易日期" parameterType="condition"/>
            <parameter property="tmstmp" jdbcType="VARCHAR" javaType="ApBaseType.U_TMSTMP" mode="in" longname="时间戳" parameterType="condition"/>
        </parameterMap>
    </update>
    <update method="update" id="updateKnsAcsqClerFailureByClerdt" longname="根据清算日期场次更新清算明细为清算失败">
        <sql><![CDATA[update
		 kns_acsq_cler set clerst='2',tmstmp = #tmstmp#
		 where clerdt =#clerdt# and clenum=#clenum#  and clerst ='1']]></sql>
        <sql type="mysql"><![CDATA[update
		 kns_acsq_cler set clerst='2',tmstmp = #tmstmp#
		 where clerdt =#clerdt# and clenum=#clenum#  and clerst ='1']]></sql>
        <sql type="oracle"><![CDATA[update
		 kns_acsq_cler set clerst='2',tmstmp = #tmstmp#
		 where clerdt =#clerdt# and clenum=#clenum#  and clerst ='1']]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="clerdt" ref="BaseDict.Comm.clerdt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="清算日期" parameterType="condition"/>
            <parameter property="clenum" jdbcType="VARCHAR" javaType="BaseType.U_INTEGE" mode="in" longname="清算场次" parameterType="condition"/>
            <parameter property="trandt" ref="PbDict.Intr.trandt" jdbcType="VARCHAR" javaType="PbBaseType.U_DATE08" mode="in" longname="交易日期" parameterType="condition"/>
            <parameter property="tmstmp" ref="ApDict.Aplt.tmstmp" jdbcType="VARCHAR" javaType="ApBaseType.U_TMSTMP" mode="in" longname="时间戳" parameterType="condition"/>
        </parameterMap>
    </update>
    <update method="update" id="updateKnsAcsqClerSuccess" longname="更新清算明细交易日期">
        <sql><![CDATA[update
		 kns_acsq_cler set clerst='1' ,trandt =#trandt#,tmstmp = #tmstmp#
		 where toacbr=#acctbr# and prodcd=#prodcd# and clactp=#clactp# and clerst ='2']]></sql>
        <sql type="mysql"><![CDATA[update
		 kns_acsq_cler set clerst='1' ,trandt =#trandt#,tmstmp = #tmstmp#
		 where toacbr=#acctbr# and prodcd=#prodcd# and clactp=#clactp# and clerst ='2']]></sql>
        <sql type="oracle"><![CDATA[update
		 kns_acsq_cler set clerst='1' ,trandt =#trandt#,tmstmp = #tmstmp#
		 where toacbr=#acctbr# and prodcd=#prodcd# and clactp=#clactp# and clerst ='2']]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="trandt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="交易日期" parameterType="condition"/>
            <parameter property="acctbr" ref="InDict.inac.acctbr" jdbcType="VARCHAR" javaType="BaseType.U_BRCHNO" mode="in" longname="记账机构" parameterType="condition"/>
            <parameter property="prodcd" ref="PbDict.Dcmt.prodcd" jdbcType="VARCHAR" javaType="BaseType.U_CHAR32" mode="in" longname="产品代码" parameterType="condition"/>
            <parameter property="clactp" jdbcType="VARCHAR" javaType="BaseEnumType.E_CLACTP" mode="in" longname="系统内账号类型" parameterType="condition"/>
            <parameter property="tmstmp" ref="ApDict.Aplt.tmstmp" jdbcType="VARCHAR" javaType="ApBaseType.U_TMSTMP" mode="in" longname="时间戳" parameterType="condition"/>
        </parameterMap>
    </update>
    <select cache="none" method="selectOne" type="sql" id="selectKnsAcsqClerByClerst" longname="查询清算失败的明细记录数">
        <sql><![CDATA[select count(*)  from  kns_acsq_cler where clerst ='2']]></sql>
        <sql type="mysql"><![CDATA[select count(*)  from  kns_acsq_cler where clerst ='2']]></sql>
        <sql type="oracle"><![CDATA[select count(*)  from  kns_acsq_cler where clerst ='2']]></sql>
        <parameterMap class="java.util.Map"/>
        <resultMap class="int"/>
    </select>
    <select cache="none" method="selectOne" type="sql" id="SelGLvcByBusino" longname="根据产品查询当日发生交易记录数">
        <sql><![CDATA[select count(*) as count from gl_kns_glvc where busino=#busino# and trandt =#trandt#]]></sql>
        <sql type="mysql"><![CDATA[select count(*) as count from gl_kns_glvc where busino=#busino# and trandt =#trandt#]]></sql>
        <sql type="oracle"><![CDATA[select count(*) as count from gl_kns_glvc where busino=#busino# and trandt =#trandt#]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="trandt" ref="BaseDict.Comm.trandt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="交易日期" parameterType="condition"/>
            <parameter property="busino" ref="InDict.inac.busino" jdbcType="VARCHAR" javaType="BaseType.U_BUSINO" mode="in" longname="业务代码" parameterType="condition"/>
        </parameterMap>
        <resultMap class="int"/>
    </select>
    <dynamicSelect cache="none" method="selectAll" type="sql" id="selAcsqCollClerdInfo" longname="查询汇总表明细信息">
        <parameterMap class="java.util.Map">
            <parameter property="trandt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="记账日期" parameterType="condition"/>
            <parameter property="clactp" jdbcType="VARCHAR" javaType="BaseEnumType.E_CLACTP" mode="in" longname="账户类型" parameterType="condition"/>
            <parameter property="clenum" jdbcType="VARCHAR" javaType="BaseType.U_CHAR03" mode="in" longname="清算场次" parameterType="condition"/>
            <parameter property="brchno" jdbcType="VARCHAR" javaType="BaseType.U_BRCHNO" mode="in" longname="机构号" parameterType="condition"/>
        </parameterMap>
        <resultMap class="InDayEndTypes.ioClerResultList"/>
        <dynamicSql>
            <str type="Str"><![CDATA[select a.trandt,a.clenum,a.clactp,a.brchno,a.dranam,a.cranam,a.corest,
			(case when a.status='2' then '1' else '2' end) nassst,a.clerdt,a.transq from kns_acsq_coll a]]></str>
            <where type="Where">
                <and type="And">
                    <str type="Str"><![CDATA[a.trandt=#trandt#]]></str>
                    <str type="Str"><![CDATA[a.clactp=#clactp#]]></str>
                    <if test="clenum!=null &amp;&amp; clenum!=''" type="If">
                        <str type="Str"><![CDATA[a.clenum=#clenum#]]></str>
                    </if>
                    <if test="brchno!=null &amp;&amp; brchno!=''" type="If">
                        <str type="Str"><![CDATA[a.brchno=#brchno#]]></str>
                    </if>
                </and>
            </where>
        </dynamicSql>
        <dynamicSql type="oracle">
            <str type="Str"><![CDATA[select a.trandt,a.clenum,a.clactp,a.brchno,a.dranam,a.cranam,a.corest,
			(case when a.status='2' then '1' else '2' end) nassst,a.clerdt,a.transq from kns_acsq_coll a]]></str>
            <where type="Where">
                <and type="And">
                    <str type="Str"><![CDATA[a.trandt=#trandt#]]></str>
                    <str type="Str"><![CDATA[a.clactp=#clactp#]]></str>
                    <if test="clenum!=null &amp;&amp; clenum!=''" type="If">
                        <str type="Str"><![CDATA[a.clenum=#clenum#]]></str>
                    </if>
                    <if test="brchno!=null &amp;&amp; brchno!=''" type="If">
                        <str type="Str"><![CDATA[a.brchno=#brchno#]]></str>
                    </if>
                </and>
            </where>
        </dynamicSql>
        <dynamicSql type="mysql">
            <str type="Str"><![CDATA[select a.trandt,a.clenum,a.clactp,a.brchno,a.dranam,a.cranam,a.corest,
			(case when a.status='2' then '1' else '2' end) nassst,a.clerdt,a.transq from kns_acsq_coll a]]></str>
            <where type="Where">
                <and type="And">
                    <str type="Str"><![CDATA[a.trandt=#trandt#]]></str>
                    <str type="Str"><![CDATA[a.clactp=#clactp#]]></str>
                    <if test="clenum!=null &amp;&amp; clenum!=''" type="If">
                        <str type="Str"><![CDATA[a.clenum=#clenum#]]></str>
                    </if>
                    <if test="brchno!=null &amp;&amp; brchno!=''" type="If">
                        <str type="Str"><![CDATA[a.brchno=#brchno#]]></str>
                    </if>
                </and>
            </where>
        </dynamicSql>
    </dynamicSelect>
    <insert id="backupKnsAcsq" longname="按天备份会计流水">
        <sql type="mysql"><![CDATA[ 
		insert into h_kns_acsq
		(corpno, trandt, sortno, transq, atsqtp, mntrsq, acctdt, atowtp, cuacno, acseno, acctno, prodcd, dtitcd, acctbr, crcycd, bltype, amntcd, tranam, servtp, tranms, bookms, statms, clerdt, dasyst, crdcnfg, fileid, ioflag, toacct, toacna, tobrch,hashvl,tmstmp)
		select corpno, trandt, sortno, transq, atsqtp, mntrsq, acctdt, atowtp, cuacno, acseno, acctno, prodcd, dtitcd, acctbr, crcycd, bltype, amntcd, tranam, servtp, tranms, bookms, statms, clerdt, dasyst, crdcnfg, fileid, ioflag, toacct, toacna, tobrch,hashvl,tmstmp
		from kns_acsq where trandt = #trandt# and corpno = #corpno#
        ]]></sql>
        <sql type="oracle"><![CDATA[ 
		insert into h_kns_acsq
		(corpno, trandt, sortno, transq, atsqtp, mntrsq, acctdt, atowtp, cuacno, acseno, acctno, prodcd, dtitcd, acctbr, crcycd, bltype, amntcd, tranam, servtp, tranms, bookms, statms, clerdt, dasyst, crdcnfg, fileid, ioflag, toacct, toacna, tobrch,hashvl,tmstmp)
		select corpno, trandt, sortno, transq, atsqtp, mntrsq, acctdt, atowtp, cuacno, acseno, acctno, prodcd, dtitcd, acctbr, crcycd, bltype, amntcd, tranam, servtp, tranms, bookms, statms, clerdt, dasyst, crdcnfg, fileid, ioflag, toacct, toacna, tobrch,hashvl,tmstmp
		from kns_acsq where trandt = #trandt# and corpno = #corpno#
        ]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="trandt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="交易日期" parameterType="condition"/>
            <parameter property="corpno" ref="LnDict.LNF.corpno" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
        </parameterMap>
    </insert>
    <insert id="deleteKnsAcsqByDay" longname="会计流水表删除30天前数据">
        <sql type="mysql"><![CDATA[ 
		delete from kns_acsq where corpno = #corpno# and trandt < #trandt# 
        ]]></sql>
        <sql type="oracle"><![CDATA[ 
		delete from kns_acsq where corpno = #corpno# and trandt < #trandt#
        ]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="trandt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="交易日期" parameterType="condition"/>
            <parameter property="corpno" ref="LnDict.LNF.corpno" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
        </parameterMap>
    </insert>
    <select cache="none" method="selectOne" type="sql" id="selmanageramt" longname="查询理财金额">
        <sql type="mysql"><![CDATA[
        select ifnull(sum(nowtam*facevl),0) from fna_acct where prodcd=#prodcd# and corpno=#corpno#
        ]]></sql>
        <sql type="oracle"><![CDATA[
        select nvl(sum(nowtam*facevl),0) from fna_acct where prodcd=#prodcd# and corpno=#corpno#
        ]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="corpno" ref="LnDict.LNF.corpno" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="法人代码" parameterType="condition"/>
            <parameter property="prodcd" ref="LnDict.LNF.prodcd" jdbcType="VARCHAR" javaType="BaseType.U_PRODCD" mode="in" longname="产品代码" default="''" parameterType="condition"/>
        </parameterMap>
        <resultMap class="java.math.BigDecimal"/>
    </select>
    <select cache="none" method="selectAll" type="sql" id="seltransq" longname="查询交易流水">
        <sql type="mysql"><![CDATA[
		select * from kns_acsq where trandt=#trandt# and transq=#transq#
		]]></sql>
        <sql type="oracle"><![CDATA[
		select * from kns_acsq where trandt=#trandt# and transq=#transq#
		]]></sql>
        <parameterMap class="java.util.Map">
            <parameter property="trandt" jdbcType="VARCHAR" javaType="BaseType.U_DATE08" mode="in" longname="交易日期" parameterType="condition"/>
            <parameter property="transq" jdbcType="VARCHAR" javaType="BaseType.U_CORPNO" mode="in" longname="交易流水" parameterType="condition"/>
        </parameterMap>
        <resultMap class="DpAccount.KnsAcsq"/>
    </select>
    <select cache="none" method="selectAll" type="sql" id="selKnsAcsqCollByStatus" longname="查询待清算的汇总记录">
        <sql type="oracle"><![CDATA[select  b.* from kns_acsq_coll b 
		where b.status != '2'and b.status != '4']]></sql>
        <parameterMap class="java.util.Map"/>
        <resultMap class="In.KnsAcsqColl"/>
    </select>
</sqls>
